


<html>

      <head>
      
            <base href='https://javascript-2020.github.io/utils/editors/srcdoc/srcdoc.html'>
            <link rel=icon type='image/png' href='images/srcdoc.png'>
<!--
            <link rel=stylesheet href='/utils/css/utils.css'>
-->

            <script init>
                                                                                console.clear();
                                                                                console.json=v=>console.log(JSON.stringify(v));
        var version       = 'v1.0';
            
        var df            = true;


        var ext;
        var $;
        var datatype;
        var github;


        async function init(){
                                                                                debug('init',version);
console.log(github);

              await initdom(document.body);


              init.complete();


              
        }//init


        init.stack            = [];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = '';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              init.stack.ct>=init.stack.total && init();
        }});
        
        //  (typeof init!='undefined' && init?.stack && init.stack.add)
        //  (typeof init!='undefined' && init?.stack && init.stack.complete)

        
        init.complete   = function(){
          
              init.complete.stack.forEach(fn=>fn());
              
        }//complete
        
        init.complete.stack   = [];
        init.complete.add     = fn=>init.complete.stack.push(fn);

                  

(async()=>{
  
        init.stack.add;
        
        var token   = localStorage['github-token'];
        var url;
        var headers;
        if(token){
              url       = 'https://api.github.com/repos/javascript-2020/ext-code/contents/ext-loader.js';
              headers   = {accept:'application/vnd.github.raw',authorization:`bearer ${token}`};
        }else{
              url       = 'https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js';
        }
        
        await fetch(url,{headers}).then(res=>res.text()).then(complete);

            
        async function complete(txt){

              ext           = eval(txt);
              var promise   = ext.load.libs(
                    'js/dom/$.js.api',
                    'js/core/datatype.js',
                    'github/github.js.api'
              );
              [$,datatype,github]   = await promise;

              init.stack.complete;

        }//ext_fn

})();


            </script init>
            
            
            <style>
        
  html
    {height:100%}
  body
    {height:calc(100% - 16px);display:flex;flex-direction:column;font-family:arial}
  
  .icon
    {border:1px solid gray;border-radius:3px;box-sizing:border-box;width:30px;height:30px;cursor:pointer}

  .copy
    {content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAABSlBMVEVHcEwnz/4C8P4g1P4L6P43wf5Mr/4a2v4Y3P4/uv5PrP4+vf5Auv4ozv5KsP4vyv45wP5Jsf5Auf49vP5Mrv4zxf44wf5Lr/46wP4h1P5Lr/46vv5Jsv4R5P5Hs/5Etv44wf5Hs/41w/4uyv47vv49vP5Ftf5GtP4c2f4rzP4tyv4m0f5Etv5Nrv4xxv4xxv4xx/4W3/5KsP5Mr/4/u/4uyv5Isv4K6f4l0f4qzv4W3/4V3/5Nrv5Mrv5Mrv5Mr/4W3v4e2P5BuP5Hsv4N5v4K6f4O5v42w/5Dt/4E7/4uyf4C8P4nz/4M5/4K6v4oz/4P5f4k0v4b2v5Gs/4E7v4I6/5Nrf4e1/4H7P4E7v5Auv5Dtv4sy/5Isv5GtP4wx/49vP4zxf47vv44wP42w/5LsP5Jsf4i1P4n0P4N5v4k0v4a2v4S4v4X3v6OfcqkAAAAVnRSTlMACo7CjQWN/VczjgIJMfIXJzHtjj5iVekR71Hvtz7CjelXjre2wiJj2PCFIWbR7+fEnXaodz3544/USfOC22Tm7CXOnqfUZ+/3VTV9bsTzqGDahpb2tyRB6bIAAAIDSURBVDjLrZVpV9pAFIYntdFiQkZsLCQECtJSlqAsFRBU3Kuta1sncYGuJEDt///aISkkkyHo6enzLTlP5s5758wNAC526pd3d1++/fzx/evNze1tp210wxURUMTWBz2v2EWtLc7jBTPmoJfNrqy8i0ajixgB00VISJIeW9JMKbcWDAYDNiFMQN1EqAAJcUfSBif0fsQWQjLxpjGnXUJa5CoIbTiP8KJ0OqfNMLQIZhGad/Ke3t///vWwGKv1+yPxfW55+TnmJWZW5ggxcqX3m6WSVTpSdPcxHCLExmf97AI8e1j8cK1f8X9Fq/Sotrf0k2v9KRiJ08L8mwhf2CQx8oK/yJyPw3Q67ULaV4Tr7tRCwFfkllLF4ushccwGPyUMzwzhMQz/X1Kz+QVMmh2LcjgsTxDZ3OpqIpFYfDu+KGwoxE5JvTtpF9NX9BEB792jn0gD4eNEsVAQHyXOO7fQFmNNLZOnPV5BqEyI+Yxm1qkluS0BCWRp8FEze6mTJQtVVd8MUfcEhBSGFOGMOWmaoc0AmRoXP5cmiHEReEXANOopzCsLRYlXjWolGXE2jK/r/ujEWAdOFIxWGrjO8ljXazG6MeynthEn2gAP9P7B4XCE2thzdG2v2jbK5LfHZ3hINbclSco6o/kIh1Einq4e1qxp5m2PkqZ/CPvbXvFot+xe7w/EpaiUrJ24NAAAAABJRU5ErkJggg==);}
  .paste
    {content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==);}
    
  #url-root
    {display:flex;gap:5px;align-items:center}
  #url
    {flex:1;padding:5px 10px;font-size:16px}
  
  iframe
    {flex:1;border:none}
    
  input
    {font-size:16px;padding:5px 10px}
  input[type=button]
    {cursor:pointer}
        
            </style>
            
      </head>
      
      
      <body>
      
            <div id=url-root>
                  <img class='copy icon'>
                  <img class='paste icon'>
                  <input id=url autocomplete=off spellcheck=false>
                  <input type=button value=go>
                  
            </div>
            
            <iframe></iframe>
      
            <script>
                                                                                debug(version);
        
        var input;
        var iframe;

        
        var btn           = {};
        var onmsg         = {};


    //:

    
        function initdom(){
                                                                                debug('initdom');
              root                                = document.body;
              
              input                               = $(root,'#url');
              
              $(root,'.copy').onclick             = btn.copy;
              $(root,'.paste').onclick            = btn.paste;
              
              $(root,'[value=go]').onclick        = btn.go;      
              
              
              iframe                              = $(root,'iframe');


              
              
        }//initdom
        
        
        btn.copy    = async function(){
          
              var txt   = input.value;
              await navigator.clipboard.writeText(txt);
        }//copy
        
        
        btn.paste   = async function(){
          
              var txt       = await navigator.clipboard.readText();
              input.value   = txt;
              
        }//paste
        
        
        btn.go    = async function(){
          
              var url       = input.value;
              var result    = github.parse(url);
              if(result.error){
                    alert(result.error);
                    return;
              }
              var url   = github.build(result);
              
              var err;
              
              try{
                
                    var res   = await fetch(url);
                    
              }//try
              
              catch(err2){
                
                    err   = err2;
                    
              }//catch
              
              if(err){
                    alert(err.toString());
                    return;
              }

      
              var html;        
              if(github.parse.is.api(url)){
                    var json    = await res.json();
                    var b64     = json.content;
                    html        = window.atob(b64);
              }else{
                    html        = await res.text();
              }
              
              iframe.srcdoc    = html;
              
        }//go
                  

  //:
  
  
        window.onmessage    = function(e){
          
              var str     = e.data;
              var json    = JSON.parse(str);
              
              switch(json.type){
                
                case 'load'   : onmsg.load(json);       break;
                
              }//switch
              
        }//onmessage
        
        
        onmsg.load    = function(json){
          
              input.value   = json.url;
              
              if(json.auto!==false){
                    btn.go();
              }
              
        }//load
        
        
  //:
  
                  
        function debug(){
          
              if(!df){
                    return;
              }
              var str   = [...arguments].join(' ');
              console.log(`[ srcdoc ]`,str);
              
        }//debug
        
        
        
        
  init.stack.complete;        
        
                  
            </script>
      </body>
      
</html>