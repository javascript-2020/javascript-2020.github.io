

<output-html>

      <template shadowrootmode=open>
      
            <style>
            
  :host
    {display:flex;flex-direction:column;height:100%}
    
  #hdr
    {display:flex}
    
  .radio
    {border:1px solid lightgray;padding:2px 10px;border-radius:5px;cursor:pointer}
    
  #hldr
    {flex:1;box-sizing:border-box;position:relative}
  iframe
    {width:100%;height:100%}
  #glass
    {position:absolute;left:0;top:0;width:100%;height:100%;display:none}
    
            </style>
            
            <div id=hdr>
                  <span id=allow-scripts class=radio>
                        <input type=checkbox checked>
                        allow-scripts
                  </span>
                  <span id=allow-modals class=radio>
                        <input type=checkbox checked>
                        allow-modals
                  </span>
                  <span id=allow-popups class=radio>
                        <input type=checkbox checked>
                        allow-popups
                  </span>
                  
                  <div style='flex:1'></div>
                  <button id=kill style='margin-right:20px'>kill</button>
            </div>
            
            <div id=hldr>
                  <iframe sandbox='allow-forms allow-downloads allow-pointer-lock allow-popups-to-escape-sandbox allow-same-origin'></iframe>
                  <div id=glass></div>
            </div>
            
      </template>
      
      <script>
      
(function output_html({mod,dom,host}){

  var obj   = {
        version   : 'v2.0',
  };
        var df=false,did='output-html'
        ;
        
        
        
        var ext,$
        ;
        
        obj.initmod=function(params){
        
              ext   = mod.rd(params,'ext',ext);
              $     = mod.rd(params,'$',$);
              
        }//initmod
        
        
  //vars:-
  
        var chk   = {};
        
        var hldr;
        var iframe;
        var glass;
        
        
        var btn   = {};
        
        
  //:
  
  
        obj.init    = async function(){
        }//init
        
        
  //:
  
  
        obj.initdom   = function(rootnode){
        
              shadow                          = host.shadowRoot;
              
              var style                       = $(shadow,'style');
              $.stylesheet.insert(style,'button','.icon');
              
              
              var hdr                         = $(shadow,'#hdr');
              chk['allow-scripts']            = $.chkbox(hdr,'#allow-scripts');
              chk['allow-modals']             = $.chkbox(hdr,'#allow-modals');
              chk['allow-popups']             = $.chkbox(hdr,'#allow-popups');
              
              $(hdr,'#kill').onclick          = btn.kill;
              
              
              hldr                            = $(shadow,'#hldr');
              iframe                          = $(shadow,'iframe');
              glass                           = $(shadow,'#glass');
              
              
        }//initdom
        
        
  //:
  
  
        btn.kill    = function(){
        
              kill();
              
        }//kill
        
        
        obj.glass   = function(show=true){
        
              var display     = 'none';
              if(show){
                    display   = 'block';
              }
              glass.style.display    = display;
              
        }//glass
        
        
        obj.horiz   = function(){
        
              host.style.width     = '100%';
              host.style.height    = '50%';
              
        }//horiz
        
        
        obj.vert    = function(){
        
              host.style.width    = '50%';
              host.style.height   = '100%';
              
        }//vert
        
        
        
        obj.srcdoc    = function(html){
        
              var attr      = iframe.getAttribute('sandbox');
              var tokens    = new Set(attr.split(/\s+/).filter(Boolean));
              console.log(chk['allow-scripts']);
              if(chk['allow-scripts'].checked){
                    tokens.add('allow-scripts');
              }
              if(chk['allow-modals'].checked){
                    tokens.add('allow-modals');
              }
              if(chk['allow-popups'].checked){
                    tokens.add('allow-popups');
              }
              
              var attr      = [...tokens].join(' ');
                                                                                console.log(attr);
              iframe.setAttribute('sandbox',attr);
              
              iframe.srcdoc   = html;
              
        }//srcdoc
        
        
        obj.kill    = function(){return kill()}    //d
        
        function kill(){
        
              var niframe       = iframe.cloneNode(true);
              niframe.srcdoc    = null;
              hldr.replaceChild(niframe,iframe);
              iframe            = niframe;
              
        }//kill
        
        
  //:
  
  
        function debug(...args){
        
              if(!df && !obj.df)return;
              args.unshift(`[ ${did} ]`);
              var fmt     = Array.from({length:args.length}).fill('%O').join(' ');
              var args2   = [fmt].concat(args);
              console.groupCollapsed.apply(console,args2);
              console.trace();
              console.groupEnd();
              
        }//debug
        
        
        
        
  return obj;
  
})//output_html

      </script>
      
</output-html>

