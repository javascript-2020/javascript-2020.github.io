<html>
    <head style="display: block;">
        <style style="display: none;">
body {
            display                     : flex;
            flex-direction              : column;
            font-family                 : arial;
            margin:20px;
      }
      
      h3 {
        margin                          : 0;
      }
      
      #values {
            display                     : grid;
            grid-template-columns       : auto 1fr;
            gap                         : 10px;
            align-items                 : center;
            margin                      : 5px;
      }
      
      input {
            font-size                   : 16px;
            padding                     : 5px;
      }
      
      button {
            cursor                      : pointer;
            width                       : 300px;
            font-size                   : 16px;
            padding                     : 5px 10px;
      }
      
      code {
            whitespace                  : pre;
            background                  : rgba(246,246,246,1);
            padding                     : 20px 10px;
      }
      
/*
  page-hdr
*/

      page-hdr #hdr {
            font-family                 : arial;
            position                    : relative;
            margin-top                  : 0;
            margin-bottom               : 20px;
            padding-bottom              : 10px;
            border-bottom               : 1px solid lightblue;
      }
      
      page-hdr .icon {
            display                     : inline-block;
            text-align                  : center;
            background                  : whitesmoke;
            border-radius               : 5px;
            border                      : 1px solid lightgray;
            padding                     : 5px 3px 0px;
            cursor                      : pointer;
            margin-right                : 10px;
            min-width                   : 50px;
      }
      
      page-hdr .icon-label {
            margin                      : 2px 0 0;
      }
      
      page-hdr #title {
            text-align                  : center;
            position                    : absolute;
            left                        : 0;
            right                       : 0;
            top                         : 5px;
            z-index                     : -1;
            color                       : blue;
            font-weight                 : bold;
      }
      
      page-hdr #date {
            float                       : right;
            color                       : black;
            font-size                   : 16px;
            font-weight                 : normal;
      }
        </style>
    </head>
    <body>
        <page-hdr>
            <section id="hdr" style="">
                <div id="home" onclick="window.location='https://javascript-2020.github.io/'" class="icon">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAABA5JREFUOE+lkVtsVEUYx//fnDnn7KW73XZ7peVSWtvSC5duGrXGkBLFUH1AfdD0DWNMn3zwwURJZA2++CKJvtCoSBMkaoLEBDEYpBQCldRSUnq11La4lF7YstfuntuM2cIjKLGTTDLJN//f9/1mCE+womdP+Ae+u1V/99Ls8IHZ49l/i9AT8JA+czx06du5nxam459t8fg/b78Yth+X+09gODyqdW3ua5mfSLQOXkrEa3Tt5PqA3yx3FmXvvMiFzRY8G/vDB0qPrkv542NLB+Pp1GEpBAV8viOH3ip9b13Aj75cOBhLxg8LIagoUHAk/HbZ/wNeGZNvKhyha8MxNRhQ3yUiWloxjz2zI3BXEmbanqKvHzXpYz/l6qT8ghG6LEcmGENh7qJty5imMo8ATrXVUucjgVJKdusW1EgEjs8HcrtBo6NwCqozrddGFrozhrMdkA+zBE1lU60NJV2puby+xkYomQxkMglZWQmlpgYWXR6XtZyjUzgYAUMeAUVk48K5y3cnLMJpAHsXlhfhOAIVZWUgQr8lsvv2P7+1WnLskcA9CKSYgibbxknqH5MtNomfpZRuAIyIDEHijd6+5d+hKaelkHvHpqYghIOG2joojPVnLHVfx25fiEn2vZRSByCIKMMle5l6zieCI5ORU5msuTvn5dKVyYYtJR2BAk9qas74wTDFbkA8VGY55cHKDZ79mWRCnZxd/iVrOXW5otul9TXVVb5O73TPewoc+0eAXsoVfB7FeHpn8Sd5bt5sOeLVmb9X1fISV04VkYUsqio9tsbpt9Ws82v/jXuHU6u250E3ee6+wl+j8ImonyznrBDiOSEEdE2Bx21mGZMKAFVKrMHWIgIgljvAEZLM1YzmNkwHjLHcviJVpYM+6IkEdaGdvxeN7lyJx1BfXY2Az4KSCxIgpIRh2CAiqJzl3nAN7gggnlQxPj2NwvwAioLBGwYzX6APu2fLdc17wTSNesu2EfDnobU5kFNHxrQw8ucSlu+n4XVpcOkcVRsLUFLoRTLtYOBmDLFECirn0DR9wjDTe+hQz8omJuxeIcRWKSU0jSPUmA+vm2E2ch9/jM5DVRn8XhdSqybKi33YUV8G0wIGR+MwzQfTM8b+Eoy3U/irpRri1Dtze64ylkhge/02tDYXQkoLt+djWFpJQ1EYvG4NGcOCW+fYUOKHz+vFwM0VDE+MI+D3o2rT5oi0ZTuFj841kO4+MzQyUhxLxvHsrhBam0ugKBZiySySaRMKI+g6X5uGc2UN6nZ5MTC8hP6hQQR8+djV1LQsjcwr9P6nEz5P0L9rcGKcx2NxtIVa0NJQilQ2jTuLMUSjaXDOkefVkU0b4C4FwXwXKipKcX14EVcHryM/kI9Q/TZ7NZoY+gdEZNOa/2ZSPwAAAABJRU5ErkJggg==" />
                    <div class="icon-label">
home
                    </div>
                </div>
                <h3 style="" id="title">
download a directory from a github repository
                    <span style="" id="date">
28 May 2024
                    </span>
                </h3>
            </section>
        </page-hdr>
        <section id="values">
            <div>
owner
            </div>
            <input class="owner">
            </input>
            <div>
repo
            </div>
            <input class="repo">
            </input>
            <div>
branch
            </div>
            <input class="branch">
            </input>
            <div>
path
            </div>
            <input class="path">
            </input>
        </section>
        <button onclick="download()" style="margin-top: 20px;">
download
        </button>
        <div style="margin-top: 40px; font-family: monospace; font-size: 16px; line-height: 1.4;">
            <div>
the url can be visited with the following query parameters
            </div>
            <div style="margin-top: 10px;">
https:&#x2F;&#x2F;javascript-2020.github.io&#x2F;utils&#x2F;download-a-directory-from-a-github-repository&#x2F;download-a-directory-from-a-github-repository.html?
            </div>
            <div style="margin-top: 10px;">
owner={owner}
            </div>
            <div>
repo={repo}
            </div>
            <div>
branch={branch}
            </div>
            <div>
path={path}
            </div>
            <div>
if the parameter download is present, the download will be started automatically
            </div>
            <div style="margin-top: 10px;">
example
            </div>
            <a href="https://javascript-2020.github.io/utils/download-a-directory-from-a-github-repository/download-a-directory-from-a-github-repository.html?owner=javascript-2020&repo=code-projects&branch=main&path=http-file-upload" style="display: block; margin-top: 10px; font-weight: bold;">
                <span style="color: blue;">
https:&#x2F;&#x2F;javascript-2020.github.io&#x2F;utils&#x2F;download-a-directory-from-a-github-repository&#x2F;download-a-directory-from-a-github-repository.html
                </span>
                <span style="color: green;">
?owner=javascript-2020&amp;repo=code-projects&amp;branch=main&amp;path=http-file-upload
                </span>
            </a>
            <a href="https://javascript-2020.github.io/utils/download-a-directory-from-a-github-repository/download-a-directory-from-a-github-repository.html?owner=javascript-2020&repo=code-projects&branch=main&path=http-file-upload&download" style="display: block; margin-top: 10px; font-weight: bold;">
                <span style="color: blue;">
https:&#x2F;&#x2F;javascript-2020.github.io&#x2F;utils&#x2F;download-a-directory-from-a-github-repository&#x2F;download-a-directory-from-a-github-repository.html
                </span>
                <span style="color: green;">
?owner=javascript-2020&amp;repo=code-projects&amp;branch=main&amp;path=http-file-upload&amp;download
                </span>
            </a>
        </div>
        <script style="display: none;">
window.onload=function(){

        var $           = sel=>document.querySelector(`.${sel}`);
        var params      = new URLSearchParams(window.location.search);
        var values      = {};
        
        if(values.owner    = params.get('owner')){
              $('owner').value   = values.owner;
        }
        
        if(values.repo   = params.get('repo')){
              $('repo').value    = values.repo;
        }
        
        if(values.branch   = params.get('branch')){
              $('branch').value    = values.branch;
        }
        
        if(values.path   = params.get('path')){
              $('path').value    = values.path;
        }
        
        
        if(params.has('download')){
              if(values.owner && values.repo && values.branch && values.path){
                    download();
              }
        }
        
}//onload
        </script>
        <script type="module" style="display: none;">
import jszip from 'https://cdn.jsdelivr.net/npm/jszip/+esm';
        
        window.download=async function(){
        
              var $         = sel=>document.querySelector(`.${sel}`).value;
              var owner     = $('owner');
              var repo      = $('repo');
              var branch    = $('branch');
              var path      = $('path');
              
              if(path.slice(-1)!='/')path+='/';
              var file    = `${path.split('/').filter(Boolean).at(-1)||repo}.zip`;
              var zip     = new jszip();
              
              var url     = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=true`;
              var json    = await fetch(url).then(res=>res.json());
              
              await Promise.all(json.tree.map(async item=>{
              
                    if(!item.path.startsWith(path))return;
                    
                    var fn    = item.path.slice(path.length);
                    if(item.type=='tree'){
                          zip.folder(fn);
                    }else{
                          var res     = await fetch(item.url);
                          var blob    = await res.blob();
                          zip.file(fn,blob);
                    }
                    
              }));
              
              zip.generateAsync({type:'blob'}).then(blob=>{
              
                    var url         = window.URL.createObjectURL(blob);
                    var a           = document.createElement('a');
                    a.href          = url;
                    a.download      = file;
                    a.click();
                    
              });
              
        }//download
        </script>
        <div>
        </div>
        <div style="margin-top: 50px;">
browser code
        </div>
        <code id="browser" style="white-space: pre; margin-top: 20px;">
&lt;script type=module&gt;

        import jszip from &#39;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;jszip&#x2F;+esm&#39;;
        var zip     = new jszip();

        var owner   = &#39;javascript-2020&#39;;
        var repo    = &#39;javascript-2020.github.io&#39;;
        var branch  = &#39;main&#39;;
        var path    = &#39;code-projects&#39;;
        
        if(path.slice(-1)!=&#39;&#x2F;&#39;)path+=&#39;&#x2F;&#39;;
        var file    = `${path.split(&#39;&#x2F;&#39;).filter(Boolean).at(-1)||repo}.zip`;

        var url     = `https:&#x2F;&#x2F;api.github.com&#x2F;repos&#x2F;${owner}&#x2F;${repo}&#x2F;git&#x2F;trees&#x2F;${branch}?recursive=true`;
        var json    = await fetch(url).then(res=&gt;res.json());
        
        await Promise.all(json.tree.map(async item=&gt;{
        
              if(!item.path.startsWith(path))return;
              
              var fn    = item.path.slice(path.length);
              if(item.type==&#39;tree&#39;){
                    zip.folder(fn);
              }else{
                    var res     = await fetch(item.url);
                    var blob    = await res.blob();
                    zip.file(fn,blob);
              }
              
        }));

        zip.generateAsync({type:&#39;blob&#39;}).then(blob=&gt;{
        
              var url       = window.URL.createObjectURL(blob);
              var a         = document.createElement(&#39;a&#39;);
              a.href        = url;
              a.download    = file;
              a.click();
              
        });

&lt;&#x2F;script&gt;
        </code>
        <div style="margin-top: 30px;">
node.js code
        </div>
        <code id="node-js" style="white-space: pre; margin-top: 20px;">
&#x2F;&#x2F;download-repo-dir.mjs

    import fs from &#39;fs&#39;;

    var owner   = &#39;javascript-2020&#39;;
    var repo    = &#39;javascript-2020.github.io&#39;;
    var branch  = &#39;main&#39;;
    var path    = &#39;code-projects&#39;;

    if(path.slice(-1)!=&#39;&#x2F;&#39;)path+=&#39;&#x2F;&#39;;
    var file    = `${path.split(&#39;&#x2F;&#39;).filter(Boolean).at(-1)||repo}&#x2F;`;
    fs.mkdirSync(file);

    var url     = `https:&#x2F;&#x2F;api.github.com&#x2F;repos&#x2F;${owner}&#x2F;${repo}&#x2F;git&#x2F;trees&#x2F;${branch}?recursive=true`;
    var json    = await fetch(url).then(res=&gt;res.json());

    await Promise.all(json.tree.map(async item=&gt;{

          if(!item.path.startsWith(path))return;

          var fn    = item.path.slice(path.length);
          if(item.type==&#39;tree&#39;){
                fs.mkdirSync(file+fn);
          }else{
                var res     = await fetch(item.url);
                var txt     = await res.text();
                fs.writeFileSync(file+fn,txt);
          }

    }));
        </code>
    </body>
</html>
