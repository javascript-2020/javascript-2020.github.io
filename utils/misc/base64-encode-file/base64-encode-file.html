


<html>

      <head>
      
            <title>base64 encode file</title>

            <base href='https://javascript-2020.github.io/utils/misc/base64-encode-file/base64-encode-file.html'>
            
            <link rel=icon type='image/png' href='image/base64-30.png'>
            <link rel=stylesheet href='/utils/css/utils.css'>
            
            <script init>
                                                                                console.clear();
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));
        var version       = 'v1.0';
            
        var df            = true;
        var debug_id      = 'base64-encode-file';
        
        var ext;
        var $;
        var datatype;
        var menumod;
        var keydown;
        
        var mod           = {};
        mod.menu          = {};
        //mod.utils         = {};
        
        var filemod;                                                                                
        var publish;
        var log;
        

  //:

              
        async function init(){
                                                                                debug('init',version);

              //keydown                   = keydown();
              menumod                   = menumod();
              //mod.utils.hdr             = mod.utils.hdr();
              //mod.menu.main             = mod.menu.main();
              preview.filemod           = filemod();
              output.filemod            = filemod();
              log                       = log();
              
              //mod.utils.hdr.initmod({ext,$,menu,menumod});
              //mod.menu.main.initmod({ext,$,menumod,editor,filemod});
              preview.filemod.initmod({ext,$,menumod,complete:preview.complete,source:preview.source});
              output.filemod.initmod({ext,$,menumod,complete:output.complete,source:output.source});
              log.initmod({ext,$});
              
              //mod.menu.main.init();
              //mod.utils.hdr.init();
              preview.filemod.init();
              output.filemod.init();
              log.init();

  //:
          
              menumod.on.close          = null;

              
              await initdom(document.body);


              init.complete();

              
        }//init


        init.stack            = [];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = '';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              init.stack.ct>=init.stack.total && init();
        }});
        
        //  (typeof init!='undefined' && init?.stack && init.stack.add)
        //  (typeof init!='undefined' && init?.stack && init.stack.complete)

        
        init.complete   = function(){
          
              init.complete.stack.forEach(fn=>fn());
              
        }//complete
        
        init.complete.stack   = [];
        init.complete.add     = fn=>init.complete.stack.push(fn);

                  

(async()=>{
  
        init.stack.add;
        
        var token   = localStorage['github-token'];
        var url;
        var headers;
        if(token){
              url       = 'https://api.github.com/repos/javascript-2020/ext-code/contents/ext-loader.js';
              headers   = {accept:'application/vnd.github.raw',authorization:`bearer ${token}`};
        }else{
              url       = 'https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js';
        }
        
        await fetch(url,{headers}).then(res=>res.text()).then(complete);

            
        async function complete(txt){

              ext           = eval(txt);
              var promise   = ext.load.libs(
                    'js/dom/$.js.api',
                    'js/core/datatype.js',
                    'js/dom/menumod/menumod.js',
                    'js/dom/keydown/keydown.js',
                    'js/debug/debug.js.api'
              );
              [$,datatype,menumod,keydown,debug]   = await promise;

              init.stack.complete;

        }//ext_fn

})();


            </script init>
        
      
      
      </head>
      
      
      <body>
      
            <style id=page-inline>
            
  html
    {height:100%}
  body
    {height:calc(100% - 40px);display:flex;flex-direction:column;gap:10px}


  .icon
    {border:1px solid gray;border-radius:3px;box-sizing:border-box;width:30px;height:30px;cursor:pointer}

  
  .user
    {}
  .user #btns
    {display:inline-flex;gap:10px}

    
  #preview
    {display:flex;flex-direction:column;gap:10px;border:1px solid lightgray;padding:10px}
    
  #preview-hdr
    {display:flex;align-items:center}

    
  #blob
    {display:flex;flex-direction:column;gap:10px;border:1px solid lightgray;padding:10px}
    
  #blob label
    {flex:1;display:inline-block;width:100px;text-align:right;margin-right:20px}


  #b64
    {white-space:pre-wrap;border:1px solid lightgray;padding:10px;flex:1;overflow:auto;word-break:break-all;font-family:monospace}    

  
  #output
    {display:flex;flex-direction:column;gap:10px;border:1px solid lightgray;padding:10px}
  #output-hdr
    {display:flex;align-items:center}
    

    
    
  input
    {font-size:16px;padding:5px 10px}
  input[type=button]
    {cursor:pointer}
    
            </style>
            
            
            <div id=hdr>

<!--                        
                  <main-menu-page>
                        <script src='https://html-loader-1024713184986.us-central1.run.app/'></script>
                  </main-menu-page>
-->                  

            </div>
            

            <div id=preview>

                  <div>
                        file
                  </div>
                  
                  <div class=user>
                  
                        <filemod api>
                              <script html-loader src='https://html-loader-1024713184986.us-central1.run.app/'></script>
                        </filemod>
      
                        <div id=btns>
                        
                              <input value=encode type=button>
                              <input value=save type=button>
                              
                        </div>
                        
                  </div>
                  
                  <filename-ui>
                        <script html-loader src='https://html-loader-1024713184986.us-central1.run.app/'></script>
                  </filename-ui>
                  
            </div>
            
            
            <div id=blob>
            
                  <section>
                  
                        <label>
                              size
                        </label>
                        
                        <div id=size>
                        </div>
                        
                  </section>
                  
            </div>

            
            <div id=b64>
            </div>
                  

            <div id=output>

                  <div>
                        base64
                  </div>
                        
                  <div class=user>
                  
                        <filemod api>
                              <script html-loader src='https://html-loader-1024713184986.us-central1.run.app/'></script>
                        </filemod>
                        
                        <div id=btns>
                        
                              <input value=decode type=button>
                              <input value=save type=button>
                              <input value=copy type=button>
                              <input value=paste type=button>
                              
                        </div>
                        
                  </div>
                        
                  <filename-ui>
                        <script html-loader src='https://html-loader-1024713184986.us-central1.run.app/'></script>
                  </filename-ui>
                  
            </div output>
                  
            
      </body>


      <log api>
            <script src='https://html-loader-1024713184986.us-central1.run.app/'></script>
      </log>
      
      
      <script>


      
        var cur           = {};
        cur.preview       = {};
        cur.output        = {};
        
        
        var preview       = {};
        var blob          = {};
        var b64           = {};
        var output        = {};
        
        var ui            = {};
        
        
        var btn           = {};
        btn.preview       = {};
        btn.output        = {};


  //:
  
  
        function initdom(rootnode){
          
          
              root                                            = rootnode;
        
        
              preview.root                                    = $(root,'#preview');
              
              preview.filemod.initdom(preview.root);
              
              preview.view                                    = $(preview.root,'#preview-view');
              
              $(preview.root,'[value=encode]').onclick        = btn.preview.encode;
              $(preview.root,'[value=save]').onclick          = btn.preview.save;
              
              
              blob.root                                       = $(root,'#blob');

              
              b64.root                                        = $(root,'#b64');
              
              
              output.root                                     = $(root,'#output');
              
              output.filemod.initdom(output.root);
              
              $(output.root,'[value=decode]').onclick         = btn.output.decode;
              $(output.root,'[value=save]').onclick           = btn.output.save;
              $(output.root,'[value=copy]').onclick           = btn.output.copy;
              $(output.root,'[value=paste').onclick           = btn.output.paste;
              
              output.view                                     = $(output.root,'#output-view');
              

              
              log.initdom(root);


              
              ui.info();
              
              
              
              
              
        }//initdom
        
        
  //:
  
  
        btn.preview.encode    = async function(){
          
              if(!cur.blob){
                    log.red('no file');
                    return;
              }

              
              cur.b64           = await encode(cur.blob);

              b64.textContent   = cur.b64;

              
        }//encode
        
        
        btn.preview.save    = function(){
          
              if(!cur.preview.file){
                    log.red('no file');
                    return;
              }
              
              preview.filemod.save(cur.preview.file);
              
        }//save
        
                
        btn.output.decode   = async function(){
          
              if(!cur.b64){
                    log.red('no base64 to decode');
                    return;
              }
              
              cur.blob    = decode(cur.b64);
              
              
        }//decode

        
        btn.output.save   = function(){
          
              if(!cur.output.file){
                    log.red('no output file');
                    return;
              }
              
              output.filemod.save(cur.output.file);
              
        }//save
        
        
        btn.output.copy   = async function(){
          
              if(!cur.b64){
                    log.red('no base64 to copy');
                    return;
              }
              
              var txt   = cur.b64;
                                                                                console.log(txt);
              await navigator.clipboard.writeText(txt);
              
        }//copy


        btn.output.paste    = async function(){
          
              var b64                   = await navigator.clipboard.readText();
              
              cur.b64                   = b64;
              
              output.view.textContent   = b64;
              
        }//paste
        
        
  //:
  

        async function encode(blob){
          
              var b64   = await blob_b64(cur.blob);
              return b64;
              
        }//encode
        
        
        function decode(b64){
          
              var blob    = b64_blob(b64);
              cur.blob    = blob;
              return blob;
              
        }//decode
        
        
  //:
  
  
        blob.info   = function(){
          
              var str   = '---';
              if(cur.blob){
                    str   = cur.blob.size;
              }
              $(blob,'#size').textContent                 = str;
              
        }//info
        
        
  //:
  
  
        preview.source    = function(){
          
              return cur.blob;
              
        }//source
        
        
        preview.complete    = {};
        
        preview.complete.load   = function(file,blob){
          
              menumod.close();
              
              cur.preview.file    = file;
              cur.blob    = blob;
        
              ui.info();
              
        }//load
        
        
        preview.complete.save   = function(file){
          
              cur.preview.file    = file;
              
              log.green(file.filename+' saved');
              
        }//save
        
        
        
        output.source   = function(){
          
              return cur.b64;
              
        }//source
        
        
        output.complete   = {};
        
        output.complete.load    = async function(file,blob){
          
              var b64   = await blob_b64(blob);
              
              cur.output.file    = file;
              cur.b64     = b64;
              
              output.view.textContent   = b64;
              
        }//load
        
        
        output.complete.save    = function(file,confirm=true){
          
              cur.output.file    = file;
              
              log.green(file.filename+' saved');
              
        }//save



  //:
  
  
     async function blob_b64(blob){
      
            var buf     = await blob.arrayBuffer();
            var bytes   = new Uint8Array(buf);
            var bin     = [...bytes].reduce((acc,byte)=>acc+=String.fromCharCode(byte),'');
            var b64     = btoa(bin);
            return b64;
      
      }//blob_b64

      function b64_blob(b64,type='text/plain'){
      
            var bin     = atob(b64);
            var bytes   = [...bin].map(c=>c.charCodeAt(0));
            var buf     = new Uint8Array(bytes);
            var blob    = new Blob([buf],{type});
            return blob;
            
      }//b64_blob

      function b64_dataurl(b64,type){
      
            var dataurl   = `data:${type};base64,${b64}`;
            return dataurl;
            
      }//b64_datauri
      
      function dataurl_b64(dataurl){
      
            var i     = dataurl.indexOf(',')+1;
            var b64   = dataurl.slice(i);
            return b64;
            
      }//datauri_b64  



  //:
  
  
  init.stack.complete;


      </script>      
</html>


