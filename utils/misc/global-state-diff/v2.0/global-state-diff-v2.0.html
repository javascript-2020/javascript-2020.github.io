


<!DOCTYPE html>


<html>

      <head>
            <meta charset=utf8>
            
            <title>
                  Global State Diff
            </title>
            
            <meta name=description content='Inspect what scripts and modules really expose. Enter a url and see global changes from script tags and explore actual exports from imports.'>
            
            <base href='https://ext-code.com/utils/misc/global-state-diff/global-state-diff.html'>
            <link rel=canonical href='https://ext-code.com/utils/misc/global-state-diff/global-state-diff.html'>
            
            <link rel=icon href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAB41BMVEVHcExEPzkoWIEtobIxrLcud5M+cYQtfJUrjKIqe5grgZ0upLMmTHsmS3cpu8MvpbMqZ4o4ZXwzkaQveJMsn7Aob48nf50qhZ8qnLAlVYIppLUsma0mW4YspLUlN2coYIYxo7EqgJwohKEoSnciGVMjKWMyoK8kMmQumaoytLstj6Q1mqg0sLoyr7kuiqAzq7coOGUqNmAmOmc6oqwqWYE2lacwrbcqc5IoiKItjKMvlqgpobIsZoQrhJsqhZ8pcpIoiKIqgJkqSHElPG0vjqMnYYguqrcoYIcnS3cndZcsaYgpjKQmWoQpgZwuobImOm8ogp8qe5ktqbcnWIImVH4ro7QlOGwrmq0tq7glOW0odpUlS3omQnQpaowqpbYnUXwrpbUkJV4gFE8iG1wjHFskMWgiG1gvtsAru8Mus7wttL4rYIcqf50raIswlKgrkKcpf5wtlqsvl6otjKEpaYkplKopZYUuZIImQ3Aqk6k1iJ0mQXErqLYrYIMpi6I0qbYlX4gkQ3EspLQslKkojKYlOGsskacrmKsrYoUmWoQpeJcnY4spgZ0xh54ro7UocpUofp0lU34sa4glWYYmaJAnpbcnm7Amf54ngqAniKMnjacnhaEleJojJ2YniaQoobQlXogCX05qAAAAk3RSTlMAAc3TZSwJVLbC0sveOf44OQMoFte59sXm7PjG9t6ruK7C92lApmg6OUFpF3hSNTAZDmoOayCEZ+hkcvojisuw9Ycpe6TW08zI9YTd2dq63fTO4Oi939De3NvQ2NKe8cPZZUz668x5neuix2fjZJa7yZ5NQnD6j0xP6E9h1aXNsfqm4sz2xr23SODZ6NN97OXs1pCs7VkWAAABjElEQVQoz2NgoBdgMxZyMmTDISls2dvO7SHvZS6MRZJRQFExcJps9BQuTvFiTOmO/gnyc6YlRE+Z1W5RWYQuaxMbZT8RIh3K4e1iiiorGKskMimEU1qh0V3cz5FJrFAQRdqpe2Zf/GSlOO5WyQApacnpEvoo0tULZobHTJ49Nch/8oypNT7T57OgSDvLODSHyShJuYXJBEi5uYtZm6FIGzHZucgxcTErgIj62kARHVTdC+aFRwINj4gEGh7hOn0+qu6KhpkSYLtB0syd0611UaQNXGfGyQf7igAN7wnlkJwugubxEt82r/guCW6Pbm9uW1EuK/TIKvOM8pkzTZZnyiyRutI8jGizERUT9QRJt3A45AthiU9HccVpTTxTODlttbHFN6NQlZV0iEk5KyPO9MLOjlUjPmnDNFV1CIu1wE4PwtJP1zGGSiclz001UlY2yc61nzGPw1JLTY2FJYuPDxZwKilzVdV5eXkFBMxzLLT0NDT4+fkz+TI0YUlFJdEA6gZWmLO1WTQFaZ1vAIUhYF6nuTxlAAAAAElFTkSuQmCC'>
            <meta name=viewport content='width=device-width, initial-scale=1'>
            
            <script type='application/ld+json'>
                  {
                        "@context"              : "https://schema.org",
                        "@type"                 : "SoftwareApplication",
                        "name"                  : "Global State Diff",
                        "url"                   : "https://ext-code.com/utils/misc/global-state-diff/global-state-diff.html",
                        "author"                : {"@type":"Person","name":"Matthew Richards"},
                        "description"           : "Inspect what scripts and modules really expose. Enter a url and see global changes from script tags and explore actual exports from imports.",
                        "applicationCategory"   : "DeveloperApplication",
                        "operatingSystem"       : "All",
                        "browserRequirements"   : "Requires JavaScript-enabled browser",
                        "softwareVersion"       : "2.0.0",
                        "offers"                : {"@type":"Offer","price":"0","priceCurrency":"GBP"}
                  }
            </script>
            
            
            <script src='https://javascript-2020.github.io/stackoverflow/libs/stringify.js'></script>
            
            
            <script src='https://libs.ext-code.com/js/dom/component/v3.0/component.js?hdr'></script>
            
            <script>
                                                                                console.log('global-state-diff.html');
        var version='v2.0';
        
        var inspect;
        
        var hdr;
        
        var detect;
        
        
        
  //:
  
  
        async function ready(){
                                                                                debug('ready',version);
                                                                                
              hdr   = mod['misc-hdr'];
              
              await Promise.all([
                    mod.auto(),
              ]);
              
              
              initdom();
              
              
        }//ready
        
        
            </script>
            
            
            <style>
            
            
  html
    {height:100%;font-family:arial}
  body
    {min-height:calc(100% - 40px);display:flex;flex-direction:column;gap:50px;margin:20px;align-items:center;
      padding-bottom:200px;
    }
  body>*
    {max-width:1400px;width:100%;padding:0 20px;}
    
    
  section
    {border:1px solid lightblue;padding:10px;border-radius:10px;display:flex;flex-direction:column}
  section>:not(:first-child)
    {margin-bottom:10px}
    
  h3
    {text-align:center;color:blue;margin:0}
    
  input
    {font-size:16px;padding:5px 10px;box-sizing:border-box}
  input[type=button]
    {cursor:pointer}
    
    
  .input
    {display:flex;align-items:center;gap:10px}
  .input > input
    {flex:1}
    
  .icon
    {border:1px solid gray;border-radius:3px;box-sizing:border-box;width:30px;height:30px;cursor:pointer}
    
  .paste
    {padding:2px;
      content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==);
    }
  .copy
    {padding:2px;
      content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAABSlBMVEVHcEwnz/4C8P4g1P4L6P43wf5Mr/4a2v4Y3P4/uv5PrP4+vf5Auv4ozv5KsP4vyv45wP5Jsf5Auf49vP5Mrv4zxf44wf5Lr/46wP4h1P5Lr/46vv5Jsv4R5P5Hs/5Etv44wf5Hs/41w/4uyv47vv49vP5Ftf5GtP4c2f4rzP4tyv4m0f5Etv5Nrv4xxv4xxv4xx/4W3/5KsP5Mr/4/u/4uyv5Isv4K6f4l0f4qzv4W3/4V3/5Nrv5Mrv5Mrv5Mr/4W3v4e2P5BuP5Hsv4N5v4K6f4O5v42w/5Dt/4E7/4uyf4C8P4nz/4M5/4K6v4oz/4P5f4k0v4b2v5Gs/4E7v4I6/5Nrf4e1/4H7P4E7v5Auv5Dtv4sy/5Isv5GtP4wx/49vP4zxf47vv44wP42w/5LsP5Jsf4i1P4n0P4N5v4k0v4a2v4S4v4X3v6OfcqkAAAAVnRSTlMACo7CjQWN/VczjgIJMfIXJzHtjj5iVekR71Hvtz7CjelXjre2wiJj2PCFIWbR7+fEnXaodz3544/USfOC22Tm7CXOnqfUZ+/3VTV9bsTzqGDahpb2tyRB6bIAAAIDSURBVDjLrZVpV9pAFIYntdFiQkZsLCQECtJSlqAsFRBU3Kuta1sncYGuJEDt///aISkkkyHo6enzLTlP5s5758wNAC526pd3d1++/fzx/evNze1tp210wxURUMTWBz2v2EWtLc7jBTPmoJfNrqy8i0ajixgB00VISJIeW9JMKbcWDAYDNiFMQN1EqAAJcUfSBif0fsQWQjLxpjGnXUJa5CoIbTiP8KJ0OqfNMLQIZhGad/Ke3t///vWwGKv1+yPxfW55+TnmJWZW5ggxcqX3m6WSVTpSdPcxHCLExmf97AI8e1j8cK1f8X9Fq/Sotrf0k2v9KRiJ08L8mwhf2CQx8oK/yJyPw3Q67ULaV4Tr7tRCwFfkllLF4ushccwGPyUMzwzhMQz/X1Kz+QVMmh2LcjgsTxDZ3OpqIpFYfDu+KGwoxE5JvTtpF9NX9BEB792jn0gD4eNEsVAQHyXOO7fQFmNNLZOnPV5BqEyI+Yxm1qkluS0BCWRp8FEze6mTJQtVVd8MUfcEhBSGFOGMOWmaoc0AmRoXP5cmiHEReEXANOopzCsLRYlXjWolGXE2jK/r/ujEWAdOFIxWGrjO8ljXazG6MeynthEn2gAP9P7B4XCE2thzdG2v2jbK5LfHZ3hINbclSco6o/kIh1Einq4e1qxp5m2PkqZ/CPvbXvFot+xe7w/EpaiUrJ24NAAAAABJRU5ErkJggg==);
    }
    
  #src, #src2
    {}
    
  #output, #output2
    {font-family:monospace;font-size:16px}
    
  #item
    {margin:20px 0;border:1px solid lightgray;padding:10px;
      /*display:flex;flex-direction:column;gap:10px*/
    }
    
    
  #item #values
    {display:grid;grid-template-columns:max-content max-content minmax(0, 1fr);gap:1rem 2rem}
  #item #values > *:nth-child(3)
    {min-width:0;overflow-wrap:break-word;word-break:break-word;}
    
  #item #name
    {font-weight:bold}
    
  #item #type
    {}
    
  #item #desc
    {line-height:1.4}
    
    
  #hdr
    {display:flex}
    
  #info
    {display:grid;grid-template-columns:max-content minmax(0, 1fr);gap:20px}
  #item > *:nth-child(2)
    {min-width:0;overflow-wrap:break-word;word-break:break-word;}
    
  #url
    {font-weight:bold;margin-top:0px;color:blue}
    
  #values
    {white-space:pre-wrap;margin-top:10px}
  #values.error
    {color:red}
    
  hr
    {margin:20px}
    
    
  .links
    {display:flex;flex-direction:column;gap:10px;text-align:right}
    
  a
    {color:#4a90e2;text-decoration:none;font-weight:500}
  a:hover
    {text-decoration:underline}
  .link-domain
    {font-size:0.85rem;color:#777;margin-left:0.25rem}
  .link-domain::before
    {content:'['}
  .link-domain::after
    {content:']'}
  .link-txt
    {}
  .no-underline
    {display:inline-block;text-decoration:none;color:black}
    
    
    
  .spc
    {flex:1}
    
  .close
    {width:20px;height:20px;cursor:pointer;
      content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAAmVBMVEVHcEzfLSLbNi3bNy7VRj7ZNy3eLiTdMijYNy7fQDfnU0nhPzb7j4b55eTf1t/rmpT/+ffoZFv/7uz+x8P9zMj9vbjnWU/+6ujfLCL/8/L//fzqe3PnXlXpbGT/3tz/5OH/5uT92NX8oZnpgHn9p5/+sqv+1ND/wr3vdm3/t7H+0MzrUUb+m5H+rKX+lIn+hHn+jYPgMCbnQDUSY6fgAAAAEHRSTlMA+UZHDDbxsibegbJOnwHMeI8KrAAAASFJREFUKM+10tt2gjAQBVDu0JslAhPQROTaFNpa/f+P6yRRAvjQJ8/rXknOmoxlPTye76zie0ajMLBXCcJoOhuegcsQQhgDGDGXc3g77weQ9EOafGSf3Xdbf/38nk7iEvhXdm1xqNY+2u6M73ycny7Rk0R7W0sXz97E+2N5GAjJpLcAyl8tw/RYViRn6B3k0OL94iWaMXoqPZMq3wfbMbzdagfUTvVjcy60szyHTPdfsvJBse5Ploze4+NM9UM3HD3VMTpWJ0NKrm5481bEcUF5TnrVj8j58BtvvPdqF8eU80r3JwnOd2LLsRvkmFLdvxrk/PmsWrOTXuj+pfqfFa/dsB8wapwqT2D6UFwm1ujsVYQQYJbpn1VUi+wusljkR+UPukUvOrcXXRAAAAAASUVORK5CYII=);
    }
    
  iframe
    {display:none}
    
            </style>
            
      </head>
      
      <body>
      
            <misc-hdr v2.0 component=grp>
                  <img slot=title src='images/global-state-diff.png' style='top:-5px;height:40px' alt=global-state-diff>
                  <div slot=version>
                        v2.0
                  </div>
                  <time slot=date datetime=2026-02-13>
                        13 Feb 2026
                  </time>
            </misc-hdr>
            
            
            <section id=script>
            
                  <h3>
                        global state diff
                        <div style='font-weight:normal;font-size:16px'>
                              &lt;script src=''&gt;&lt;/script&gt;
                        </div>
                  </h3>
                  
                  <div class=links>
                        <a href='https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/script' target=_blank>
                              &lt;script&gt;: The Script element
                              <span class=link-domain>
                                    developer.mozilla.org
                              </span>
                        </a>
                        <a href='https://developer.mozilla.org/en-US/docs/Web/API/HTMLScriptElement' target=_blank>
                              HTMLScriptElement
                              <span class=link-domain>
                                    developer.mozilla.org
                              </span>
                        </a>
                  </div>
                  
                  <div>
                        Analyze the impact of loading external JavaScript resources.  The tool compares the  global object
                        before and after execution to identify newly added globals to help developers understand what
                        a script exposes to the global scope.
                  </div>
                  
                  <div class=input>
                        <img class='copy icon'>
                        <img class='paste icon'>
                        <input id=src value='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.2.0/codemirror.min.js'>
                  </div>
                  
                  <input id=go value=fetch type=button>
                  
                  <div id=output>
                        <div id=item style='display:none'>
                              <div id=hdr>
                                    <h3 id=url>
                                    </h3>
                                    <div class=spc></div>
                                    <img class=close>
                              </div>
                              <div id=info>
                                    <div>
                                          headers
                                    </div>
                                    <div id=hdrs>
                                    </div>
                                    <div>
                                          detect
                                    </div>
                                    <div id=detect>
                                    </div>
                              </div>
                              <hr>
                              <div id=values>
                                    <div id=name>
                                    </div>
                                    <div id=type>
                                    </div>
                                    <div id=desc>
                                    </div>
                              </div>
                        </div>
                  </div>
                  
            </section>
            
            
            <section id=import>
            
                  <h3>
                        Import Inspector
                  </h3>
                  
                  <div class=links>
                        <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import' target=_blank>
                              import
                              <span class=link-domain>
                                    developer.mozilla.org
                              </span>
                        </a>
                        <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import' target=_blank>
                              import()
                              <span class=link-domain>
                                    developer.mozilla.org
                              </span>
                        </a>
                  </div>
                  
                  <div>
                     Import Inspector complements global state diff by allowing users to specify a module URL and inspecting its
                     exported bindings. It dynamically imports the module and lists all named and default exports, giving a
                     clear view of whatâ€™s available for consumption.
                  </div>
                  
                  <div class=input>
                        <img class='copy icon'>
                        <img class='paste icon'>
                        <input id=src2 value='https://cdn.jsdelivr.net/npm/codemirror/+esm'>
                  </div>
                  
                  
                  <input id=go2 value=fetch type=button>
                  
                  <div id=output2>
                  </div>
                  
            </section>
            
            
      </body>
      
      
      <script>
      
      
        var item;
        var ui        = {};
        
        
        var process   = {};
        var setup     = {};
        
        
  //:
  
  
        function initdom(){
                                                                                debug('initdom');
                                                                                
                                                                                
              $('#script .copy').onclick    = e=>navigator.clipboard.writeText(src.value);
              $('#script .paste').onclick   = async e=>{var txt=await navigator.clipboard.readText();src.value=txt};
              
              src.onkeydown                 = e=>e.key=='Enter' && process.script(src.value);
              //src.value                   = 'https://cdn.jsdelivr.net/npm/markdown-it-container@4.0.0/+esm';
              src.focus();
              
              item    = $('#item');
              item.remove();
              item.style.display            = '';
              
              var values                    = $(item,'#values');
              ui.name                       = $(values,'#name');
              ui.name.remove();
              ui.type                       = $(values,'#type');
              ui.type.remove();
              ui.desc                       = $(values,'#desc');
              ui.desc.remove();
              
              go.onclick                    = e=>process.script(src.value);
              
              
              $('#import .copy').onclick    = e=>navigator.clipboard.writeText(src2.value);
              $('#import .paste').onclick   = async e=>{var txt=await navigator.clipboard.readText();src2.value=txt};
              
              //src2.value    = 'https://unpkg.com/es-module-lexer?module';
              
              go2.onclick    = function(){
              
                    process.import(src2.value);
                    
              }//onclick
              
              
              
        }//initdom
        
        
  //:
  
  
        process.script    = async function(src){
                                                                                console.log('process.script',src);
              var nitem                     = display(output,src);
              var values                    = $(nitem,'#values');
              
              var {win,doc}                 = await niframe();
              setup.win(win,values);
              
              var beforeKeys                = new Set(Object.keys(win));
              
              var script                    = doc.createElement('script');
              script.src                    = src;
              doc.head.appendChild(script);
              
              
              script.onerror    = function(err){
                                                                          console.log('script.onerror');
                                                                          console.log(arguments);
                                                                          console.error(err);
                    values.textContent    = err.toString();
                    values.classList.add('error');
                    
              }//onerror
              
              
              script.onload   = function(){
                                                                          console.log('script.onload');
                                                                          console.log(arguments);
                    var afterKeys   = new Set(Object.keys(win));
                    var added       = [...afterKeys].filter(k=>!beforeKeys.has(k));
                                                                          //console.log('New globals :', added);
                    added.forEach(name=>{
                    
                          display.value(values,name,win[name]);
                          
                    });
                    
              }//onload
              
        }//script
        
        
        
        
        process.import    = async function(src){
                                                                                console.log('process.import');
              var nitem                     = display(output2,src);
              var values                    = $(nitem,'#values');
              
              var {win,doc}                 = await niframe();
              setup.win(win,values);
              
              var script    = document.createElement('script');
              script.textContent    = fnstr(fn);
              doc.head.append(script);
              
              //var js                        = fnstr(fn);
              //win.eval(js);
              
              var {mod,err}               = await win.fn(src);
              
              if(err){
                    display.error(values,err);
                    return;
              }
              
              if(mod===null || typeof mod!='object'){
                    display.mod(values,mod);
                    return;
              }
              
              for(var name in mod){
              
                    display.value(values,name,mod[name]);
                    
              }//for
              
              
              async function fn(src){
              
                    var err;
                    try{
                    
                          var mod   = await import(src);
                          
                    }//try
                    catch(err2){
                    
                          err   = err2;
                          
                    }//catch
                    if(err){
                                                                                console.error(err);
                          return {err};
                    }
                                                                                console.log(mod);
                    return {mod};
                    
              }//fn
              
        }//import
        
        
        
        
/*

                    var str   = '';
                    for(var key in mod){
                    
                          var value   = mod[key];
                          
                          var name    = key;
                          var type    = datatype(mod[key]);
                          var desc    = '';
                          
                          if(!mod[key]){
                                str  += key+`   [ ${typeof mod[key]} ]      :   ${s1}`+'\n';
                          }else{
                                if(datatype(mod[key])=='object'){
                                      s1    = tostring(mod[key]);
                                      str  += key+`   [ ${typeof mod[key]} ]      :   ${s1}`+'\n';
                                      for(var prop in mod[key]){
                                      
                                            var s2    = tostring(mod[key][prop]);
                                            str  += '      '+prop+`   [ ${typeof mod[key][prop]} ]      :   ${s2}`+'\n';
                                            
                                      }//for
                                }else{
                                      s1    = tostring(mod[key]);
                                      str  += key+`   [ ${typeof mod[key]} ]      :   ${s1}`+'\n';
                                }
                          }
                          
                    }//for
                    
                    output(str);
                    
*/



  //:
  
  
        function display(root,src){
        
              var nitem                     = item.cloneNode(true);
              
              $(nitem,'#url').textContent   = src;
              $(nitem,'.close').onclick     = e=>nitem.remove();
              root.append(nitem);
              
              display.info(nitem,src);
              
              return nitem;
              
        }//display
        
        
        display.info    = async function(nitem,src){
        
              var {txt,hdrs,error}   = await get(src);
              if(error)return;
              
              var str                         = await detect(txt);
              $(nitem,'#info #detect').textContent    = str;
              $(nitem,'#info #hdrs').textContent      = hdrs;
                                                                                console.log(str);
                                                                                
        }//info
        
        
        display.mod   = function(root,v){
        
              var str             = String(v);
              root.textContent    = str;
              
        }//mod
        
        
        display.value   = function(root,name,value){
        
              var nname           = ui.name.cloneNode(true);
              nname.textContent   = name;
              root.append(nname);
              
              var dtype           = datatype(value);
              var ntype           = ui.type.cloneNode(true);
              ntype.textContent   = dtype;
              root.append(ntype);
              
              var desc;
              if(value===null){
                    desc    = 'NULL';
              }else{
                    switch(dtype){
                    
                      case 'object'         : desc=display.value.object(value);       break;
                      case 'promise'        : desc='';                                break;
                      default               : desc=tostring(value);
                      
                    }//switch
              }
              var ndesc           = ui.desc.cloneNode(true);
              ndesc.textContent   = desc;
              root.append(ndesc);
              
        }//value
        
        
        display.value.object    = function(value){console.log(value);
        
              var desc    = '';
              for(var key in value){
              
                    var dtype   = datatype(value[key]);
                    desc       += `${key}:${dtype}, `;
                    
              }//for
              if(desc){
                    desc    = desc.slice(0,-2);
              }
              desc    = tostring(desc);
              return desc
              
        }//object
        
        
        display.error   = function(values,err){
        
              var error             = err.toString();
              values.textContent    = error;
              values.classList.add('error');
              
        }//error
        
        
  //:
  
  
        setup.win   = function(win,values){
        
              win.onerror       = function(message,source,lineno,colno,error){
                                                                                console.log('window.onerror');
                                                                                console.log(arguments);
                                                                                console.error('error',error);
                    values.textContent     = message;
                    values.classList.add('error');
                    
              }//onerror
              
              
              win.onunhandledrejection    = function(e){
                                                                                console.warn(`UNHANDLED PROMISE REJECTION: ${e.reason}`);
                                                                                console.log(arguments);
                    values.textContent     = e.reason;
                    values.classList.add('error');
                    
              }//onunhandledrejection
              
        }//win
        
        
        function niframe(){
        
              var resolve,promise=new Promise(res=>resolve=res);
              
              var iframe      = document.createElement('iframe');
              iframe.onload   = onload;
              document.body.append(iframe);
              
              return promise;
              
              
              function onload(){
              
                    var win   = iframe.contentWindow;
                    var doc   = iframe.contentDocument;
                    resolve({win,doc,iframe});
                    
              }//onload
              
        }//niframe
        
        
        function datatype(v,short=true){
        
              var str   = Object.prototype.toString.call(v);
              
              if(short){
                    str   = str.slice(8,-1);
                    str   = str.toLowerCase();
              }
              
              return str;
              
        }//datatype
        
        
        function tostring(v){
        
              var max   = 240;
              var s     = v.toString();
              var s1    = s.slice(0,max);
              if(s.length>s1.length){
                    s1   += ` ... ( ${s.length} )`;
              }
              return s1;
              
        }//tostring
        
        
        function fnstr(fn,full=true){
        
              var str   = fn.toString();
              
              if(full){
                    return str;
              }
              
              var i1        = str.indexOf('{');
              var i2        = str.lastIndexOf('}');
              var fnstr     = str.slice(i1+1,i2);
              return fnstr;
              
        }//fnstr
        
        
        async function get(url){
                                                                                console.log('get',url);
              var err;
              try{
              
                    var res   = await fetch(url);
                    
              }//try
              catch(err2){
              
                    err   = err2;
                    
              }//catch
              if(err){
                                                                                console.error(err);
                    var error   = err.toString();
                    return {error};
              }
              
              var hdrs    = '';
              for(var [key,value] of res.headers){
                                                                                console.log(key,value);
                    hdrs   += `${key}=${value}, `;
                    
              }//for
              if(hdrs){
                    hdrs    = hdrs.slice(0,-2);
              }
              
              var txt   = await res.text();
              if(!res.ok){
                    var error   = `[ ( ${res.status} ) ${res.statusText} ] ${txt}`;
                                                                                console.log(error);
                    return {error,hdrs};
              }
              
              return {txt,hdrs};
              
        }//get
        
        
        
        
        
!(async()=>{

        var {init,parse}    = await import('https://unpkg.com/es-module-lexer?module');
        
        detect    = async function(code){
        
              await init;
              
              var [imports,exports] = parse(code);
                                                                              console.log(imports,exports);
              var isESM         = imports.length>0 || exports.length>0;
              var isCommonJS    = /require\(|module\.exports|exports\./.test(code);
              
              var isNode        = /process\.|__dirname|require\(/.test(code);
              var isBrowser     = /window\.|document\.|navigator\./.test(code);
              
              
              var type      = [];
              if (isESM){
                    type.push('ESM');
              }
              if(isCommonJS){
                    type.push('CommonJS');
              }
              
              if(isNode){
                    type.push('Node.js');
              }
              if(isBrowser){
                    type.push('Browser');
              }
              type    = type.join(',')
              
              type  ||= 'unknown';
              return type;
              
        }//detect
        
})();


      </script>
      
      
      
</html>




