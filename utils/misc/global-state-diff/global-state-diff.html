


<!DOCTYPE html>


<html>

      <head>
            <title>
                  Global State Diff
            </title>
            
            
            
            <script src='https://javascript-2020.github.io/stackoverflow/libs/stringify.js'></script>            
            
            
            <style>

  html
    {font-family:arial}
  body
    {display:flex;flex-direction:column;gap:20px}
    
  input
    {font-size:16px;padding:5px 10px;box-sizing:border-box}
  input[type=button]
    {cursor:pointer}


  #output, #output2
    {white-space:pre;font-family:monospace}
  #item
    {margin:20px 0;border:1px solid lightgray;padding:10px;overflow:auto}
  #src
    {}
  #values
    {}


  iframe
    {display:none}
    
            </style>
            
      </head>
      
      <body>
      
              <h3>
                    global state diff
              </h3>
              
              <div>
                    Global State Diff is a browser-based utility that analyzes the impact of loading external JavaScript resources.
                    When a  tag is injected, the tool compares the  object before and after execution to identify newly added globals
                    ‚Äî including functions, variables, and namespaces. This helps developers understand what a script exposes to the
                    global scope.
              </div>
              <input id=src value='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.2.0/codemirror.min.js'>
              <input id=go value=go type=button>
              
              <div id=output>
                    <div id=item>
                          <div id=url>
                          </div>
                          <div id=values>
                          </div>
                    </div>
              </div>
              
              
              <script>
                                                                                console.clear();
        var item    = document.body.querySelector('#item');
        item.remove();
        
        go.onclick    = function(){
        
              process(src.value);
        
        }//onclick
        
        
        function process(src){
        
              
              var iframe    = document.createElement('iframe');
              iframe.onload   = onload;
              document.body.append(iframe);
        
              
              function onload(){
              
                    var win   = iframe.contentWindow;
                    var doc   = iframe.contentDocument;
                    
                    var beforeKeys    = new Set(Object.keys(win));
                
                    
                    var script    = document.createElement('script');
                    script.src    = src;
                    
                    script.onload   = ()=>{
                    
                          var afterKeys   = new Set(Object.keys(win));
                          var added       = [...afterKeys].filter(k=>!beforeKeys.has(k));
        
                          var str   = '';                          
                          added.forEach(key=>{
                          
                                var s     = win[key].toString();
                                var s1    = s.slice(0,80);
                                if(s.length>s1.length){
                                      s1   += ' ...';
                                }
                                str  += `window.${key}   [ ${typeof win[key]} ]   :   ${s1}`+'\n';
                                
                                console.log(`window.${key} =`,win[key]);
                                
                          });
                          
                          var nitem   = item.cloneNode(true);
                          var $   = nitem.querySelector.bind(nitem);
                          $('#url').textContent       = src;
                          $('#values').textContent    = str;
                          
                          output.append(nitem);
                          
                          
                          console.log('üîç New globals added by script:', added);
                          
                          
                    }//onload
                    
                    doc.head.appendChild(script);
                    
              }//onload
              
        }//process
                    
              </script>
              
              <h3>
                    Import Inspector
              </h3>
              
              <div>
                 Import Inspector complements this by allowing users to specify a module URL (via ) and inspecting its
                 exported bindings. It dynamically imports the module and lists all named and default exports, giving a
                 clear view of what‚Äôs available for consumption.
              </div>
              
              <input id=src2 value='https://cdn.jsdelivr.net/npm/codemirror/+esm'>
              <input id=go2 value=go type=button>
              
              <div id=output2>
                    <div id=item2>
                          <div id=url>
                          </div>
                          <div id=values>
                          </div>
                    </div>
              </div>

              <script>
              
        var item2    = document.body.querySelector('#item2');
        item2.remove();
        
        go2.onclick    = function(){
        
              process2(src2.value);
  
        }//onclick
        
        
        async function process2(src){
        
              var mod   = await import(src);
              var str   = '';
              for(var key in mod){
              
                    var s1    = '[ null ]';
                    if(mod[key]){
                          var s     = mod[key].toString();
                          s1        = s.slice(0,80);
                          if(s.length>s1.length){
                                s1   += ' ...';
                          }
                    }
                    str  += key+`   [ ${typeof mod[key]} ]      :   ${s1}`+'\n';
                    
              }//for
              
              
              var nitem   = item2.cloneNode(true);
              
              var $   = nitem.querySelector.bind(nitem);
              $('#url').textContent       = src;
              $('#values').textContent    = str;
              
              output2.append(nitem);
              
        }//process
                    
              </script>

              <script>
              
        var {init,parse}    = await import('https://unpkg.com/es-module-lexer?module');
        
        async function detect(code){
        
              await init();
          
              var [imports,exports] = parse(code);
          
              var isESM         = imports.length>0 || exports.length>0;
              var isCommonJS    = /require\(|module\.exports|exports\./.test(code);
              
              var isNode        = /process\.|__dirname|require\(/.test(code);
              var isBrowser     = /window\.|document\.|navigator\./.test(code);
          
              var type      = 'Unknown';
              if (isESM){
                    type    = 'ESM';
              }else if(isCommonJS){
                    type    = 'CommonJS';
              }
          
              if(isNode){
                    type   += ' (Node.js)';
              else if(isBrowser){
                    type   += ' (Browser)';
              }
          
              return type;
              
        }//detect
              
              </script>


      </body>
      
</html>




