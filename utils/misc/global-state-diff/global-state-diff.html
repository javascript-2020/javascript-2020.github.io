


<!DOCTYPE html>


<html>

      <head>
            <title>
                  Global State Diff
            </title>
            
            
            
            <script src='https://javascript-2020.github.io/stackoverflow/libs/stringify.js'></script>            
            

            <script init>
                                                                                console.clear();
                                                                                console.log('global-state-diff.html');
                                                                                console.log();
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));
            
      function $(css){return document.querySelector(css)}
      
      
            </script>
            
            
            
            <style>


  html
    {height:100%;font-family:arial}
  body
    {min-height:calc(100% - 40px);display:flex;flex-direction:column;gap:20px;margin:20px;align-items:center;
      padding-bottom:200px;
    }
  body>*
    {max-width:1400px;width:100%;padding:0 20px;}

    
  section
    {border:1px solid lightgray;padding:10px;border-radius:10px;display:flex;flex-direction:column;gap:20px}
    
  input
    {font-size:16px;padding:5px 10px;box-sizing:border-box}
  input[type=button]
    {cursor:pointer}


  .input
    {display:flex;align-items:center;gap:10px}
  .input > input
    {flex:1}
    
  .icon
    {border:1px solid gray;border-radius:3px;box-sizing:border-box;width:30px;height:30px;cursor:pointer}
    
  .paste
    {padding:2px;
      content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==);
    }
  .copy
    {padding:2px;
      content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAABSlBMVEVHcEwnz/4C8P4g1P4L6P43wf5Mr/4a2v4Y3P4/uv5PrP4+vf5Auv4ozv5KsP4vyv45wP5Jsf5Auf49vP5Mrv4zxf44wf5Lr/46wP4h1P5Lr/46vv5Jsv4R5P5Hs/5Etv44wf5Hs/41w/4uyv47vv49vP5Ftf5GtP4c2f4rzP4tyv4m0f5Etv5Nrv4xxv4xxv4xx/4W3/5KsP5Mr/4/u/4uyv5Isv4K6f4l0f4qzv4W3/4V3/5Nrv5Mrv5Mrv5Mr/4W3v4e2P5BuP5Hsv4N5v4K6f4O5v42w/5Dt/4E7/4uyf4C8P4nz/4M5/4K6v4oz/4P5f4k0v4b2v5Gs/4E7v4I6/5Nrf4e1/4H7P4E7v5Auv5Dtv4sy/5Isv5GtP4wx/49vP4zxf47vv44wP42w/5LsP5Jsf4i1P4n0P4N5v4k0v4a2v4S4v4X3v6OfcqkAAAAVnRSTlMACo7CjQWN/VczjgIJMfIXJzHtjj5iVekR71Hvtz7CjelXjre2wiJj2PCFIWbR7+fEnXaodz3544/USfOC22Tm7CXOnqfUZ+/3VTV9bsTzqGDahpb2tyRB6bIAAAIDSURBVDjLrZVpV9pAFIYntdFiQkZsLCQECtJSlqAsFRBU3Kuta1sncYGuJEDt///aISkkkyHo6enzLTlP5s5758wNAC526pd3d1++/fzx/evNze1tp210wxURUMTWBz2v2EWtLc7jBTPmoJfNrqy8i0ajixgB00VISJIeW9JMKbcWDAYDNiFMQN1EqAAJcUfSBif0fsQWQjLxpjGnXUJa5CoIbTiP8KJ0OqfNMLQIZhGad/Ke3t///vWwGKv1+yPxfW55+TnmJWZW5ggxcqX3m6WSVTpSdPcxHCLExmf97AI8e1j8cK1f8X9Fq/Sotrf0k2v9KRiJ08L8mwhf2CQx8oK/yJyPw3Q67ULaV4Tr7tRCwFfkllLF4ushccwGPyUMzwzhMQz/X1Kz+QVMmh2LcjgsTxDZ3OpqIpFYfDu+KGwoxE5JvTtpF9NX9BEB792jn0gD4eNEsVAQHyXOO7fQFmNNLZOnPV5BqEyI+Yxm1qkluS0BCWRp8FEze6mTJQtVVd8MUfcEhBSGFOGMOWmaoc0AmRoXP5cmiHEReEXANOopzCsLRYlXjWolGXE2jK/r/ujEWAdOFIxWGrjO8ljXazG6MeynthEn2gAP9P7B4XCE2thzdG2v2jbK5LfHZ3hINbclSco6o/kIh1Einq4e1qxp5m2PkqZ/CPvbXvFot+xe7w/EpaiUrJ24NAAAAABJRU5ErkJggg==);
    }


  #output, #output2
    {white-space:pre;font-family:monospace;font-size:16px}
  #item, #item2
    {margin:20px 0;border:1px solid lightgray;padding:10px;overflow:auto}
  #src
    {}
  #values
    {}


  iframe
    {display:none}
    
            </style>
            
      </head>
      
      <body>
      
            <section id=script>
            
                  <h3>
                        global state diff
                  </h3>
                  
                  <div>
                        Global State Diff is a browser-based utility that analyzes the impact of loading external JavaScript resources.
                        When a  tag is injected, the tool compares the  object before and after execution to identify newly added globals
                        ‚Äî including functions, variables, and namespaces. This helps developers understand what a script exposes to the
                        global scope.
                  </div>
                  
                  <div class=input>
                        <img class='paste icon'>
                        <img class='copy icon'>
                        <input id=src value='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.2.0/codemirror.min.js'>
                  </div>
                  
                  <input id=go value=fetch type=button>
                  
                  <div id=output>
                        <div id=item>
                              <div id=url>
                              </div>
                              <div id=values>
                              </div>
                        </div>
                  </div>
                  
            </section>
              
              
            <script>

        $('#script .paste').onclick   = async e=>{var txt=await navigator.clipboard.readText();src.value=txt};
        $('#script .copy').onclick    = e=>navigator.clipboard.writeText(src.value);
                                                                                
        var item    = $('#item');
        item.remove();
        
        go.onclick    = function(){
        
              process(src.value);
        
        }//onclick
        
        
        function process(src){
        
              
              var iframe    = document.createElement('iframe');
              iframe.onload   = onload;
              document.body.append(iframe);
        
              
              function onload(){
              
                    var win   = iframe.contentWindow;
                    var doc   = iframe.contentDocument;
                    
                    var beforeKeys    = new Set(Object.keys(win));
                
                    
                    var script    = document.createElement('script');
                    script.src    = src;
                    
                    script.onload   = ()=>{
                    
                          var afterKeys   = new Set(Object.keys(win));
                          var added       = [...afterKeys].filter(k=>!beforeKeys.has(k));
        
                          var str   = '';                          
                          added.forEach(key=>{
                          
                                var s     = win[key].toString();
                                var s1    = s.slice(0,80);
                                if(s.length>s1.length){
                                      s1   += ' ...';
                                }
                                str  += `window.${key}   [ ${typeof win[key]} ]   :   ${s1}`+'\n';
                                
                                console.log(`window.${key} =`,win[key]);
                                
                          });
                          
                          var nitem   = item.cloneNode(true);
                          var $   = nitem.querySelector.bind(nitem);
                          $('#url').textContent       = src;
                          $('#values').textContent    = str;
                          
                          output.append(nitem);
                          
                          
                          console.log('üîç New globals added by script:', added);
                          
                          
                    }//onload
                    
                    doc.head.appendChild(script);
                    
              }//onload
              
        }//process
                    
            </script>
              
              
            <section id=import>
            
                  <h3>
                        Import Inspector
                  </h3>
                  
                  <div>
                     Import Inspector complements this by allowing users to specify a module URL (via ) and inspecting its
                     exported bindings. It dynamically imports the module and lists all named and default exports, giving a
                     clear view of what‚Äôs available for consumption.
                  </div>
                  
                  <div class=input>
                        <img class='paste icon'>
                        <img class='copy icon'>
                        <input id=src2 value='https://cdn.jsdelivr.net/npm/codemirror/+esm'>
                  </div>
                  
                  
                  <input id=go2 value=fetch type=button>
                  
                  <div id=output2>
                        <div id=item2>
                              <div id=url>
                              </div>
                              <div id=values>
                              </div>
                        </div>
                  </div>
                  
            </section>

            <script>

        $('#import .paste').onclick   = async e=>{var txt=await navigator.clipboard.readText();src2.value=txt};
        $('#import .copy').onclick    = e=>navigator.clipboard.writeText(src2.value);
        
        var item2    = $('#item2');
        item2.remove();
        
        go2.onclick    = function(){
        
              process2(src2.value);
  
        }//onclick
        
        
        async function process2(src){
        
              var mod   = await import(src);
              var str   = '';
              for(var key in mod){
              
                    var s1    = '[ null ]';
                    if(mod[key]){
                          var s     = mod[key].toString();
                          s1        = s.slice(0,80);
                          if(s.length>s1.length){
                                s1   += ' ...';
                          }
                    }
                    str  += key+`   [ ${typeof mod[key]} ]      :   ${s1}`+'\n';
                    
              }//for
              
              
              var nitem   = item2.cloneNode(true);
              
              var $   = nitem.querySelector.bind(nitem);
              $('#url').textContent       = src;
              $('#values').textContent    = str;
              
              output2.append(nitem);
              
        }//process
                    
              </script>

              <script>

        var detect;

(async()=>{

        var {init,parse}    = await import('https://unpkg.com/es-module-lexer?module');
        
        detect    = async function(code){
        
              await init();
          
              var [imports,exports] = parse(code);
          
              var isESM         = imports.length>0 || exports.length>0;
              var isCommonJS    = /require\(|module\.exports|exports\./.test(code);
              
              var isNode        = /process\.|__dirname|require\(/.test(code);
              var isBrowser     = /window\.|document\.|navigator\./.test(code);
          
              var type      = 'Unknown';
              if (isESM){
                    type    = 'ESM';
              }else if(isCommonJS){
                    type    = 'CommonJS';
              }
          
              if(isNode){
                    type   += ' (Node.js)';
              }else if(isBrowser){
                    type   += ' (Browser)';
              }
          
              return type;
              
        }//detect

})();              


            </script>


      </body>
      
</html>




