


<html>

      <head>
      
      
            <title>html-editor</title>

            <base href='https://javascript-2020.github.io/utils/editors/html-editor/html-editor.html'>
            
            <link rel=icon type='image/png' href='images/html-editor-favicon.png'>
            <link rel=stylesheet href='/utils/css/utils.css'>
            
            <script init>
                                                                                console.clear();
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));
        var version       = 'v1.0';
            
        var df            = true;


        var ext;
        var $;
        var datatype;
        var menumod;
        var keydown;
        
        var mod           = {};
        //mod.menu          = {};
        //mod.utils         = {};
        
        var filemod;                                                                                
        //var publish;
        //var editor;
        //var output;
        var log;
        

  //:

              
        async function init(){
                                                                                debug('init',version);

              //keydown                   = keydown();
              menumod                   = menumod();
              //mod.utils.hdr             = mod.utils.hdr();
              //mod.menu.main             = mod.menu.main();
              filemod                     = mod.filemod();
              //publish                   = publish();
              //editor                    = editor();
              //output                    = output();
              log                         = mod.log();
              
              //mod.utils.hdr.initmod({ext,$,menu,menumod});
              //mod.menu.main.initmod({ext,$,menumod,editor,filemod});
              filemod.initmod({ext,$,menumod,source,complete});
              //publish.initmod({ext,$,menumod,run});
              //editor.initmod({ext,$,menumod});
              //output.initmod({ext,$});
              log.initmod({ext,$});
              
              //mod.menu.main.init();
              //mod.utils.hdr.init();
              //filemod.init();
              //publish.init();
              //editor.init();
              //output.init();
              log.init();

  //:
          
              //window.onfocus            = focus;
              //keydown.add(kd);
              //menumod.on.close          = focus;

              
              await initdom(document.body);


              init.complete();

              
        }//init


        init.stack            = [];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = '';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              init.stack.ct>=init.stack.total && init();
        }});
        
        //  (typeof init!='undefined' && init?.stack && init.stack.add)
        //  (typeof init!='undefined' && init?.stack && init.stack.complete)

        
        init.complete   = function(){
          
              init.complete.stack.forEach(fn=>fn());
              
        }//complete
        
        init.complete.stack   = [];
        init.complete.add     = fn=>init.complete.stack.push(fn);

                  

(async()=>{
  
        init.stack.add;
        
        var token   = localStorage['github-token'];
        var url;
        var headers;
        if(token){
              url       = 'https://api.github.com/repos/javascript-2020/ext-code/contents/ext-loader.js';
              headers   = {accept:'application/vnd.github.raw',authorization:`bearer ${token}`};
        }else{
              url       = 'https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js';
        }
        
        await fetch(url,{headers}).then(res=>res.text()).then(complete);

            
        async function complete(txt){

              ext           = eval(txt);
              var promise   = ext.load.libs(
                    'js/dom/$.js.api',
                    'js/core/datatype.js',
                    'js/dom/menumod/menumod.js',
                    'js/dom/keydown/keydown.js'
              );
              [$,datatype,menumod,keydown,encrypt]   = await promise;

              init.stack.complete;

        }//ext_fn

})();


            </script init>
            
      
      </head>
      
      
      <body>
      
            <style>

  html
    {height:100%}
  body
    {height:calc(100% - 40px);margin:20px}

            
  #url-root
    {display:flex;gap:20px}
  #url
    {flex:1}
    
    
            </style>
            
            
            <div id=url-root>
            
                  <div>
                        url
                  </div>
                  
                  <input id=url>
                  
            </div>

            <div id=btns>
                  <input value=fetch type=button>
            </div>
            
            <div>

                  <filemod api>
                        <script src='https://html-loader-1024713184986.us-central1.run.app/'></script>
                  </filemod>

            </div>
            
            <div id=output>
            
                  <div id=header>
                        <div id=hdr>
                              <div id=hdr-name>
                                    content-type
                              </div>
                              <div id=hdr-value>
                              </div>
                        </div>
                  </div>
                  
                  <section>
                        <div>
                              filename
                        </div>
                        <div id=filename>
                              ---
                        </div>
                  </section>
                  
                  <section>
                        <div>
                              size
                        </div>
                        <div id=size>
                              ---
                        </div>
                  </section>
                        
            </div>
            
      </body>
      
      <script>



      
        var cur           = {};

        
        var hdrs          = {};
        
        
        var btn           = {};
      

  //:
  
  
        function initdom(rootnode){
          
              root                                  = rootnode;
              
              
              $(root,'[value=fetch]').onclick       = btn.fetch;
          

              hdrs.root                             = $(root,'#headers');
              
              hdrs.item                             = $(hdrs.root,'#hdr');
              hdrs.item.remove();

          
        }//initdom
        

  //:
  
  
        btn.fetch   = function(){
          
              var url         = $(root,'#url').value;
              
              var i           = url.lastIndexOf('/');
              var filename    = url.slice(i+1);
              
              var res         = await fetch(url);
              var blob        = await res.blob();
              
              cur.blob        = blob;
              
              display(url,res,blob);
              
              log.green(filename+' downloaded');

              
        }//fetch


  //:
  
  
        function source(){
          
              return cur.blob;
              
        }//source

  
        function complete(){
        }//complete
        
        
        complete.save   = function(file){
        }//save
        

  //:
  
  
        function display(url,res,blob){
  
              display.hdrs(res);
              
        }//display
        
        
        display.headers   = function(res){
          
              hdrs.root.replaceChildren();
              
              for(var [name,value] of res.headers){
                
                    console.log(name,value);
                    
              }//for
              
        }//headers




  //:
  
  
  init.stack.complete;
        
      </script>
      
</html>



