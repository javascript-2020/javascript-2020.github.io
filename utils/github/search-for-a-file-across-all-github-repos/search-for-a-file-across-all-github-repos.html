


<html>

      <head>
      
            <style>

  html
    {height:100%;font-family:arial}
  body
    {height:calc(100% - 40px);margin:20px;display:flex;flex-direction:column;gap:20px}
    
  #title
    {margin-bottom:10px}
  #desc
    {}
    
  #field
    {display:flex;gap:20px;align-items:center}
  #label
    {width:70px;text-align:right}
  #field input
    {flex:1}
    
  #type
    {display:flex;gap:20px}
  #type>div
    {display:flex;align-items:center}
    
  #type [type=checkbox]
    {width:20px;height:20px;margin-left:10px}
    
  [value=search]
    {padding:5px 20px}
    
  #results
    {flex:1;border:1px solid lightgray;padding:10px;overflow:auto;border-radius:10px}
  #item
    {}
  #spinner
    {}
    
  input
    {font-size:16px;padding:5px 10px}
  [type=button],[type=checkbox]
    {cursor:pointer}
    
            </style>
            
      </head>
      
      
      <body>
    
    
            <div id=hdr>
                  <div id=title>
                        github file search
                  </div>
                  
                  <div id=desc>
                        search for a file across all github repos
                  </div>
            </div>
            
            <div id=field>
                  <span id=label>
                        username
                  </span>
                  <input id=username>
            </div>
            
            <div id=field>
                  <span id=label>
                        search
                  </span>
                  <input id=search>
            </div>
            
            <div id=type>
            
                  <span id=label></span>
                  
                  <input value=search type=button>
                  <div>
                        plain
                        <input id=plain type=checkbox>
                  </div>
                  <div>
                        wildcard
                        <input id=wildcard type=checkbox>
                  </div>
                  <div>
                        regex
                        <input id=regex type=checkbox>
                  </div>
            </div>

            <div id=results>
                  <div id=item>
                        <span id=filename></span>
                  </div>
            </div>
                  
      </body>
      
      
      <script>
      
      
        window.onload   = init;

        var ext;
        var $;
        var datatype;
        var github;
        
        
        async function init(){
        
              await libs();
        
              initdom(document.body);
              
              
        }//init
        
        
  //:
  
  
        var username;
        var search;
        var type;
        var chk   = {};
        var results;
        var item;
        var spinner;
        
        var node      = {};
        
        var btn       = {};
        var create    = {};
        var fn        = {};
        
  
        function initdom(rootnode){
        
        
              username    = $('#username');
              
              search      = $('#search');
              
              $('[value=search]').onclick       = btn.search;
              
              
              chk.plain                         = $('#plain');
              chk.plain.onclick                 = btn.plain;
              
              chk.wildcard                      = $('#wildcard');
              chk.wildcard.onclick              = btn.wildcard;
              
              chk.regex                         = $('#regex');
              chk.regex.onclick                 = btn.regex;
              
              
              results                           = $('#results');
              node.item                         = $('#item');
              node.item.remove();
              spinner                           = $('#spinner');
              spinner.remove();
              
        }//initdom
        
        
  //:
  
  
        btn.search    = function(){
        
              var params    = {
                    username    : username.value,
                    search      : search.value,
                    type,
              };
              fn.search(params);
              
        }//search
        
        
        btn.plain   = function(){
        
              type                    = 'plain';
              
              chk.plain.checked       = true;
              chk.wildcard.checked    = false;
              chk.regex.checked       = false;
              
        }//plain


        btn.wildcard    = function(){
        
              type                    = 'wildcard';
              
              chk.plain.checked       = false;
              chk.wildcard.checked    = true;
              chk.regex.checked       = false;
        
        }//wildcard
        
        
        btn.regex   = function(){

              type                    = 'regex';
              
              chk.plain.checked       = false;
              chk.wildcard.checked    = false;
              chk.regex.checked       = true;
        
        }//regex
        

  //:
  
  
        create.item   = function(item){
        
              var nitem   = node.item.cloneNode(true);
              
              $(nitem,'#filename').textContent    = item.name;
              
              results.append(nitem);
              
        }//create.item
        
        
  //:
  
  
        fn.search   = async function({username,search,type}){
        
              var owner   = username;
              
              var {list,error}    = await github.user.repolist({owner});
              if(error){
                                                                                console.log(error);
                    return;
              }

              list.forEach(repo=>{
              
                    var {branch,error}    = await github.repo.default({owner,repo,token});
                    var {tree,error}      = await github.repo.tree({owner,repo,branch,token});
                    
                    tree.forEach(item=>{
                    
                          var i           = item.path.lastIndexOf('/');
                          var name        = item.path.slice(i+1);
                          
                          switch(type){
                          
                            case 'plain'      : if(plain(name,search))create.item(item);          break;
                            case 'wildcard'   : if(wildcard(name,search))create.item(item);       break;
                            case 'regex'      : if(regex(name,search))create.item(item);          break;
                            
                          }//switch
                    
                    });
                    
              });
        
        }//search
        
        
  //:
  
  
        async function libs(){
        
              var res   = await fetch('https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js');
              var txt   = await res.text();
              ext       = eval(txt);
              
              var promise   = ext.load.libs(
                    'js/dom/$.js',
                    'js/core/datatype.js',
                    'github/github.js.api',
              );
              [$,datatype,github]   = await promise;
              
        }//libs
        
        
        
        
        
      </script>
      
      
</html>