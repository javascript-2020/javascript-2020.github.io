



<html>

      <head>
    
            <base href='https://javascript-2020.github.io/utils/github/download-a-directory-from-a-github-repository/'>
            <link rel='shortcut icon' type='image/x-icon' href='images/favicon.ico'>
            
            <title>download github directory</title>
            
            <style>
        
        html
              {font-family:arial}
        body
              {height:calc(100% - 16px)}


        #scroll
              {margin-top:50px}
              
        #values 
              {display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:center}
        [value=download]
              {margin-top:20px;width:150px}
              
              
              
        input 
              {font-size:16px;padding:5px 10px}
        input[type=button]
              {cursor:pointer}
        
        
            </style>
        
        
            <script>
                                                                                console.clear();
                                                                                console.log('html-editor');
                                                                                console.log();
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));
        var mod     = {};
        mod.menu    = {};
        mod.utils   = {};

        
        var JSZip
        ;
        
        var $,datatype,menumod,keydown
        ;
        

        var log;
        
        
        var menu        = {};
        var btn         = {};
        
  //:
        
        async function init(){
                                                                      console.log('init');
        
              menumod                   = menumod();
              mod.utils.hdr             = mod.utils.hdr();
              log                       = log();
              
              mod.utils.hdr.initmod({menu,menumod});
              log.initmod({});
              
              mod.utils.hdr.init();
              log.init();
        
  //:
          
              //keydown.add(kd);
              menumod.on.close          = ()=>{};
        
              
              await initdom(document.body);
        
        
              init.complete();
        
              
        }//init
        
        
        init.stack            = [];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = 'log';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              init.stack.ct>=init.stack.total && init();
        }});
        
        //  (typeof init!='undefined' && init?.stack && init.stack.add)
        //  (typeof init!='undefined' && init?.stack && init.stack.complete)
        
        
        init.complete   = function(){
          
              init.complete.stack.forEach(fn=>fn());
              
        }//complete
        
        init.complete.stack   = [];
        init.complete.add     = fn=>init.complete.stack.push(fn);

                  
            </script>

            <script libs>

(async()=>{
  

        init.stack.add;
        init.stack.add;
        
        var ext;
        
        fetch('https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js')
          .then(res=>res.text().then(async txt=>{
        
              ext           = eval(txt);
              var promise   = ext.load.libs(
                    'js/dom/$.js',
                    'js/core/datatype.js',
                    'js/dom/menumod/menumod.js',
                    'js/dom/keydown/keydown.js',
                    'github/github.js'
              );
              [$,datatype,menumod,keydown,github]   = await promise;
        
              init.stack.complete;
        
          }));


        JSZip   = (await import('https://cdn.jsdelivr.net/npm/jszip/+esm')).default;

        
        init.stack.complete;

})();

            </script>





      </head>
    
      <body>
    
            <hdr-grp-api>
                  <script src='https://html-loader-1024713184986.us-central1.run.app/'></script>
                  <img style='top:0px;height:40px' class=title src='images/download-a-directory-from-a-github-repository.png'>
                  <span slot=date>01 May 2025</span>
            </hdr-grp-api>

        
            <div id=scroll>
            
                  <div id=center>
                  
                        <section>
                        
                              <div id=parse style='margin-bottom: 40px'>
                                  <div style='margin-bottom: 10px'>
                                      parse url
                                      <span style='margin-left: 20px'>
                                            ex :
                                      </span>
                                      <span style='margin-left: 10px'>
                                            https:&#x2F;&#x2F;github.com &#x2F; owner &#x2F; repo &#x2F; tree &#x2F; branch &#x2F; path
                                      </span>
                                  </div>
                                  
                                  <div style='display: flex; align-items: center'>
                                      <img id=url-paste style='width: 30px; height: 30px; cursor: pointer; margin-right: 10px' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAYxJREFUOE/NlLFKw1AUhs9thDSSNhYEC1LIdWj2bl07OPcJxMUXMFsHjUsXrdBdB3HwARxLwIIQXJxcUooHbCOEutRKh9AYucXGtknTGhw8Y3Lud89//stP4I+LRPEopdb3/31EbKxydyhQluVjQoiaTCZTPM9Dv98Hz/M0nufPTdMcRIF9oKIoKcdx3ifNHMeBJEkgiiJYlgWu605zsohoh4F9IJsqs+5pp+UeHNxsgSAIQMiPgOFwCGflHjTbAtw+ia+IuL0UmE1/asbhyxgYVuyyq4c01JuZ3wGjdlS/2/hnQNcDePvg/KEvDQkuDMkejUYF9rHT6TBzfMdmTJnscFry3nUW7p+FqC00EHF30rAUuHNCoVqtQrFYDEANw4BKpQKI6HNWBtZqtQBQVdX4QNM0A0BFUeIDmbT5YquILXmRK7GBsSZcSxBtU5wJAbAH3NjlfD4fGLLVai2WzLpZQMyfIoQclUqlRC6XCwC73S7ouh7+bBbtiFLKkuIx4mUXpqMsMrFXSej5ni+XXuAVg6oGswAAAABJRU5ErkJggg=='>
                                      <input id=url style='flex: 1 1 0%'>
                                      <input id='parse' style='cursor: pointer; font-size: 16px; box-sizing: border-box; min-width: 60px; margin-left: 10px' type=button value=parse>
                                  </div>
                                  
                              </div>
                            
                            <div id=values>
                            
                                <div>
                                      owner
                                </div>
                                <input class=owner>
                                
                                <div>
                                      repo
                                </div>
                                <input class=repo>
                                
                                <div>
                                      branch
                                </div>
                                <input class=branch>
                                
                                <div>
                                      path
                                </div>
                                <input class=path>
                                
                            </div values>
                            
                            <input value=download type=button>
                            
                        </section>
      
                      
                  </div center>
                
                
                
            </div scroll>



        
            <script>
        
        
        
        function initdom(){

                                                                                console.log('*** initdom');
              mod.utils.hdr.initdom();

                
              $('#url-paste').onclick           = btn.paste;
              
              $('[value=parse]').onclick        = btn.parse;
              
              $('[value=download]').onclick     = btn.download;


              
        }//initdom
                
                
  //:
  
  
        btn.paste   = async function(){
              
              var url           = await navigator.clipboard.readText();
              $('#url').value   = url;
              
        }//paste          


        btn.parse   = function(){
              
              var url               = $('#url').value;
              var result            = github.parse(url);
                                                                                console.json(result);
              $('.owner').value     = result.owner;
              $('.repo').value      = result.repo;
              $('.branch').value    = result.branch;
              $('.path').value      = result.path;
                    
        }//parse


        btn.download    = function(){
          
              var owner     = $('.owner');
              var repo      = $('.repo');
              var branch    = $('.branch');
              var path      = $('.path');

          
              download(owner,repo,branch,path);
              
              
        }//download
        
        
  //:
  
  
        async function download(owner,repo,branch,path){
        
              
              if(path.slice(-1)!='/')path+='/';
              
              var file    = `${path.split('/').filter(Boolean).at(-1)||repo}.zip`;
              
              var zip     = new JSZip();
              
              var url     = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=true`;
              var json    = await fetch(url).then(res=>res.json());
              
              await Promise.all(json.tree.map(async item=>{
              
                    if(!item.path.startsWith(path))return;
                    
                    var fn    = item.path.slice(path.length);
                    if(item.type=='tree'){
                          zip.folder(fn);
                    }else{
                          var res     = await fetch(item.url);
                          var blob    = await res.blob();
                          zip.file(fn,blob);
                    }
                    
              }));
              
              zip.generateAsync({type:'blob'}).then(blob=>{
              
                    var url         = window.URL.createObjectURL(blob);
                    var a           = document.createElement('a');
                    a.href          = url;
                    a.download      = file;
                    a.click();
                    
              });
              
        }//download




        init.stack.complete;
        
        
            </script>
        

<!-- components -->

<log-api>
      <script html-loader src='https://html-loader-1024713184986.us-central1.run.app/'></script>
</log-api>
        
<!-- components -->


    </body>
</html>



