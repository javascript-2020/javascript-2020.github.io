<style>
    body {
          display                 : flex;
          flex-direction          : column;
          font-family             : arial;
    }
    h3 {
      margin:0;
    }
    section {
          display                 : grid;
          grid-template-columns   : auto 1fr;
          gap                     : 10px;
          align-items             : center;
          margin                  : 5px;
    }
    input {
          font-size               : 16px;
          padding                 : 5px;
    }
    button {
          cursor                  : pointer;
          width                   : 300px;
          font-size               : 16px;
          padding                 : 5px 10px;
    }
    #output {
          display                 : none;
          font-size               : 16px;
    }
</style>

<h3>download a directory from a GitHub repository</h3>

<section>
      <div>owner</div><input class=owner>
      <div>repo</div><input class=repo>
      <div>path</div><input class=path>
</section>

<button onclick=download()>download</button>

<pre id=output></pre>
<!--
javascript-2020
javascript-2020.github.io
code-projects
-->


<script type=module>

        import jszip from 'https://cdn.jsdelivr.net/npm/jszip/+esm';
        var $   = sel=>document.querySelector(`.${sel}`).value;
        
        window.download=async function(){
        
              var owner   = $('owner');
              var repo    = $('repo');
              var path    = $('path');
              
              if(path.slice(-1)!='/')path+='/';
              var file    = `${path.split('/').filter(Boolean).at(-1)||repo}.zip`;
      
              
              var zip   = new jszip();
      
      
              var url     = `https://api.github.com/repos/${owner}/${repo}/git/trees/main?recursive=true`;
              var json    = await fetch(url).then(res=>res.json());
              
              await Promise.all(json.tree.map(async item=>{
              
                    if(!item.path.startsWith(path))return;
                    
                    var fn    = item.path.slice(path.length);
                    if(item.type=='tree'){
                          zip.folder(fn);
                    }else{
                          var res     = await fetch(item.url);
                          var blob    = await res.blob();
                          zip.file(fn,blob);
                    }
                    
              }));
      
              
              zip.generateAsync({type:'blob'}).then(blob=>{
              
                    output.style.display    = 'block';
                    output.append('** stackoverflow downloads disabled **\n');
                    
                    var url         = window.URL.createObjectURL(blob);
                    var a           = document.createElement('a');
                    a.href          = url;
                    a.download      = file;
                    a.textContent   = file+' ( right-click, save link as )';
                    output.append(a,'\n');
                    
              });
              
        }//download

</script>



