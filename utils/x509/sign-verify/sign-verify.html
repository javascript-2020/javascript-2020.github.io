




<html>

    <head>
    
        <title>sign/verify file</title>
        
        <base href='https://javascript-2020.github.io/utils/x509/sign-verify/sign-verify.html'>
        <link rel='shortcut icon' type='image/x-icon' href='images/favicon.ico'>

<style>
        
        html
              {height:100%}
        body
              {height:calc(100% - 42px);margin:20px;display:flex;flex-direction:column;font-family:arial;gap:20px}
        .hdr                  
              {font-family:arial;position:relative;margin-top:0;margin-bottom:20px;background:white;
                padding-bottom:10px;border-bottom:3px solid lightblue}
        .hdr-icon             
              {display:inline-block;text-align:center;background:whitesmoke;border-radius:5px;
                border:1px solid lightgray;padding:5px 3px 0px;cursor:pointer;margin-right:10px;
                min-width:50px}
        .hdr-icon-img         
              {width:25px;height:25px}
        .hdr-icon-label       
              {margin:2px 0 0}
        .hdr-title            
              {position:absolute;left:0;right:0;z-index:0;margin:0 auto}
        .hdr-date
              {float:right}
    
        input
              {padding:5px 10px;font-size:16px}
        input[type=button]
              {cursor:pointer}
        pre
              {border:1px solid lightgray;padding:10px;font-family:monospace;margin:0}
              
        #btns
              {}
        #keys-root
              {display:flex;height:200px;gap:20px}
              
        #private-key-root
              {flex:1;display:flex;flex-direction:column}
        #private-key
              {flex:1;overflow:auto}
        #public-key-root
              {flex:1;overflow:auto;display:flex;flex-direction:column}
        #public-key
              {flex:1;overflow:auto}

              
        .filename
              {font-size:12px;padding:5px}

</style>

    </head>
      
    <body>
      
        <div class=hdr>
            <a class=hdr-icon href='https://javascript-2020.github.io/'>
                <img class=hdr-icon-img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAAqFBMVEVHcEwjmpckopg9f3YxpJM6r5kjq58Nmp0Nn6QRoKExrpshnpgtoJUdoZwYnZ02spwYpaEmrZ8djpINn6Qtrp4inpcjqZ8SoqM3s5w0sp01spwrr58vr50oqpwdnpo0sZwtrJwUpKMMoaUtq50op5ssqpopppseqaM1sJwgpJ0NoaUSoaI3kYobqaMSpKQrr58PoaMVpaIOoKMLpKcXpaEkqp8Rm58YrKUL0CR4AAAAOHRSTlMACBkBCyinK59CQhUOLyKjqbUGpZgSYn6rp5WsekcmgkyWmCkmNB7AYTiuVgKuuo91i2PLn2lJ7kISMf4AAAElSURBVCjPrdPXloIwEAbgBDFKCRo6SO8lYEHd93+zxV7Zm2WuSL6Tk/MPEwBGLFH8SzFCeFiDXNeJ+7GtGds1D+ghDzzPzXX6xlJbq75s5KVLiJsSB76xIhd22Mz0pkyRnqzW2htD/SeUjL0EQKY60nqRvTLXGl64PR/SfDVxVvETZ123w8vN9Ur5YKUF4R9cd/WxqiePgCs3IMF1QXcVt6vK59tSqyjN4hwQbhS8mUuvWTLbwYtTQGhEjLHVPprv+4ztQ8AeRVn50uipBcXg/IPgfPaFF+z1axyeMEkcJwwdYHHZINQ02gALS49lJcQMci/COGzdue8apRQwNz4tYvM207JSRVEUhvtW6KeBIFVVbds07xPncZfCfWSK+UtNJ/9+VL/nTBuX7xjDZwAAAABJRU5ErkJggg==' />
                <div class=icon-label>
                    home
                </div>
            </a>
            <a id=github class=hdr-icon href='https://github.com/javascript-2020/javascript-2020.github.io/tree/main/utils/x509/generate-certificate-chain/generate-certificate-chain.html'>
                <img class=hdr-icon-img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAbFJREFUOE/l1E2IT2EUx/HPIFI2lJfGwmYsxFZKEUWjKWM3pZSpKcqeBcpLZsNeUeNlZWdBSVFmkAXbmRWbWRCRjYW8jv+pc/V4utff3q3bvfc5z/k+557zO2dA97UHy7ERx3LbZbzEZzxscx3o4L3GWizusP/AO6yv7TXwAo5g9V8iL03vcRWnm8USeBHH/xFUb7uEE7HYAOMZeVmGm7iN61jVccBHjOMQxvAl870QoIDMZ87CfxR3E7QDTyroTjzOtf24k++R0w0BHMY9LEpDCeyXgRL4EyMBjEKcSs+o3r4uSbTQQ1r3CzVMBnCh2PimTQp9wgyJDZZV/g+Bz7E1c/AdezHdr7xp34UHvcIuye8XUZSy9A1nDT5UBSvPCL9oz9BeeY2GYR3msBIHsi834WlPTt9yrXQKIUdEIfoVhSG6Z3PTejdwGG+xDc9SPud7UZ6popjEyZaURMuOl8NhKvtzpKf4yGvMwk95l/5xwNkKeA0T5XCI96EcRbsLh5mWAtXARznyXtXA5tD4/YNYmuBzVTQN8Ctu5V/93tI1sbdjS463KxXwaFZ/NnP9h/kXPcNYElddRc0AAAAASUVORK5CYII='>
                <div class=hdr-icon-label>
                      github
                </div>
            </a>
            
            <img class=hdr-title src='images/sign-verify.png' style='height:40px;top:0px'>
            
            <div class=hdr-date>
                  24 Apr 2025
            </div>
        </div hdr>
        
        <div id=btns>
              <input value=sign type=button>
              <input value=verify type=button>
        </div>
        
        <div id=keys-root>
              <div id=private-key-root>
                    <div>
                          private key
                    </div>
                    <div>
                          <input value=load type=button>
                          <input value=paste type=button>
                    </div>
                    <div id=private-key-file class=filename>
                          none
                    </div>
                    <pre id=private-key></pre>
              </div>
              <div id=public-key-root>
                    <div>
                          public key
                    </div>
                    <div>
                          <input value=load type=button>
                          <input value=paste type=button>
                    </div>
                    <div id=public-key-file class=filename>
                          none
                    </div>
                    <pre id=public-key></pre>
              </div>
        </div>
        
        <div id=signature-root>
              <div>
                    signature
              </div>
              <div>
                    <input value=load type=button>
                    <input value=paste type=button>
              </div>
              <div id=signature-file class=filename>
                    none
              </div>
              <pre id=signature></pre>
        </div>
        
        <div id=file-root>
              <div>
                    file
              </div>
              <div>
                    <input value=load type=button>
                    <input value=paste type=button>
              </div>
              <div id=file-file class=filename>
                    none
              </div>
              <pre id=file></pre>
        </div>



<script>
                                                                                console.clear();
                                                                                console.log('sign/verify.html');
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));

        var $   = (root,sel)=>(!sel && (sel=root,root=document),root.querySelector(sel));



        var ui              = {};
        ui.private          = {};
        ui.public           = {};
        ui.signature        = {};
        ui.file             = {};
        
        
        var btn             = {};
        btn.private         = {};
        btn.public          = {};
        btn.signature       = {};
        btn.file            = {};
        

  //
  
  
        setTimeout(init,50);
        
        function init(){
          
              initdom();
              
        }//init
        
        
        function initdom(){

              var rootnode                                    = document.body;
              
              var root                                        = {};

              
              root.btns                                       = $(rootnode,'#btns');
              
              $(root.btns,'[value=sign]').onclick             = btn.sign;
              $(root.btns,'[value=verify]').onclick           = btn.verify;
              
              
              root.keys                                       = $(rootnode,'#keys-root');
              
              root.private                                    = $(root.keys,'#private-key-root');
              
              $(root.private,'[value=load]').onclick          = btn.private.load;
              $(root.private,'[value=paste]').onclick         = btn.private.paste;
              
              ui.private.file                                 = $(root.private,'#private-key-file');
              ui.private.node                                 = $(root.private,'#private-key');
              
              
              root.public                                     = $(root.keys,'#public-key-root');
              
              $(root.public,'[value=load]').onclick           = btn.public.load;
              $(root.public,'[value=paste]').onclick          = btn.public.paste;
              
              ui.public.file                                  = $(root.public,'#public-key-file');
              ui.public.node                                  = $(root.public,'#public-key');
              
              
              root.signature                                  = $(rootnode,'#signature-root');
              
              $(root.signature,'[value=load]').onclick        = btn.signature.load;
              $(root.signature,'[value=paste]').onclick       = btn.signature.paste;
              
              ui.signature.file                               = $(root.signature,'#signature-file');
              ui.signature.node                               = $(root.signature,'#signature');
              
              
              root.file                                       = $(rootnode,'#file-root');
              
              $(root.file,'[value=load]').onclick             = btn.file.load;
              $(root.file,'[value=paste]').onclick            = btn.file.paste;
              
              ui.file.file                                    = $(root.file,'#file-file');
              ui.file.node                                    = $(root.file,'#file');
              
              
        }//initdom
        

  //:
  
  
        btn.sign    = function(){
          
              var message   = ui.file.node.textContent.trim();
              message       = new TextEncoder().encode(message);
              
              var private_key   = ui.private.node.textContent.trim();
              var key   = import_key(private_key);
              
              let signature = await window.crypto.subtle.sign(
                "RSASSA-PKCS1-v1_5",
                privateKey,
                message
              );
              
              console.log(signature);
          
        }//sign
        
        
        btn.verify    = function(){
        }//verify
        
        
        btn.private.load    = async function(){
          
              var {file,txt}                    = await load();
              ui.private.file.textContent       = file.name;
              ui.private.node.textContent       = txt;
              
        }//load
        
        
        btn.private.paste   = async function(){
          
              var txt                           = await paste();
              ui.private.file.textContent       = 'none';
              ui.private.node.textContent       = txt;
              
        }//paste
        
        
        btn.public.load   = async function(){
          
              var {file,txt}                    = await load();
              ui.public.file.textContent        = file.name;
              ui.public.node.textContent        = txt;
              
        }//load
        
        
        btn.public.paste    = async function(){
          
              var txt                           = await paste();
              ui.public.file.textContent        = 'none';
              ui.public.node.textContent        = txt;
              
        }//paste
        
        
        btn.signature.load    = async function(){
          
              var {file,txt}                    = await load();
              ui.signature.file.textContent     = file.name;
              ui.signature.node                 = txt;
          
        }//load
        
        
        btn.signature.paste   = async function(){
          
              var txt                           = await paste();
              ui.signature.file.textContent     = 'none';
              ui.signature.node.textContent     = txt;
              
        }//paste
        
        
        btn.file.load   = async function(){
          
              var {file,txt}                    = await load();
              ui.file.file.textContent          = file.name;
              ui.file.node.textContent          = txt;
              
        }//load
        
        
        btn.file.paste    = async function(){
          
              var txt                           = await paste();
              ui.file.file.textContent          = 'none';
              ui.file.node.textContent          = txt;
              
        }//paste
        
        
  //:
  
  
        function load(){
          
              var resolve,promise=new Promise(res=>resolve=res);
              
              var input   = document.createElement('input');
              input.type    = 'file';
              input.onchange    = onchange;
              input.click();
              
              return promise;
              
              async function onchange(){
                
                    var file    = input.files[0];
                    var txt     = await file.text();
                    resolve({file,txt});
                    
              }//onchange
              
        }//load
        
        
        async function paste(){
              
              var txt   = await navigator.clipboard.readText();
              return txt;
              
        }//paste
              
        
        function import_key(pem){
          
              var hdr         = '-----BEGIN PRIVATE KEY-----';
              var ftr         = '-----END PRIVATE KEY-----';
              
              var i1          = hdr.length;
              var i2          = key.length-ftr.length-1;
              var b64         = pem.substring(i1,i2);
              
              var bin         = window.atob(b64);
              var bytes       = [...bin].map(c=>c.charCodeAt(0));
              var uint8       = new Uint8Array(bytes);                  
              var buf         = uint8.buffer;
              
              var algorithm   = {name:'RSA-PSS',hash:'SHA-256'};
              var extract     = true;
              var use         = ['sign'];
              var key         = window.crypto.subtle.importKey('pkcs8',buf,algorithm,extract,use);
              console.log(key);
              return key;
            
        }//import_key


</script>