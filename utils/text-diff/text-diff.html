<html>
      <head>
      
            <title>text-diff</title>
      
            <style>
            
                  html {
                        height                      : 100%;
                  }
                  
                  body {
                        font-family                 : arial;
                        margin                      : 20px;
                        height                      : calc(100% - 40px);
                        display                     : flex;
                        flex-direction              : column;
                  }
                  
                  
                  .hdr {
                        position                    : relative;
                        padding-bottom              : 10px;
                        border-bottom               : 1px solid lightblue;
                        margin-top                  : 0;
                        margin-bottom               : 20px;
                        font-family                 : arial;
                  }
                  
                  .hdr-icon {
                        display                     : inline-block;
                        text-align                  : center;
                        background                  : whitesmoke;
                        border-radius               : 5px;
                        border                      : 1px solid lightgray;
                        padding                     : 5px 3px 0px;
                        cursor                      : pointer;
                        margin-right                : 10px;
                        min-width                   : 50px;
                  }
                  
                  .hdr-icon-img {
                  }
                  
                  .hdr-icon-label {
                        margin                      : 2px 0 0;
                  }
                  
                  .hdr-title {
                        text-align                  : center;
                        position                    : absolute;
                        left                        : 0;
                        right                       : 0;
                        top                         : 5px;
                        z-index                     : -1;
                        margin                      : 0;
                  }
                  
                  .hdr-date {
                        float                       : right;
                  }
                  
                  .ftr {
                        background-color            : rgb(238, 232, 170);
                        height                      : 50px;
                        margin-top                  : 70px;
                  }
                  
                  
                  #center {
                        width                       : 100%;
                        max-width                   : 1000px;
                        margin                      : auto;
                        flex                        : 1;
                  }
                  
                  
                  .heading {
                        border-left                 : 5px solid rgba(238,232,170,1);
                        background                  : rgba(239,247,250,1);
                        padding                     : 20px 20px;
                  }
                  
                  
                  a {
                        color                       : blue;
                  }
                  a:visited {
                        color                       : blue;
                  }
      
            </style>
        
            <style>
            
                  :root {--red:rgba(209,153,153,0.5);--green:rgba(153,204,153,0.5)}
                  
                  input {font-size:16px;padding:5px;cursor:pointer}
                  
                  
                  #title {text-align:center;margin:0;margin-bottom:5px}
                  #main {display:flex;flex:1;margin:5px 0}
                  #view1 {flex:1;display:flex;flex-direction:column;border:1px solid var(--green)}
                  #view2 {flex:1;display:flex;flex-direction:column;border:1px solid var(--red)}
                  #hdr {display:flex;align-items:center;padding:5px}
                  #label {flex:1;text-align-center}
                  #editor {flex:1;border-top:1px solid lightgray}
                  #display {flex:1;border:1px solid lightgray;overflow:auto;margin:0}
                  
                  .red {position:absolute;background:var(--red);z-index:20}
                  .green {position:absolute;background:var(--green);z-index:20}
    
            </style>
        
            <link href="https://cdn.jsdelivr.net/npm/ace-builds@1.35.5/css/ace.min.css" rel="stylesheet">
            
      </head>

      
      <body>

            <section style="box-sizing:border-box" class="hdr">
                <div id="home" onclick="window.location='https://javascript-2020.github.io/'" class="hdr-icon">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAABA5JREFUOE+lkVtsVEUYx//fnDnn7KW73XZ7peVSWtvSC5duGrXGkBLFUH1AfdD0DWNMn3zwwURJZA2++CKJvtCoSBMkaoLEBDEYpBQCldRSUnq11La4lF7YstfuntuM2cIjKLGTTDLJN//f9/1mCE+womdP+Ae+u1V/99Ls8IHZ49l/i9AT8JA+czx06du5nxam459t8fg/b78Yth+X+09gODyqdW3ua5mfSLQOXkrEa3Tt5PqA3yx3FmXvvMiFzRY8G/vDB0qPrkv542NLB+Pp1GEpBAV8viOH3ip9b13Aj75cOBhLxg8LIagoUHAk/HbZ/wNeGZNvKhyha8MxNRhQ3yUiWloxjz2zI3BXEmbanqKvHzXpYz/l6qT8ghG6LEcmGENh7qJty5imMo8ATrXVUucjgVJKdusW1EgEjs8HcrtBo6NwCqozrddGFrozhrMdkA+zBE1lU60NJV2puby+xkYomQxkMglZWQmlpgYWXR6XtZyjUzgYAUMeAUVk48K5y3cnLMJpAHsXlhfhOAIVZWUgQr8lsvv2P7+1WnLskcA9CKSYgibbxknqH5MtNomfpZRuAIyIDEHijd6+5d+hKaelkHvHpqYghIOG2joojPVnLHVfx25fiEn2vZRSByCIKMMle5l6zieCI5ORU5msuTvn5dKVyYYtJR2BAk9qas74wTDFbkA8VGY55cHKDZ79mWRCnZxd/iVrOXW5otul9TXVVb5O73TPewoc+0eAXsoVfB7FeHpn8Sd5bt5sOeLVmb9X1fISV04VkYUsqio9tsbpt9Ws82v/jXuHU6u250E3ee6+wl+j8ImonyznrBDiOSEEdE2Bx21mGZMKAFVKrMHWIgIgljvAEZLM1YzmNkwHjLHcviJVpYM+6IkEdaGdvxeN7lyJx1BfXY2Az4KSCxIgpIRh2CAiqJzl3nAN7gggnlQxPj2NwvwAioLBGwYzX6APu2fLdc17wTSNesu2EfDnobU5kFNHxrQw8ucSlu+n4XVpcOkcVRsLUFLoRTLtYOBmDLFECirn0DR9wjDTe+hQz8omJuxeIcRWKSU0jSPUmA+vm2E2ch9/jM5DVRn8XhdSqybKi33YUV8G0wIGR+MwzQfTM8b+Eoy3U/irpRri1Dtze64ylkhge/02tDYXQkoLt+djWFpJQ1EYvG4NGcOCW+fYUOKHz+vFwM0VDE+MI+D3o2rT5oi0ZTuFj841kO4+MzQyUhxLxvHsrhBam0ugKBZiySySaRMKI+g6X5uGc2UN6nZ5MTC8hP6hQQR8+djV1LQsjcwr9P6nEz5P0L9rcGKcx2NxtIVa0NJQilQ2jTuLMUSjaXDOkefVkU0b4C4FwXwXKipKcX14EVcHryM/kI9Q/TZ7NZoY+gdEZNOa/2ZSPwAAAABJRU5ErkJggg==" class="hdr-icon-img" />
                    <div class="hdr-icon-label">
home
                    </div>
                </div>
                <h3 style="color: blue; font-weight: bold;" class="hdr-title">
javascript-2020
                </h3>
                <div style="" class="hdr-date">
21 Nov 2024
                </div>
            </section>

        
            <h3 id=title>text diff</h3>
            
            <input type=button value=check>
            
            <div id=main>
                  <div id=view1>
                        <div id=hdr>
                              <input type=button value=load style=margin-right:10px>
                              <input type=button value=paste style=margin-right:30px>
                              <div id=label>primary</div>
                        </div>
                        <div id=editor></div>
                  </div>
                  <div id=view2>
                        <div id=hdr>
                              <input type=button value=load style=margin-right:10px>
                              <input type=button value=paste style=margin-right:30px>
                              <div id=label>comparitor</div>
                        </div>
                        <div id=editor></div>
                  </div>
            </div>
            
            <div id=display></div>
        
<script type="module">
                                                                                    console.clear();                
        import ace from 'https://cdn.jsdelivr.net/npm/ace-builds/+esm';
        import * as diff from 'https://esm.run/diff';

        function check(){
        
              var txt1        = editor['1'].getValue();
              var txt2        = editor['2'].getValue();
              var d           = diff.diffChars(txt2,txt1);
              console.log(d);
              
              var list    = [];
              var txt     = '';
              d.forEach(part=>{
              
                    var start   = txt.length;
                    txt        += part.value;
                    var end     = txt.length;
                    var color   = part.added ? 'green' : part.removed ? 'red' : 'grey';
                    if(color!='grey'){
                          list.push({start,end,color});
                    }
                    
              });
              editor.output.setValue(txt,-1);
              list.forEach(part=>{
              
                    var start   = editor.output.getSession().doc.indexToPosition(part.start);
                    var end     = editor.output.getSession().doc.indexToPosition(part.end);
                    var range   = new ace.Range(start.row,start.column,end.row,end.column);
                    editor.output.getSession().addMarker(range,part.color,'text');
                    
              });
        
        }//check
        
        var $                         = (node,sel)=>(!sel ? (sel=node,document) : node).querySelector(sel);
        
        $('[value=check]').onclick    = check
        var editor                    = {};
        editor.output                 = create_editor('display');
        
        create(['1','2']);

        
        function create(args){
        
              args.forEach(id=>{console.log(id);
              
                    var view                          = $('#view'+id);
                    $(view,'[value=load]').onclick    = load;
                    $(view,'[value=paste]').onclick   = paste;
                    editor[id]                        = create_editor($(view,'#editor'));
                    
                    function load(){
                    
                          var input   = document.createElement('input');
                          input.type    = 'file';
                          input.click();
                          input.onchange    = async e=>{
                          
                                var txt   = await input.files[0].text();
                                editor[id].setValue(txt,-1);
                                
                          }//onchange
                          
                    }//load
                    
                    async function paste(){
                    
                          var txt   = await navigator.clipboard.readText();
                          editor[id].setValue(txt,-1);
                          
                    }//paste
                    
              });
              
        }//create
        
        function create_editor(id){
        
              var editor    = ace.edit(id);
              editor.setShowInvisibles(false);
              editor.setShowPrintMargin(false);
              editor.setPrintMarginColumn(false);
              editor.setDisplayIndentGuides(false);
              editor.setScrollSpeed(2);
              editor.session.setOptions({tabSize:2,useSoftTabs:true});
              return editor;
              
        }//create_editor
        
</script>


      </body>        
      
</html>

        
        
