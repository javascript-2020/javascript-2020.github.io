<html>
      <head>

            <title>html-editor</title>

            <link rel='icon' type='image/png' href='html-editor.png'>
            <link rel=stylesheet href='/utils/utils.css'>

            <script src='https://cdn.jsdelivr.net/npm/ace-builds@1.37.0/src-min-noconflict/ace.js'></script>


            <script>
                                                                    console.clear();
                  var menu;


                  init.stack            = {};
                  init.stack.ct         = 0;
                  init.stack.total      = 1;
                  Object.defineProperty(init.stack,'add',{get:()=>init.stack.total++});
                  Object.defineProperty(init.stack,'complete',{get:()=>(init.stack.ct++,init.stack.ct==init.stack.total && init())});


                  async function init(){
                                                                    console.log('init');


                        window.onfocus    = ()=>editor.focus();
                        
                        
                        menu            = menumod();
                        jsonblob        = jsonblob();




                        github.load.complete=function(txt){

                              editor.setValue(txt,-1);
                              cur   = {type:'github'};

                        }//github.load.complete

                        github.save.complete=function(){

                              cur   = {type:'github'};

                        }//github.save.complete



                        initdom();

                  }//init

            </script>

            <script>

                  init.stack.add;
                  
                  var ext;
                  var $,datatype,jsonblob,menumod,keydown;
                  
                  fetch('https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js')
                    .then(res=>res.text().then(async txt=>{

                        ext   = eval(txt);

                        var promise   = ext.load.libs(
                              'js/dom/$.js','js/core/datatype.js','js/io/jsonblob/jsonblob.js','js/dom/menumod/menumod.js.api',
                              'js/dom/keydown/keydown.js'
                        );
                        [$,datatype,jsonblob,menumod,keydown]   = await promise;


                        window.$          = $;
                        window.datatype   = datatype;

                                                                          //console.log('ready');
                        init.stack.complete;

                    }));

            </script>


<!-- components -->


<checkbox-one-template>
      <script src='https://script-tag-q0dit4tshpll.runkit.sh/libs/html/libs-html-loader.js'></script>
</checkbox-one-template>

<log>
      <script src='https://script-tag-q0dit4tshpll.runkit.sh/libs/html/libs-html-loader.js'></script>
</log>


<!-- components -->


<style>

      #view {display:none;flex:1}
      #editor {width:50%}
      #iframe-hldr {flex:1;box-sizing:border-box;position:relative}
      iframe {width:100%;height:100%}
      #iframe-glass {width:100%;height:100%;position:absolute;left:0;top:0;}
      .icon {border:1px solid gray;border-radius:3px;box-sizing:border-box;width:30px;height:30px;cursor:pointer}
      button {padding:5px 10px;cursor:pointer;height:30px;font-size:16px}
      .spc {flex:1;max-width:200px}
      #horiz {border:none}
      #vert {border:none}

      #menu-one-icon {padding:3px;width:20px;background:buttonface}
      #menu-one-menu {position:absolute;left:100px;top:70px;}

      .local {position:relative}
      .local-menu {position:absolute;left:-50px;top:40px}

      .github {position:relative}
      #github-menu {right:0;position:absolute;top:50px;width:700px;flex-direction:column;}

</style>

      </head>
      <body>

            <section style="box-sizing:border-box" id="hdr">
                <a id="home" href="window.location='https://javascript-2020.github.io/'" class="hdr-icon">
                    <div class="hdr-icon-label">
home
                    </div>
                </a>

                <div id=filename style='flex:1'>filename</div>

                <h3 style="color: blue; font-weight: bold;" class="hdr-title">
HTML Editor
                </h3>
                <div style="" class="hdr-date">
04 Jan 2024
                </div>
            </section>


            <div id=hdr>
                  <img class=icon title='ctrl-enter - run & autosave&#013;ctrl-s - save&#013;ctrl-del - delete' style='padding:2px' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABANJREFUSEvNl2tsVEUUx39n224pEVNsTcGqAYM1gYYP0mCUaILGLqVptzVGKZCArxIU2VYTYpQapU2Mj9jWR9H6wUesUdcGWoRSJIQYjUhETUkkRUVIoGztLqB9bOm2OzL7urtst3eXhsT77c495/+bOXPmzLlCEk9JydOZKsNi8ws2QYqAW4DskOsF4IRC/WRRdIvP393V9fZFM1mZyqC0dONsX8aMZ0SpjUCOmVjou0eJbM/wjb65e/f284l8YsCqbNN8JK0Ii5JeJXN2IXVjkJskMMbMCu4yVP1tolyBD4ohrNftF+dLY/o1AlbljsUIh4CsKwEl5aPoks7mlbFg++bnQF5JSmA6RlbLTHE2eo0V22teANUwHc2kfK2+WeJsGYqABysc9dcotiblPB2jaLDO3rXp1uOrrjCRUpmH02ed+9Ce112BFRdX1NavVmrrOlRQ4/nH4YN2GDgP826AiuXQ1AY1a2B+vsE5dBRO9UF+Hjj3GeMr7wbbncH3f4fB+Q30HA+8Voml4fOdjXWii4PfmnamCnIi4A+3wcvvwck+WFwAj1WC41Vo2gKdB+HYX0HRwWG4747gZJo+NcCPVEBWJuw4AIULYF0ZrK+D8QkeQDyjYxP5sqLcUa5EOqqApMAfdcCvvQbEvnxy8MQEfLILROCrN+CJbXDuHyoRRpWyS7Hd8a4gT8aB/zwNwyOQfS1kzzJWrEPr8sDX3wZXnAicZoEvu6HwVtjwIDz6Ikz4A+ARVIvY7DU/AkvjwB93wlk3LLgJiu8ywEd+g1Nn4fBRGB1LDL7n9mCOXBiE9v3QezIQJQ32wmENHgByr1qoL0v5ENitwT4gPWnwd7/AidNBuf5LIS9aBEsWws4DwTGXG2zLILzHk4PHJwfrLNbh0WGamwv3LoW2PbC2FG7MM6R6foczf0PJMmPs52Mw7AW/H37oiTvioRUHwPGhTqUipGgbHer45EpRLBXzSHKFj9MqYH24cqWilKJtRSCrVUukgBQCr6GwpCiUirkumpsRRBeQcMnUrc1CYFF0dxClOhtFpQmlD9hr9BYx1l7goK6y4LHokqm/6ktClDK9Eh0oShLA9ZmsRfjDZHJKpGGfviS0nb4Wx9MzdSSm7K8ygWYU8yYRb0HoNI+7O338YoFuAiONgM1euxpUm5nvzcBbKGZEGX4P1CcIcayerOnuaPxMj8V0mSvKa95XQrUZ/P5Le/Vs6AT0A08hDJk4iaJ1b2fThrBZDHhJdXVGTn/WF4KY5VFgrwtQtCOECmhCtELt8OR5Hz7S2qpTIfDENfQafr1r5jvJrNwsMgGAonVgzsimaOik4LBYaM+bzRJuCrgbxBHe08vt/h+/MIlmfzV+2v4DHQu0lKRbJa4AAAAASUVORK5CYII='>

                  <button id=clear>clear</button>
                  <img id=menu-one-icon class=icon src='data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAt1BMVEVHcEwbmPYcgfMchvQbsfkay/wbtvkbnfccefMayfwbmfYch/QchvQbtfkbmfYa1P0ddfIcivQcl/Ycj/Ubp/gcmfYdbPEbrvkazPwcmfYbqfgayfwayPwbv/sbvvobsvkazPwbqvga0fwbvPobtvocjvUbofcbpvccfPMcgPMcgvMdafAdbfEckfUbtvka0PwcfPIaxvsbwfsbvPodb/EcnPYclvYckfUbpvccjPQdd/IbofcbrPiPy8D0AAAAMHRSTlMAA/79/v7+5ycVZ3Y3h0xhu9jp8kFeF9OkVfQOrZi+Mh1z/iUJQ+/dx4fOYq7hybzs5xU1AAABIklEQVQ4y+2Ux3aDMBBFpTR6M92AwYB7S6EG/v+7MsJJnBBKVsnGdwHozT1HQgxC6MrfEkiSM+Y4khSgUxhazLDHWGF4QveAO2gyLnGQ9QS4wcDaXGJYiPGegVnU50UzUvdgTsd7AfrMaEaqXvO+sfAAHP0uzz+SmhCfR7FwB5gdpm+SyoeHEJ5P67o2tbanmRBP5/iSgFkUxaplaisIv3kAu6yqihK/RiIF0ZJtT6NTaZpS9iWwm0D/uXB7kmXZ5LOgN0O7ayvEQ57nKtssCbMqDA5i9+YulLIsVQ5MzKnwqCz6Phev3AIcxhy5K3x/A/DbG2CzIdctP9RS9PrxnTU92KOYll8bZHqs7Wk5AcY9hIx9kuyN3/xuxm5nXA+df+cNJSAgjMbiFSoAAAAASUVORK5CYII='>
                  <div id=menu-one-menu class=menu style='display:none;width:150px;'>

                      <div id=new class=menu-opt>new</div>
                      <div id=fork class=menu-opt>fork</div>
                      <div class=menu-sep></div>
                      <div id=editor class=menu-opt>editor</div>
                      <div id=js-console class=menu-opt>js console</div>
                      <div class=menu-sep></div>
                      <div id=trim class=menu-opt>trim</div>

                  </div>

                  <button id=run>run</button>
                  <button id=save>save</button>
                  <button id=copy>copy</button>
                  <button id=paste>paste</button>

                  <checkbox-one id=autosave></checkbox-one>
                  <checkbox-one id=autorun></checkbox-one>

                  <div class=spc></div>

                  <div class=local>
                        <img id=local class=icon style='padding:2px' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAA1xJREFUSEvF1u9rU1cYwPHvOTdd7dq0ScxtG9fQaktXIdIOirjhRpNV3LvBKIJS595k6gZ74QtfKIjgq/4BdsM3G6MgG4jgi7HNTe0Lh06dGxvzF/U3NF21tiZt0iT33nEyGu5dG8ktd+yB+yL3njyfe855zrlH8D+FqOjuuT4CVuOq36vW/IQT/YVK/68Mv//LJNC6aljO1fFFPLcqWErR+mbfhlXZLWv9ZxHiydfDYtdKCV7YY03K1qHBXloaTCINpqsXeDCnMZURqdN7RKQq+PKXrJeS0W0Xzg2miyGfgvtfKRJrLrqCLz2q4eIjLfVDskr4yhinBLy3ffwsswUdBXeGDDoChiv4xrSPcxMy9duBKuDzn7PGX8M4sNkOb9QNukLu4Av3NMbvyqnbOblOHGXZPJXm+OeTRKXBN0BsqVt2uLe1SE/YHfzV7z4mUtN8FolMmhZDm3fzk33ISvC1MUYsOGh/YIejTSbRxurgbBGm0vDrpEY685eCVdrv+4fZvgy+OsanwL5K8BvRAn2R6oornQPDgtN/1vDH4ydL8KX+YV53DQfrLJrrV15OhgmzWZhZwDGRd2ckVn6qelgIrMZ6rJGbh+W86WdLrN1RzRZgmrBowEIeMnkw1c0Vol7M8UHTPvX8TijAoTUG5xsHeaqalubYPtRdUYymBjRXa+cFjTM5yOXLDR77YFMwzqwD9mmYvd1Ir1CVZ24eCra6lBbvrE3wnQP2v4zR3e5dbxX8NA2WfSosevQEtxxwcwgj2uIdrArvWcYxfvPhaZrEDgwH3B7BCAe8g/MFeJ51wJf1OFuWFVdPB0Z9nXfwwiKoqxyCE/oAe/8N733tVSwpvSuu5wuQt+07wuLjcIJRB1z7EslYp3e9VclnMv+s+aXQLLaGElx0wEE/yQ1t3sGqklVF24bZxEdA30rpbrm41ukkI2HvYLV21Rq2xYQep2vpdxnubCMZ8HsHZ/MwbzvqCTgVjjO0DI518WFtjXeFlclCzn64FRzRBzjmgK+fZLSvu/RZrHz4c7mPqo1DbSDlsHhXT3DGAU+c4XhbCx+5zF2x+WIB1GUPn0lH8G0eOOCH3zJaV8t+r+AV8twKD7BRfXIdcOpHdmqSt/4jOOOD48E49+35PZtTty/9N1FLRi7z3S3QAAAAAElFTkSuQmCC'>
                        <div id=local-menu class=menu style='display:none;width:150px'>
                              <div class=menu-title>local file</div>
                              <div class=menu-opt>load</div>
                              <div class=menu-opt>save</div>
                        </div>
                  </div>


                  <github-api>
                        <script src='https://script-tag-q0dit4tshpll.runkit.sh/libs/html/libs-html-loader.js'></script>
                  </github-api>


                  <img id=horiz class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAPhJREFUSEtjZICChoaGKE5OzvIfP35o/f//nwUmTg2akZHxDwcHx7Xv3793NjQ0LAOZyQgimpubJ/Hz88fZ2dnxKyoqMrCwUNVehj9//jDcv3+f4dChQx8/fvy4qLa2No8R5FMhIaFp8fHx/NS2ED20QA5YuHDhx3fv3mUxdnZ2XnR3d9dTVVWlRqgSNOP27dsMO3fuvMTY2Nj4u6CggIXWvoW5COTrCRMm/AEF9f/S0lKCLqWmgu7uboZRi6kZojjNGg1qugQzyJLRoKZ/UNPNRiSLRksuuoT6aHaiSzCPllx0C2Z4UA9YY2/AmrcD1qAfsC7MQHXaANO37pOxy/mWAAAAAElFTkSuQmCC'>
                  <img id=vert class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAQxJREFUSEtjZICChoaGKE5OzvIfP35o/f//nwUmTg2akZHxDwcHx7Xv3793NjQ0LAOZyQgimpubJ/Hz88fZ2dnxKyoqMrCwEGdvd3c3Q2lpKUG3/fnzh+H+/fsMhw4d+vjx48dFtbW1eYwgnwoJCU2Lj4/nJ9ZCmE3EWgxTD3LAwoULP7579y6LsbOz86K7u7ueqqoqQZejKyDVYpD+27dvM+zcufMSY2Nj4++CggIWUn0LMoQci0G+njBhwh9QUP8nJp6wBQc5FsMcPGoxSQlsNKiJDS5QSI0mLmJDC6xuNHERG1yjiYvYkIKrG01cxAbZaOIiNqSGeOIasMbegDVvB6xBP2BdmIHqtAEA6MBFop3TQsgAAAAASUVORK5CYII='>

            </div>
            <div id=view>
                  <div id=editor></div>
                  <div id=page-slider style='width:10px;cursor:ew-resize'></div>
                  <div id=iframe-hldr>
                        <iframe id=iframe></iframe>
                        <div id=iframe-glass style='display:none'></div>
                  </div>
            </div>

      </body>

<script>
                                        console.log('main');

        var cur;

        var autosave;
        var autorun;
        var local;
        var github;
        var view;
        var editor;
        var iframe;

        var ui          = {};
        ui.mode         = 'vert';
        ui.menu         = {};




  //:


        async function initdom(){   //c

              keydown.initdom();
              keydown.add(kd);

              $('#clear').onclick           = clear;

              var node                      = $('#menu-one-menu');
              $('#menu-one-icon').onclick   = menu.click(node,false,false,ui.menu.one);

              $('#run').onclick             = run;
              $('#save').onclick            = save;
              $('#copy').onclick            = copy;
              $('#paste').onclick           = paste;

              autosave                      = $('#autosave');
              autosave.checked              = false;
              autorun                       = $('#autorun');
              autorun.checked               = false;



              var node                      = $('#local-menu');
              $('#local').onclick           = menu.click(node,false,false,ui.menu.local);


              github.initdom();


              $('#horiz').onclick           = horiz;
              $('#vert').onclick            = vert;

              view                          = $('#view');


              ui.editor(view);


              iframe                        = $('iframe');
              iframe.glass                  = $('#iframe-glass');


              ui.slider('#editor','#page-slider','#iframe-hldr');



              ui.setup();


              var json    = await jsonblob.util.query();
              if(json){
                    editor.setValue(json.txt,-1);
                    if(autorun.checked){
                          run();
                    }
              }

              view.style.display    = 'flex';


              editor.focus();

        }//initdom


        function kd(e){

              if(e.key=='Enter' && e.ctrlKey){
                    run();
              }

              if(e.key==' ' && e.ctrlKey){
                    menu.open();
              }

              if(e.key=='s' && e.ctrlKey){
                    var txt   = editor.getValue();
                    e.preventDefault();
                    if(!cur){
                          log.orange('no file');
                          return;
                    }
                    if(cur.type=='github'){
                          github.save(txt);
                    }
                    if(cur.type=='local'){
                          ui.menu.local.save();
                    }
              }

              if(e.key=='Delete' && e.ctrlKey){
                    jsonblob.util.delete()
              }

        }//keydown


  //:


        function filename(path){

              var fn;
              var i   = path.lastIndexOf('/');
              if(i==-1){
                    fn    = path;
              }else{
                    fn    = path.slice(i+1);
              }
              document.title                = fn;
              $('#filename').textContent    = fn;
              return fn;

        }//filename


        ui.editor=function(root){

            var node    = $(root,'#editor');
            editor      = ace.edit(node);
            editor.setShowInvisibles(false);
            editor.setShowPrintMargin(false);
            editor.setPrintMarginColumn(false);
            editor.setBehavioursEnabled(false);
            editor.setDisplayIndentGuides(false);
            editor.setScrollSpeed(2);
            editor.setFontSize(16);
            editor.session.setOptions({tabSize:2,useSoftTabs:true});
            //editor.setGhostText('\n\nctrl-enter - run & autosave\nctrl-s - save\nctrl-del - delete');
            editor.focus();

        }//editor


        ui.slider=function(node1,slider_node,node2){

              if(typeof node1=='string'){
                    node1   = $(view,node1);
              }
              if(typeof slider_node=='string'){
                    slider_node   = $(view,slider_node);
              }
              if(typeof node2=='string'){
                    node2   = $(view,node2);
              }


              ui.slider.node    = slider_node;
              $.track(slider_node,slider);


              function slider(ox,oy){

                    if(ui.mode=='vert'){
                          slider.vert(ox);
                    }else{
                          slider.horiz(oy);
                    }

              }//slider


              slider.md=function(){

                    glass();
                    document.body.style.userSelect    = 'none';

              }//slider.md


              slider.mu=function(){

                    glass(false);
                    document.body.style.userSelect    = '';

              }//slider.mu


              slider.vert=function(ox){

                    var w1    = node1.offsetWidth;
                    var w2    = node2.offsetWidth;

                    if(w1+ox<25)return;
                    if(w2-ox<25)return;

                    node1.style.width   = w1+ox+'px';
                    node2.style.width   = w2-ox+'px';

              }//vert


              slider.horiz=function(oy){

                    var h1    = node1.offsetHeight;
                    var h2    = node2.offsetHeight;

                    if(h1+oy<40)return;
                    if(h2-oy<40)return;

                    node1.style.height    = h1+oy+'px'
                    node2.style.height    = h2-oy+'px';

              }//horiz

        }//ui.slider


        function glass(show=true){

              if(show){
                    iframe.glass.style.display    = '';
              }else{
                    iframe.glass.style.display    = 'none';
              }

        }//glass


  //:


      window.onmessage=function(e){

            var json    = JSON.parse(e.data);

            var txt;
            if(json.code){
                  txt   = json.code;
            }
            if(json.txt){
                  txt   = json.txt;
            }
            if(json.text){
                  txt   = json.text;
            }

            editor.setValue(txt,-1);

            if(json.run){
                  run();
            }

      }//onmessage


  //:


      ui.read=function(){

            var json    = {v:1,txt:editor.getValue()};
            return json;

      }//read


      ui.setup=function(){

            var o   = localStorage.getItem('orientation');
            if(o==='horiz'){
                  horiz();
            }

      }//setup



  //menu:

      ui.menu.one=function(type,opt){

            if(type=='opt'){
                  ui.menu.one[opt.id]();
            }

      }//one

      ui.menu.one.new=function(){

            var url       = window.location.toString();
            var search    = window.location.search;
            if(search){
                  url     = url.slice(0,-search.length);
            }

            var win   = window.open(url);
            return win;

      }//new

      ui.menu.one.fork=function(){

            var win   = newwin();
            var txt   = editor.getValue();
            win.postMessage({txt},'*');

      }//fork

      ui.menu.one.editor=function(){

            window.open('/utils/editor/editor.html');

      }//editor

      ui.menu.one['js-console']=function(){

            window.open('/util/js-console/js-console.html');

      }//js-console

      ui.menu.one.trim=function(){

            var pos     = editor.getCursorPosition();
            var txt     = editor.getValue();
            var lines   = txt.split('\n');
            lines       = lines.map(line=>line.trimEnd());
            txt         = lines.join('\n');
            editor.setValue(txt,-1);
            editor.gotoLine(pos.row,pos.column);

      }//trim

  //:

      ui.menu.local=function(type,opt){

            if(type=='opt'){
                  if(opt.id=='load'){
                        ui.menu.local.load();
                  }
                  if(opt.id=='save'){
                        ui.menu.local.save();
                  }
            }

      }//local

      ui.menu.local.load=function(){

            var input   = document.createElement('input');
            input.type    = 'file';
            input.click();
            input.onchange    = async ()=>{

                                      var file    = input.files[0];
                                      filename(file.name);
                                      var txt     = await file.text();
                                      editor.setValue(txt,-1);
                                      cur         = {type:'local'};

                                }

      }//load

      ui.menu.local.save=function(){

            var blob      = new Blob([editor.getValue()]);
            var url       = window.URL.createObjectURL(blob);
            var a         = document.createElement('a');
            a.href        = url;
            a.download    = 'file.txt';
            a.click();
            cur           = {type:'local'};

      }//save

  //:



      function clear(e){

            editor.setValue('',-1);

      }//clear


      function save(){

            var json    = ui.read();
            jsonblob.util.save(json);

      }//save


      function copy(){

            var txt       = editor.getValue();
            var promise   = navigator.clipboard.writeText(txt);
            promise.catch(err=>log.error(err));

      }//copy


      function paste(){

            var promise   = navigator.clipboard.readText();
            promise.then(txt=>editor.setValue(txt,-1));
            promise.catch(err=>log.error(err));

      }//paste


      function horiz(){

            localStorage.setItem('orientation','horiz');

            ui.mode                         = 'horiz';
            ui.slider.node.style.cursor     = 'ns-resize';
            ui.slider.node.style.width      = '100%';
            ui.slider.node.style.height     = '10px';

            view.style.flexDirection        = 'column';

            editor.container.style.width    = '100%';
            editor.container.style.height   = '50%';

            iframe.style.width              = '100%';
            iframe.style.height             = '50%';

            editor.focus();

      }//horiz


      function vert(){

            localStorage.setItem('orientation','vert');

            ui.mode                         = 'vert';
            ui.slider.node.style.cursor     = 'ew-resize';
            ui.slider.node.style.width      = '10px';
            ui.slider.node.style.height     = '100%';

            view.style.flexDirection        = 'row';

            editor.container.style.width    = '50%';
            editor.container.style.height   = '100%';

            iframe.style.width              = '50%';
            iframe.style.height             = '100%';

            editor.focus();

      }//vert


  //:


      function run(){

            iframe.srcdoc   = editor.getValue();
            if(!autosave.checked)return;
            jsonblob.util.save.debounce(()=>ui.read());

      }//run



      init.stack.complete;

      
</script>


</html>







