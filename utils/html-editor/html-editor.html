

<html>
      <head>

            <title>html-editor</title>

            <link rel=icon type='image/png' href='images/html-editor-favicon.png'>
            <link rel=stylesheet href='/utils/css/utils.css'>
            
            <style id=page-inline>
            
                  #help         {padding:2px}
                  
                  #hdr          {padding:5px 5px;height:30px;display:flex;align-items:center;gap:10px}
                  .icon         {border:1px solid gray;border-radius:3px;box-sizing:border-box;width:30px;height:30px;cursor:pointer}
                  .spc          {flex:1}
                  
                  #run          {color:blue;font-weight:bold}
                  #horiz        {margin-left:50px;border:none}
                  #vert         {border:none}
            
                  #view         {display:none;flex:1}
            
                  editor-root   {width:50%}
                  output-root   {flex:1}
                        
                  button        {padding:5px 10px;cursor:pointer;height:30px;font-size:16px}            
            
            </style>
            

            <script>
                                                                                console.clear();
                                                                                console.json=v=>console.log(JSON.strinigify(v,null,4));
                  var github;
                  var editor;
                  var output;
                  var publish;
                  var log;

                  var menu    = {};


                  async function init(){
                                                                                console.log('init');

                        window.onfocus            = ()=>editor && editor.focus();

                        keydown.add(kd);
                        
                        menumod                   = menumod();
                        menumod.add.style();
                        menumod.on.close          = ()=>editor.focus();

                        filemod.initmod({menumod});
                        filemod.init();
                        
                        publish.initmod({ui});
                        
                        
                        initdom();


                  }//init

                  init.stack            = [];
                  init.stack.ct         = 0;
                  init.stack.total      = 1;
                  init.stack.mode       = '';
                  init.stack.complete   = false;
                  Object.defineProperty(init.stack,'add',{get:()=>{
                        init.stack.total++;
                        init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
                  }});
                  Object.defineProperty(init.stack,'complete',{get:()=>{
                        init.stack.ct++;
                        init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
                        init.stack.ct>=init.stack.total && init();
                  }});
                  
                  //  (typeof init!='undefined' && init?.stack && init.stack.add)
                  //  (typeof init!='undefined' && init?.stack && init.stack.complete)
                  
            </script>

            <script libs>

                  init.stack.add;
                  
                  var ext;
                  var $,datatype,menumod,keydown;
                  
                  fetch('https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js')
                    .then(res=>res.text().then(async txt=>{

                        ext   = eval(txt);

                        var promise   = ext.load.libs(
                              'js/dom/$.js.api',
                              'js/core/datatype.js',
                              'js/dom/menumod/menumod.js',
                              'js/dom/keydown/keydown.js'
                        );
                        [$,datatype,menumod,keydown]   = await promise;

                        window.$            = $;
                        window.datatype     = datatype;

                        init.stack.complete;

                    }));

            </script>


      </head>

      
      <body>

            <hdr-utils-api>
                  <script src='https://html-loader-dblv8aserliq.runkit.sh/'></script>
                  <img class=title src='images/html-editor.png' style='top:-5px;height:55px'>
                  <span slot=date>24 Jan 2025</span>
            </hdr-utils-api>


            <div id=hdr>
                        
                  <main-menu-local>
                        <script src='https://html-loader-dblv8aserliq.runkit.sh/'></script>
                  </main-menu-local>

                  <filemod-api>
                        <script src='https://html-loader-dblv8aserliq.runkit.sh/'></script>
                  </filemod-api>

                  <checkbox-one id=autorun></checkbox-one>
                  
                  <publish-api>
                        <script src='https://html-loader-dblv8aserliq.runkit.sh/'></script>
                  </publish-api>

                  <button id=run>run</button>

                  <span class=spc></span>

                  <img id=horiz class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAPhJREFUSEtjZICChoaGKE5OzvIfP35o/f//nwUmTg2akZHxDwcHx7Xv3793NjQ0LAOZyQgimpubJ/Hz88fZ2dnxKyoqMrCwUNVehj9//jDcv3+f4dChQx8/fvy4qLa2No8R5FMhIaFp8fHx/NS2ED20QA5YuHDhx3fv3mUxdnZ2XnR3d9dTVVWlRqgSNOP27dsMO3fuvMTY2Nj4u6CggIXWvoW5COTrCRMm/AEF9f/S0lKCLqWmgu7uboZRi6kZojjNGg1qugQzyJLRoKZ/UNPNRiSLRksuuoT6aHaiSzCPllx0C2Z4UA9YY2/AmrcD1qAfsC7MQHXaANO37pOxy/mWAAAAAElFTkSuQmCC'>
                  <img id=vert class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAQxJREFUSEtjZICChoaGKE5OzvIfP35o/f//nwUmTg2akZHxDwcHx7Xv3793NjQ0LAOZyQgimpubJ/Hz88fZ2dnxKyoqMrCwEGdvd3c3Q2lpKUG3/fnzh+H+/fsMhw4d+vjx48dFtbW1eYwgnwoJCU2Lj4/nJ9ZCmE3EWgxTD3LAwoULP7579y6LsbOz86K7u7ueqqoqQZejKyDVYpD+27dvM+zcufMSY2Nj4++CggIWUn0LMoQci0G+njBhwh9QUP8nJp6wBQc5FsMcPGoxSQlsNKiJDS5QSI0mLmJDC6xuNHERG1yjiYvYkIKrG01cxAbZaOIiNqSGeOIasMbegDVvB6xBP2BdmIHqtAEA6MBFop3TQsgAAAAASUVORK5CYII='>

            </div>
            
            <div id=view>
            
                  <editor-api>
                        <script src='https://html-loader-dblv8aserliq.runkit.sh/'></script>
                  </editor-api>
                  
                  <div id=page-slider style='width:10px;cursor:ew-resize'></div>
                  
                  <output-local>
                        <script src='https://html-loader-dblv8aserliq.runkit.sh/'></script>
                  </output-local>
                  
            </div>

      </body>

<script>
                                                                                  console.log('main');

        var autorun;
        
        var view;
        

        var ui          = {};
        ui.mode         = 'vert';
        var slider      = {};




  //:


        async function initdom(){   //c
                                                                                console.log('initdom');
              keydown.initdom();


              //$('#help').title              = 'ctrl-enter - run & autosave&#013;ctrl-s - save&#013;ctrl-del - delete';

              menu.top.initdom();

              
              menu.main.initdom();

              
              autorun                       = $('#autorun');
              autorun.checked               = false;
              
              publish.initdom();
              
              $('#run').onclick             = run;


              filemod.initdom();


              $('#horiz').onclick           = horiz;
              $('#vert').onclick            = vert;
              

              view                          = $('#view');

              editor.initdom(view,'html');
              slider.md                     = ()=>output.glass();
              slider.mu                     = ()=>output.glass(false);
              slider.node                   = $.slider('editor-root','#page-slider','output-root',slider,ui);
              output.initdom(view);

              ui.setup();


              publish.query();
              editor.focus();

        }//initdom


        function kd(e){

              if(e.key=='Enter' && e.ctrlKey){
                    e.preventDefault();
                    run();
              }

              if(e.key==' ' && e.ctrlKey){
                    e.preventDefault();
                    menumod.open();
              }

              if(e.key=='s' && e.ctrlKey){
                    e.preventDefault();
                    filemod.save();
              }

              if(e.key=='Delete' && e.ctrlKey){
                    e.preventDefault();
                    jsonblob.util.delete()
              }
              
        }//keydown


  //:


        function complete(type,path,icon){
        
              var name    = editor.filename(path,icon);
              editor.filename.save(false);
              filemod.cur   = {type,name};
              menumod.close();
              editor.focus();
              return name;
              
        }//complete

        
        complete.load=function(type,txt,path,icon){
        
              editor.clear();
              output.kill();
              editor.setValue(txt,-1);
              complete(type,path,icon);
              
        }//complete.load

        
        complete.save=function(type,path,icon){

              var name    = complete(type,path,icon);
              log.green(name,'saved');
              
        }//save

  //:
  
      window.onmessage=function(e){

            
            var json    = JSON.parse(e.data);

            var txt   = json.code||json.text||json.txt;
            if(txt){
                  editor.setValue(txt,-1);
            }

            if(json.run){
                  run();
            }


      }//onmessage


  //:


      ui.read=function(){

            var txt     = editor.getValue();
            var json    = {v:1,txt};
            return json;

      }//read


      ui.setup=function(){

            var o   = localStorage.getItem('orientation');
            if(o==='horiz'){
                  horiz();
            }
            view.style.display    = 'flex';

      }//setup


  //:


      function horiz(){

            localStorage.setItem('orientation','horiz');

            ui.mode                     = 'horiz';
            slider.node.style.cursor    = 'ns-resize';
            slider.node.style.width     = '100%';
            slider.node.style.height    = '10px';

            view.style.flexDirection    = 'column';

            editor.horiz();
            output.horiz();
            editor.focus();

      }//horiz


      function vert(){

            localStorage.setItem('orientation','vert');

            ui.mode                     = 'vert';
            slider.node.style.cursor    = 'ew-resize';
            slider.node.style.width     = '10px';
            slider.node.style.height    = '100%';

            view.style.flexDirection    = 'row';

            editor.vert();
            output.vert();
            editor.focus();

      }//vert


  //:
  
      function run(){

            var html    = editor.getValue();
            output.srcdoc(html);
            
            if(filemod.autosave){
                                                                                console.log('save');
                  filemod.save();
            }

      }//run



      init.stack.complete;

      
</script>


<!-- components -->

<checkbox-one-template>
      <script src='https://html-loader-dblv8aserliq.runkit.sh/'></script>
</checkbox-one-template>

<log>
      <script src='https://html-loader-dblv8aserliq.runkit.sh/'></script>
</log>

<!-- components -->


</html>

