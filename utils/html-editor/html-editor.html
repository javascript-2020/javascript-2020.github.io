<style>
      html,body{margin:0;height:100%}
      body {display:flex;flex-direction:column;font-family:arial}
      #hdr {padding:5px 5px;height:30px;display:flex;align-items:center;gap:10px}
      #view {display:none;flex:1}
      #editor{width:50%}
      iframe{flex:1;box-sizing:border-box}
      .icon{border:1px solid gray;border-radius:3px;box-sizing:border-box;width:30px;height:30px;cursor:pointer}
      button {padding:5px 10px;cursor:pointer;height:30px;font-size:16px}
      .spc {flex:1;max-width:200px}
      #horiz{border:none}
      #vert{border:none}
      
      .slider {position:relative;display:inline-flex;align-items:center;cursor:pointer;
                border:1px solid gray;border-radius:3px;height:30px;box-sizing:border-box;padding:0 5px}
      .slider input {opacity:0;width:0;height:0}
      .slider .label {margin-left:30px}
      .slider .hldr {position:absolute;top:4px;left:5px;width:30px;height:20px;background-color:#ccc}
      .slider .hldr:before {position:absolute;content:"";height:17px;width:17px;left:2px;bottom:2px;background-color:white;transition:.2s}
      .slider input:checked + .hldr {background-color:#2196F3}
      .slider input:checked + .hldr:before {transform:translateX(9px)}
      .slider .hldr {border-radius:34px}
      .slider .hldr:before {border-radius:50%}
      
      .local {position:relative}
      .local-menu {position:absolute;left:-50px;top:40px}
      .github {position:relative}
      #github-menu {right:0;position:absolute;top:50px;width:700px;flex-direction:column;}
      
</style>

<body>
      <div id=hdr>
            <img class=icon title='ctrl-enter - run & autosave&#013;ctrl-s - save&#013;ctrl-del - delete' style='padding:2px' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABANJREFUSEvNl2tsVEUUx39n224pEVNsTcGqAYM1gYYP0mCUaILGLqVptzVGKZCArxIU2VYTYpQapU2Mj9jWR9H6wUesUdcGWoRSJIQYjUhETUkkRUVIoGztLqB9bOm2OzL7urtst3eXhsT77c495/+bOXPmzLlCEk9JydOZKsNi8ws2QYqAW4DskOsF4IRC/WRRdIvP393V9fZFM1mZyqC0dONsX8aMZ0SpjUCOmVjou0eJbM/wjb65e/f284l8YsCqbNN8JK0Ii5JeJXN2IXVjkJskMMbMCu4yVP1tolyBD4ohrNftF+dLY/o1AlbljsUIh4CsKwEl5aPoks7mlbFg++bnQF5JSmA6RlbLTHE2eo0V22teANUwHc2kfK2+WeJsGYqABysc9dcotiblPB2jaLDO3rXp1uOrrjCRUpmH02ed+9Ce112BFRdX1NavVmrrOlRQ4/nH4YN2GDgP826AiuXQ1AY1a2B+vsE5dBRO9UF+Hjj3GeMr7wbbncH3f4fB+Q30HA+8Voml4fOdjXWii4PfmnamCnIi4A+3wcvvwck+WFwAj1WC41Vo2gKdB+HYX0HRwWG4747gZJo+NcCPVEBWJuw4AIULYF0ZrK+D8QkeQDyjYxP5sqLcUa5EOqqApMAfdcCvvQbEvnxy8MQEfLILROCrN+CJbXDuHyoRRpWyS7Hd8a4gT8aB/zwNwyOQfS1kzzJWrEPr8sDX3wZXnAicZoEvu6HwVtjwIDz6Ikz4A+ARVIvY7DU/AkvjwB93wlk3LLgJiu8ywEd+g1Nn4fBRGB1LDL7n9mCOXBiE9v3QezIQJQ32wmENHgByr1qoL0v5ENitwT4gPWnwd7/AidNBuf5LIS9aBEsWws4DwTGXG2zLILzHk4PHJwfrLNbh0WGamwv3LoW2PbC2FG7MM6R6foczf0PJMmPs52Mw7AW/H37oiTvioRUHwPGhTqUipGgbHer45EpRLBXzSHKFj9MqYH24cqWilKJtRSCrVUukgBQCr6GwpCiUirkumpsRRBeQcMnUrc1CYFF0dxClOhtFpQmlD9hr9BYx1l7goK6y4LHokqm/6ktClDK9Eh0oShLA9ZmsRfjDZHJKpGGfviS0nb4Wx9MzdSSm7K8ygWYU8yYRb0HoNI+7O338YoFuAiONgM1euxpUm5nvzcBbKGZEGX4P1CcIcayerOnuaPxMj8V0mSvKa95XQrUZ/P5Le/Vs6AT0A08hDJk4iaJ1b2fThrBZDHhJdXVGTn/WF4KY5VFgrwtQtCOECmhCtELt8OR5Hz7S2qpTIfDENfQafr1r5jvJrNwsMgGAonVgzsimaOik4LBYaM+bzRJuCrgbxBHe08vt/h+/MIlmfzV+2v4DHQu0lKRbJa4AAAAASUVORK5CYII='>
            <button id=new>new</button>
            <button id=fork>fork</button>
            <button id=run>run</button>
            <button id=save>save</button>
            <label id=autosave class=slider>
                  <span class=track></span>
                  <input type=checkbox>
                  <span class=hldr></span>
                  <span class=label>autosave</span>
            </label>
            <label id=autorun class=slider>
                  <span class=track></span>
                  <input type=checkbox>
                  <span class=hldr></span>
                  <span class=label>autorun</span>
            </label>
            
            <div class=spc></div>
            
            <div class=local>
                  <img id=local class=icon style='padding:2px' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAA1xJREFUSEvF1u9rU1cYwPHvOTdd7dq0ScxtG9fQaktXIdIOirjhRpNV3LvBKIJS595k6gZ74QtfKIjgq/4BdsM3G6MgG4jgi7HNTe0Lh06dGxvzF/U3NF21tiZt0iT33nEyGu5dG8ktd+yB+yL3njyfe855zrlH8D+FqOjuuT4CVuOq36vW/IQT/YVK/68Mv//LJNC6aljO1fFFPLcqWErR+mbfhlXZLWv9ZxHiydfDYtdKCV7YY03K1qHBXloaTCINpqsXeDCnMZURqdN7RKQq+PKXrJeS0W0Xzg2miyGfgvtfKRJrLrqCLz2q4eIjLfVDskr4yhinBLy3ffwsswUdBXeGDDoChiv4xrSPcxMy9duBKuDzn7PGX8M4sNkOb9QNukLu4Av3NMbvyqnbOblOHGXZPJXm+OeTRKXBN0BsqVt2uLe1SE/YHfzV7z4mUtN8FolMmhZDm3fzk33ISvC1MUYsOGh/YIejTSbRxurgbBGm0vDrpEY685eCVdrv+4fZvgy+OsanwL5K8BvRAn2R6oornQPDgtN/1vDH4ydL8KX+YV53DQfrLJrrV15OhgmzWZhZwDGRd2ckVn6qelgIrMZ6rJGbh+W86WdLrN1RzRZgmrBowEIeMnkw1c0Vol7M8UHTPvX8TijAoTUG5xsHeaqalubYPtRdUYymBjRXa+cFjTM5yOXLDR77YFMwzqwD9mmYvd1Ir1CVZ24eCra6lBbvrE3wnQP2v4zR3e5dbxX8NA2WfSosevQEtxxwcwgj2uIdrArvWcYxfvPhaZrEDgwH3B7BCAe8g/MFeJ51wJf1OFuWFVdPB0Z9nXfwwiKoqxyCE/oAe/8N733tVSwpvSuu5wuQt+07wuLjcIJRB1z7EslYp3e9VclnMv+s+aXQLLaGElx0wEE/yQ1t3sGqklVF24bZxEdA30rpbrm41ukkI2HvYLV21Rq2xYQep2vpdxnubCMZ8HsHZ/MwbzvqCTgVjjO0DI518WFtjXeFlclCzn64FRzRBzjmgK+fZLSvu/RZrHz4c7mPqo1DbSDlsHhXT3DGAU+c4XhbCx+5zF2x+WIB1GUPn0lH8G0eOOCH3zJaV8t+r+AV8twKD7BRfXIdcOpHdmqSt/4jOOOD48E49+35PZtTty/9N1FLRi7z3S3QAAAAAElFTkSuQmCC'>
                  <div id=local-menu class=menu style='display:none;width:150px'>
                        <div class=menu-title>local file</div>
                        <div class=menu-opt>load</div>
                        <div class=menu-opt>save</div>
                  </div>
            </div>
            
            <div class=github>
                  <img id=github class=icon style='padding:2px' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAZ9JREFUSEvNls8uBEEQxn9DXFgughNZ3sBNwk3iMYTH4GJPvIQEryFxI3HyBkLcEBf/DsKiNmbSad1d1TO7oW/T/fX31VddPdUF+WMKOAbaP1uvgTXgPoeqMIJfgNEMbEvDasLPwJhGEll/Te1NCX/WFPS3BTViwv0SLYP4peNPjABvfXLq0wj3eywS3+k5sFQzkBNg1dtbGXUdh9Lrrn8AQ4YgTJwlSAiF2FQYBvESEjIzDHRL4VgxaddNiyHK+6fCR8D6ANKcSve+OB5UmlPCxIQPgU3tAI3rB8BGqGpDjleAMyOxBlsGTq3C28Cexmhc3wJ2rcLSY+eNxBrsyundFfbfFZdE1vTnoVb1LHATyVdT8dhVndP+XE2cp3p6ERKWuQXg0smC9FHpp5YhWGkEqVEJC8iNMJWJpq+W3n6X5BaYdsKUtZ3v744zJ5mQ6xEai8CF4vQOmAmdX8i14KRfdw151t5qwRdIqPxzqzpZUG7gueelBWLudLnv6jrCWe/qMivjwKNXcKmjdh1PAE8xsObA3fcATCoFZsH0KL4ABKpK0CB/GK0AAAAASUVORK5CYII='>
                  <div id="github-menu" class="menu" style='display:none'>
                      <div class="menu-title">
                            github params
                      </div>
                      <div style="margin-bottom: 20px; border-bottom: 1px solid lightgray;">
                          <div id="parse-url-label">
                                parse url
                          </div>
                          <div style="margin-bottom: 10px; display: flex;" id="parse-url-root" class="menu-opt">
                              <img style="height: 20px; width: 20px; border: 1px solid lightgray; box-sizing: border-box; cursor: pointer; margin-right: 3px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==" id="parse-url-paste" />
                              <input id="parse-url" style="flex: 1 1 0%; margin-right: 10px;">
                              </input>
                              <input style="height: 25px; cursor: pointer; font-size: 16px; box-sizing: border-box;" type="button" value="parse" id="parse" autocomplete='off'>
                              </input>
                          </div>
                      </div>
                      <div id="token-label">
                            token
                      </div>
                      <div style="display: flex; margin-bottom: 10px;" id="token-root" class="menu-opt">
                          <img style="height: 20px; width: 20px; border: 1px solid lightgray; box-sizing: border-box; cursor: pointer; margin-right: 3px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==" id="token-paste" />
                          <input id="token" style="margin-bottom: 10px; flex: 1 1 0%;" autocomplete='off'>
                          </input>
                      </div>
                      <div id="owner-label">
                            owner
                      </div>
                      <div style="display: flex;" id="owner-root" class="menu-opt">
                          <img style="height: 20px; width: 20px; border: 1px solid lightgray; box-sizing: border-box; cursor: pointer; margin-right: 3px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==" id="owner-paste" />
                          <input id="owner" style="margin-bottom: 10px; flex: 1 1 0%;" autocomplete='off'>
                          </input>
                      </div>
                      <div id="repo-label">
                            repo
                      </div>
                      <div style="display: flex; margin-bottom: 10px;" id="repo-root" class="menu-opt">
                          <img style="height: 20px; width: 20px; border: 1px solid lightgray; box-sizing: border-box; cursor: pointer; margin-right: 3px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==" id="repo-paste" />
                          <input id="repo" style="flex: 1 1 0%;" autocomplete="off">
                          </input>
                      </div>
                      <div id="branch-label">
                            branch
                      </div>
                      <div style="display: flex;" id="branch-root" class="menu-opt">
                          <img style="height: 20px; width: 20px; border: 1px solid lightgray; box-sizing: border-box; cursor: pointer; margin-right: 3px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==" id="branch-paste" />
                          <input id="branch" style="flex: 1 1 0%;" autocomplete='off'>
                          </input>
                      </div>
                      <div id="path-label">
                            path
                      </div>
                      <div style="display: flex;" id="branch-root" class="menu-opt">
                          <img style="height: 20px; width: 20px; border: 1px solid lightgray; box-sizing: border-box; cursor: pointer; margin-right: 3px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==" id="branch-paste" />
                          <input id="path" style="flex: 1 1 0%;" autocomplete='off'>
                          </input>
                      </div>
                      <div style='display:flex;justify-content:center;gap:25px'>
                            <button id=github-load class=menu-opt>load</button>
                            <button id=github-save class=menu-opt>save</button>
                      </div>
                  </div>
            </div>
            
            <img id=horiz class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAPhJREFUSEtjZICChoaGKE5OzvIfP35o/f//nwUmTg2akZHxDwcHx7Xv3793NjQ0LAOZyQgimpubJ/Hz88fZ2dnxKyoqMrCwUNVehj9//jDcv3+f4dChQx8/fvy4qLa2No8R5FMhIaFp8fHx/NS2ED20QA5YuHDhx3fv3mUxdnZ2XnR3d9dTVVWlRqgSNOP27dsMO3fuvMTY2Nj4u6CggIXWvoW5COTrCRMm/AEF9f/S0lKCLqWmgu7uboZRi6kZojjNGg1qugQzyJLRoKZ/UNPNRiSLRksuuoT6aHaiSzCPllx0C2Z4UA9YY2/AmrcD1qAfsC7MQHXaANO37pOxy/mWAAAAAElFTkSuQmCC'>
            <img id=vert class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAQxJREFUSEtjZICChoaGKE5OzvIfP35o/f//nwUmTg2akZHxDwcHx7Xv3793NjQ0LAOZyQgimpubJ/Hz88fZ2dnxKyoqMrCwEGdvd3c3Q2lpKUG3/fnzh+H+/fsMhw4d+vjx48dFtbW1eYwgnwoJCU2Lj4/nJ9ZCmE3EWgxTD3LAwoULP7579y6LsbOz86K7u7ueqqoqQZejKyDVYpD+27dvM+zcufMSY2Nj4++CggIWUn0LMoQci0G+njBhwh9QUP8nJp6wBQc5FsMcPGoxSQlsNKiJDS5QSI0mLmJDC6xuNHERG1yjiYvYkIKrG01cxAbZaOIiNqSGeOIasMbegDVvB6xBP2BdmIHqtAEA6MBFop3TQsgAAAAASUVORK5CYII='>
      </div>
      <div id=view>
            <div id=editor></div>
            <iframe id=iframe></iframe>
      </div>
</body>

<script type=module>
                                                                                console.clear();
      import ace from 'https://cdn.jsdelivr.net/npm/ace-builds/+esm';
      jsonblob        = jsonblob();
      
      var menu        = menumod();
      
      var autosave;
      var autorun;
      var local;
      var github;
      var view;
      var editor;
      var iframe;
      
      var ui          = {};
      ui.menu         = {};
      
      setTimeout(initdom,50);


      window.onmessage    = function(e){
      
            var json    = JSON.parse(e.data);
            if(json.code){
                  editor.setValue(json.code,-1);
            }
            if(json.run){
                  run();
            }
            
      }//onmessage

      
      async function initdom(){   //c
      
            keydown.initdom();
            keydown.add(kd);
            //document.addEventListener('keydown',keydown,true);
            
            $('#new').onclick             = newwin;
            $('#fork').onclick            = fork;
            
            $('#run').onclick             = run;
            $('#save').oncick             = save;
            autosave                      = $('#autosave input');
            autosave.checked              = false;
            autorun                       = $('#autorun input');
            autorun.checked               = false;
            
            
            var node                      = $('#local-menu');
            $('#local').onclick           = menu.click(node,false,false,ui.menu.local);
            github                        = $('.github');
            var node                      = $('#github-menu');
            $('#github').onclick          = menu.click(node,false,false,ui.menu.github);
            
            $('#horiz').onclick           = horiz;
            $('#vert').onclick            = vert;
            
            view                          = $('#view');
            
            editor                        = ace.edit('editor');
            editor.setShowInvisibles(false);
            editor.setShowPrintMargin(false);
            editor.setPrintMarginColumn(false);
            editor.setBehavioursEnabled(false);
            editor.setDisplayIndentGuides(false);
            editor.setScrollSpeed(2);
            editor.setFontSize(16);
            editor.session.setOptions({tabSize:2,useSoftTabs:true});
            //editor.setGhostText('\n\nctrl-enter - run & autosave\nctrl-s - save\nctrl-del - delete');
            editor.focus();
            
            iframe                        = $('iframe');
            
            
            ui.setup();
            
            var json    = await jsonblob.util.query();
            if(json){
                  editor.setValue(json.txt,-1);
                  if(autorun.checked){
                        run();
                  }
            }
            
            view.style.display    = 'flex';
            
      }//initdom
      
      
      ui.read=function(){
      
            var json    = {v:1,txt:editor.getValue()};
            return json;
            
      }//read
      
      ui.setup=function(){
      
            var o   = localStorage.getItem('orientation');
            if(o==='horiz'){
                  horiz();
            }
            
      }//setup
      
      function kd(e){
      
            if(e.key=='Enter' && e.ctrlKey){
                  run();
            }
            if(e.key=='s' && e.ctrlKey){
                  e.preventDefault();
                  var json    = ui.read();
                  jsonblob.util.save(json);
            }
            if(e.key=='Delete' && e.ctrlKey){
                  jsonblob.util.delete()
            }
            
      }//keydown
      
      ui.menu.local=function(type,opt){
      
            if(type=='opt'){
                  if(opt.id=='load'){
                        var input   = document.createElement('input');
                        input.type    = 'file';
                        input.click();
                        input.onchange    = async ()=>{
                        
                                                  var file    = input.files[0];
                                                  var txt     = await file.text();
                                                  editor.setValue(txt,-1);
                                                  
                                            }
                  }
                  if(opt.id=='save'){
                        var blob      = new Blob([editor.getValue()]);
                        var url       = window.URL.createObjectURL(blob);
                        var a         = document.createElement('a');
                        a.href        = url;
                        a.download    = 'file.txt';
                        a.click();
                  }
            }
            
      }//local
      
      ui.menu.github=async function(type,opt){console.log('github',type,opt?.id);
      
            if(type=='opt'){
                  var token     = $(github,'#token').value;
                  var owner     = $(github,'#owner').value;
                  var repo      = $(github,'#repo').value;
                  var branch    = $(github,'#branch').value;
                  var path      = $(github,'#path').value;
                  console.log(owner,repo,branch,path);
                  if(opt.id=='github-load'){
                        var url   = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}`;
                        console.log('load',url);
                        var res   = await fetch(url);
                        var txt   = await res.text();
                        if(!res.ok){
                              alert(txt);
                              return;
                        }
                        editor.setValue(txt,-1);
                  }
                  if(opt.id=='github-save'){
                        var txt         = editor.getValue();
                        var content     = window.btoa(txt);
                        var message     = 'save text';
                        var url         = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
                        var json        = await fetch(url).then(res=>res.json());
                        var sha         = json.sha;
                        var body        = {content,sha,message};
                        body            = JSON.stringify(body);
                        var headers     = {authorization:`Bearer ${token}`};
                        var opts        = {method:'put',headers,body};
                        var res         = await fetch(url,opts);
                        if(res.ok){
                              console.log('saved');
                              return true;
                        }
                        var txt         = await res.text();
                        alert(txt);
                  }
            }
            
      }//github
      
      function newwin(){
      
            var url       = window.location.toString();
            var search    = window.location.search;
            if(search){
                  url     = url.slice(0,-search.length);
            }
            window.open(url);
            
      }//newwin
      
      function fork(){
      }//fork
      
      function save(){
      
            jsonblob.util.save(ui.read());
            
      }//save
      
      function horiz(){
            localStorage.setItem('orientation','horiz');
            view.style.flexDirection        = 'column';
            editor.container.style.width    = '100%';
            editor.container.style.height   = '50%';
            editor.focus();
      }//horiz
      
      function vert(){
            localStorage.setItem('orientation','vert');
            view.style.flexDirection        = 'row';
            editor.container.style.width    = '50%';
            editor.container.style.height   = '100%';
            editor.focus();
      }//vert
      
  //:
  
  
      function run(){
      
            iframe.srcdoc   = editor.getValue();
            if(!autosave.checked)return;
            jsonblob.util.save.debounce(()=>ui.read());
            
      }//run
      
      
  //:
  //:
  
  
function jsonblob(){
//  https://jsonblob.com/api
  var obj   = {};
  
        var url           = 'https://jsonblob.com/api/jsonBlob/';
        var id;
        var time          = 500;
        var timer;
        var headers       = {'content-type':'application/json'};
        
        var util          = {};
        util.query        = {};
        obj.util          = {};
  //:
        obj.util.query=async function(read=false){
        
              var tst     = window.location.search.slice(1);
              if(!tst)return;
              var json    = await read(tst);
              if(!json)return;
              id          = tst;
              return json;
              
        }//query
        
        obj.util.query.set=function(){return util.query.set()}
        util.query.set=function(){
        
              var url       = window.location.toString();
              var search    = window.location.search;
              if(search){
                    url     = url.slice(0,-search.length);
              }
              if(id){
                    url    += '?'+id;
              }
              window.history.replaceState(null,'',url);
              
        }//set
        
        obj.util.save=function(json,set=true){return util.save(json,set=true)}
        util.save=async function(json,set=true){
        
              if(id){
                    await update(id,json);
              }else{
                    await create(json);
              }
              if(set){
                    util.query.set();
              }
              
        }//save
        
        obj.util.save.debounce=function(fn){
        
              clearTimeout(timer);
              var json    = fn();
              timer       = setTimeout(util.save,time,json);
              
        }//debounce
        
        obj.util.delete=async function(set=true){
        
              if(id){
                    var result    = await del(id);
                    if(result){
                          id    = null;
                    }
              }
              if(!set)return;
              util.query.set();
              
        }//delete
        
  //:
  
        obj.create=function(json){return create(json)}
        async function create(json){
        
              var body    = JSON.stringify(json);
              var res     = await fetch(url,{method:'post',headers,body});
              if(!res.ok)return;
              var loc     = res.headers.get('location');
              var i       = loc.lastIndexOf('/');
              id          = loc.slice(i+1);
              return id;
              
        }//create
        
        obj.read=function(id){return read(id)}
        async function read(id){
        
              var res     = await fetch(url+id);
              if(!res.ok)return;
              var json    = await res.json();
              return json;
              
        }//read
        
        obj.update=async function(id,json){return update(id,json)}
        async function update(id,json){
        
              var body    = JSON.stringify(json);
              var res     = await fetch(url+id,{method:'put',headers,body});
              return res.ok;
              
        }//update
        
        obj.delete=function(id){return del(id)}
        async function del(id){
        
              var res   = await fetch(url+id,{method:'delete'});
              return res.ok;
              
        }//delete
        
  return obj;
  
}//jsonblob

</script>


<script>
  //:
  //:
  
        keydown.initdom=function(){
        
              document.addEventListener('keydown',keydown,true);
              
              
        }//initdom
        
        
        keydown.stack   = [];
        
        keydown.add=function(fn){
        
              var i   = keydown.stack.indexOf(fn);
              if(i!=-1)return;
              
              keydown.focus   = true;
              keydown.stack.push(fn)
              
        }//add
        
        keydown.rem=function(fn){
        
              var i   = keydown.stack.indexOf(fn);
              if(i==-1)return;
              keydown.stack.splice(i,1);
              
        }//rem
        
        keydown.pop=function(){
        
              keydown.stack.pop()
              
        }//pop
        
        function keydown(e){
                                                                                var str   = 'keydown';
              var stop      = false;
              var both      = false;
              var prevent   = false;
              
              var result;
              var n   = keydown.stack.length;
              for(var i=n-1;i>=0;i++){
              
                    var fn    = keydown.stack[i];
                    result    = fn(e);
                    if(result!==false){
                          break;
                    }
                    
              }//for
              
              
              if(result){
                    ({stop,prevent,both}   = result);
              }
                                                                                //console.log(str,stop,prevent,both);
              if(stop || both){
                    e.stopPropagation();
              }
              if(prevent || both){
                    e.preventDefault();
              }
              
        }//keydown
        
        
        function datatype(v){
        
              var str   = Object.prototype.toString.call(v);
              str       = str.slice(8,-1);
              str       = str.toLowerCase();
              return str;
              
        }//datatype
        
        datatype.is   = {};
        
        datatype.is.node=function(v){
        
              if(v===null || typeof v!='object'){
                    return false;
              }
              if('nodeType' in v){
                    return true;
              }
              return false;
              
        }//node
        
        function $(root,sel){
        
              if(!sel){
                    if(datatype.is.node(root)){
                          return root;
                    }
                    sel     = root;
                    root    = document;
              }
              var node    = root.querySelector(sel);
              return node;
              
        }//$
        
        $.is    = {};
        
        $.all=function(root,sel){
        
              if(!sel){
                    if(datatype.is.node(root)){
                          return root;
                    }
                    sel     = root;
                    root    = document;
              }
              var list    = [...root.querySelectorAll(sel)];
              return list;
              
        }//all
        
        $.show=function(root,sel){
        
              var node    = $(root,sel);
              if(!node)return;
              node.style.display    = '';
              
        }//show
        
        $.hide=function(root,sel){
        
              var node    = $(root,sel);
              if(!node)return;
              node.style.display    = 'none';
              
        }//hide
        
        $.is.parent=function(par,node){
        
              while(node){
              
                    if(node===par)return true;
                    node    = node.parentNode;
                    
              }//while
              return false;
              
        }//is.parent
        
</script>


<script>

  //:
  //:
        function menumod(){
        
          var obj   = {};
          
  //:
              obj.callback    = {};
              
              var list      = [];
              list.find     = (v,rtype)=>find(list,v,rtype);
              
              
              var stack     = [];
              stack.find    = (v,rtype)=>find(stack,v,rtype);
              
              
              function find(list,v,rtype){
              
                    var n   = list.length;
                    for(var i=0;i<n;i++){
                    
                          var o   = list[i];
                          
                          var f   = false;
                          
                          if(v===i)f    = true;
                          if(v===o.node)f   = true;
                          if(v===o.node.id)f   = true;
                          
                          if(f){
                                switch(rtype){
                                  case 'index'      : return i;
                                  case 'node'       : return o.node;
                                  case 'callback'   : return o.callback;
                                }
                                return o;
                          }
                          
                    }//for
                    return null;
                    
              }//find
              
              
              var state         = {};
              
              state.cur         = null;
              state.prev        = null;
              
              state.opt         = null;
              state.select      = {};
              state.prev_opt    = {};
              
              
              var defz          = 12;
              
              
              var get           = {};
              
  //:
  
              obj.import=function(str){
              
                    state   = JSON.parse(str);
                    
              }//import
              
              
              obj.export=function(){
              
                    var str   = JSON.stringify(state);
                    return str;
                    
              }//export
              
  //:
  
              obj.click=function(node,drag=true,center=true,callback_fns){
              
                    add(node,drag,center,callback_fns);
                    
                    return click;
                    
                    
                    function click(e){
                    
                          open(node);
                          
                    }//click
                    
              }//click
              
  //:
  
              obj.add=function(node,drag='both',center=true,callback){return add(node,drag,center,callback)}
              
              function add(node,drag='both',center=true,callback){
                                                                                //console.log('add');
                    list.push({node,callback});
                    add.node(node,drag,center);
                    
              }//add
              
              
              obj.add.stack=function(node,drag='both',center=true,callback){return add.stack(node,drag,center,callback)}
              
              add.stack=function(node,drag,center,callback){
              
                    var cur                   = get.cur('node');
                    state.prev_opt[cur.id]    = state.opt;
                    
                    stack.push({node,callback});
                    add.node(node,drag,center);
                    
                    show(node);
                    
              }//add.stack
              
              
              add.node=function(node,drag,center){
              
                    node.style.zIndex   = defz;
                    node.tabIndex       = -1;
                    
                    if(drag){
                          $.drag(node,null,drag);
                    }
                    if(center){debugger;
                          $.center.width(node);
                    }
                    
                    var timer;
                    node.addEventListener('focusout',focusout);
                    node.onmouseenter   = e=>clearTimeout(timer);
                    node.onmouseleave   = e=>{
                    
                          timer    = setTimeout(fn,500);
                          
                          function fn(){
                                                                                //console.log('mouseleave',node);
                                var cur       = get.cur('node');
                                                                                //console.log('cur',cur);
                                if(cur!==node){
                                                                                //console.log('cur');
                                      return;
                                }
                                
                                if(stack.length){
                                      stack.pop();
                                      hide(node);
                                      cur   = get.cur('node');
                                      show(cur);
                                      return;
                                }
                                close();
                                
                          }//fn
                          
                    }//ml
                    
                    
                    var opts    = get.opts(node);
                    
                    opts.forEach((opt,i)=>{
                    
                          opt.addEventListener('click',e=>{
                          
                                e.stopPropagation();
                                
                                if(state.opt===i){
                                      state.select[node.id]   = !state.select[node.id];
                                }else{
                                      if(state.opt!==null){
                                            var prev                = opts[state.opt];
                                            prev.style.background   = '';
                                      }
                                      state.select[node.id]   = true;
                                }
                                opt.style.background    = 'lightyellow';
                                state.opt               = i;
                                
                                callback('opt',opt);
                                
                          });//click
                          
                          opt.addEventListener('mouseenter',e=>{
                          
                                  if(state.select[node.id]){
                                        return;
                                  }
                                  if(state.opt!==null){
                                        var prev                = opts[state.opt];
                                        prev.style.background   = '';
                                  }
                                  
                                  opt.style.background    = 'lightyellow';
                                  state.opt               = i;
                                  
                          });//mouseenter
                          
                          opt.addEventListener('mouseleave',e=>{
                          
                                if(state.select[node.id]){
                                      return;
                                }
                                if(state.opt===i){
                                      opt.style.background    = '';
                                      state.opt               = null;
                                }
                                
                          });//onmouseleave
                          
                    });
                    
              }//add.node
              
  //:
  
              obj.open=function(node){return open(node)}
              
              function open(node){
                                                                                //console.log('open',node);
                    if(typeof node=='string'){
                          node    = list.find(node,'node');
                    }
                    
                    if(state.cur!==null){
                          close();
                    }
                    
                    var index;
                    if(!node){
                          if(state.prev===null){
                                if(list.length==0){
                                      return;
                                }
                                index   = 0;
                          }else{
                                index   = state.prev;
                          }
                          node    = list.find(index,'node');
                    }else{
                          index   = list.find(node,'index');
                    }
                    
                    state.cur   = index;
                    show(node);
                    
                    keydown.add(kd);
                    
              }//open
              
              
              obj.close=function(){return close()}
              
              function close(){
                                                                                //console.log('close',state.cur);
                    keydown.rem(kd);
                    
                    if(state.cur===null){
                          return;
                    }
                    
                    var n   = stack.length;
                    for(var i=n-1;i>=0;i--){
                    
                          var node    = get.cur('node');
                          hide(node);
                          stack.pop();
                          
                          node        = get.cur('node');
                          show(node);
                          
                    }//for
                    
                    var node      = list.find(state.cur,'node');
                    hide(node);
                    state.prev    = state.cur;
                    state.cur     = null;
                    
                    editor.focus();
                    
              }//close
              
  //:
  
              function show(node){
                                                                                //console.log('show',node.id);
                    state.opt   = null;
                    
                    var opts    = get.opts(node);
                    if(opts.length){
                          state.opt               = state.prev_opt[node.id]||0;
                          var opt                 = opts[state.opt];
                          opt.style.background    = 'lightyellow';
                    }
                    
                    $.show(node);
                    node.focus();
                    callback('show');
                    
              }//show
              
  //:
  
              function hide(node){
                                                                              //console.log('hide',node.id);
                    state.prev_opt[node.id]       = state.opt;
                    if(typeof state.opt=='number'){
                          var opts                = get.opts(node);
                          var opt                 = opts[state.opt];
                          opt.style.background    = '';
                          state.opt               = null;
                    }
                    
                    $.hide(node);
                    callback('hide');
                    
              }//hide
              
              
              hide.stack=function(){
              
                    var node    = stack.pop().node;
                    hide(node);
                    node        = get.cur('node');
                    show(node);
                    
              }//hide.stack
              
              
              hide.stack.all=function(){
              
                    while(stack.length){
                          hide.stack();
                    }
                    
              }//hide.stack.all
              
  //:
  
              function kd(e){
                                                                                //console.log('menu.kd',e.key);
                    var node      = get.cur('node');
                    var opts      = get.opts(node);
                    
                    var both      = true;
                    
                    switch(e.key){
                    
                      case 'ArrowDown'    : kd.arrowdown(e,node,opts);        break;
                      case 'ArrowUp'      : kd.arrowup(e,node,opts);          break;
                      case 'ArrowLeft'    : kd.arrowleft(e,node,opts);        break;
                      case 'ArrowRight'   : kd.arrowright(e,node,opts);       break;
                      case 'Enter'        : kd.enter(e,node,opts);            break;
                      case 'Escape'       : kd.escape(e,node,opts);           break;
                      case 'Tab'          : kd.tab(e,node,opts);              break;
                      
                      default             : both    = false;
                      
                    }//switch
                    
                    return {both};
                    
              }//kd
              
              
              kd.arrowdown=function(e,node,opts){
              
                    if(opts.length==0)return;
                    
                    if(typeof state.opt=='number'){
                          if(state.opt===opts.length-1){
                                return;
                          }
                          var opt                 = opts[state.opt];
                          opt.style.background    = '';
                          state.opt++;
                    }else{
                          state.opt   = 0;
                    }
                    var opt                 = opts[state.opt];
                    opt.style.background    = 'lightyellow';
                    state.select[node.id]   = false;
                    
              }//arrowdown
              
              
              kd.arrowup=function(e,node,opts){
              
                    if(opts.length==0)return;
                    
                    if(typeof state.opt=='number'){
                          if(state.opt==0){
                                return;
                          }
                          var opt   = opts[state.opt];
                          opt.style.background    = '';
                          state.opt--;
                    }else{
                          state.opt   = opts.length-1;
                    }
                    var opt                 = opts[state.opt];
                    opt.style.background    = 'lightyellow';
                    state.select[node.id]   = false;
                    
                    both    = true;
                    
              }//arrowup
              
              
              kd.arrowleft=function(e,node,opts){
              
                    if(stack.length){
                          return;
                    }
                    var cur       = state.cur;
                    hide(node);
                    cur--;
                    if(cur<0){
                          cur   = list.length-1;
                    }
                    state.cur   = cur;
                    node        = list.find(cur,'node');
                    show(node);
                    
                    both    = true;
                    
              }//arrowleft
              
              
              kd.arrowright=function(e,node,opts){
                                                                                //console.clear();console.log('arrowright');
                    if(stack.length){
                          return;
                    }
                    var cur     = state.cur;
                    hide(node);
                    cur++;
                    if(cur==list.length){
                          cur   = 0;
                    }
                    state.cur   = cur;
                    node        = list.find(cur,'node');
                    show(node);
                    
                    both    = true;
                    
              }//arrowright
              
              
              kd.enter=function(e,node,opts){
              
                    if(typeof state.opt!='number'){
                          return;
                    }
                    state.select[node.id]   = true;   //!state.select[node.id];
                    var opt                 = opts[state.opt];
                    callback('opt',opt);
                    
                    both    = true;
                    
              }//enter
              
              
              kd.escape=function(e,node,opts){
              
                    if(stack.length){
                          hide.stack();
                          return;
                    }
                    close();
                    
                    both    = true;
                    
              }//escape
              
              
              kd.tab=function(e,node,opts){
                                                                                //console.clear();console.log('tab');
                    if(stack.length){
                          return;
                    }
                    hide(node);
                    state.cur   = 0;
                    node        = list.find(0,'node');
                    show(node);
                    both    = true;
                    
              }//tab
              
              
  //:
  
  
              function focusout(e){
                                                                                //console.log('focusout');
                    var focus   = e.relatedTarget;
                                                                                //console.log(focus);
                    if(chk(focus)){
                                                                                //console.log('list');
                          return;
                    }
                    close();
                    
                    
                    function chk(){
                    
                          var n   = list.length;
                          for(var i=0;i<n;i++){
                          
                                var o    = list[i];
                                if($.is.parent(o.node,focus)){
                                                                                //console.log('list',o.node);
                                      return true;
                                }
                                
                          }//for
                          
                          var n   = stack.length;
                          for(var i=0;i<n;i++){
                          
                                var o   = stack[i];
                                if($.is.parent(o.node,focus)){
                                                                                //console.log('stack',o.node);
                                      return true;
                                }
                                
                          }//for
                          
                          return false;
                          
                    }//chk
                    
              }//onfocusout
              
  //:
  
              function callback(type,arg0){
              
                    var callback    = get.cur('callback');
                    if(typeof callback!='function'){
                          return;
                    }
                    callback.apply(null,arguments);
                    
              }//callback
              
  //:
  
              get.cur=function(rtype){
              
                    var cur   = list.find(state.cur,rtype);
                    if(stack.length){
                          cur   = stack.at(-1)[rtype];
                    }
                    return cur;
                    
              }//cur
              
              
              get.opts=function(node){
              
                    var list    = $.all(node,'.menu-opt');
                    list        = list.filter(opt=>{
                    
                          var menu    = opt.closest('.menu');
                          if(menu===node){
                                return true;
                          }
                          return false;
                          
                    });
                    return list;
                    
              }//opts
              
              
          return obj;
          
        }//menumodmod
        
</script>

<style>
/*
  //menu:
*/
        .menu-hdr {
              white-space           : nowrap;
              align-items           : center;
              border                : 1px solid lightgray;
              box-sizing            : border-box;
              border-radius         : 5px;
              position              : relative;
              cursor                : pointer;
              display               : inline-flex;
              margin-right          : 10px;
              padding               : 0px 10px;
              height                : 30px;
        }
        
        .menu {
              border                : 3px solid cyan;
              border-radius         : 7px;
              box-shadow            : rgba(0, 0, 250, 0.5) 0px 13px 45px -10px;
              background            : whitesmoke;
              box-sizing            : border-box;
              padding               : 10px;
              outline               : none;
        }
        
        .menu-title {
              text-align            : center;
              background            : rgb(13,152,186);
              margin-bottom         : 10px;
              padding               : 3px;
              color                 : white;
              font-weight           : bold;
        }
        
        .menu-opt {
              white-space           : nowrap;
              cursor                : pointer;
              margin-bottom         : 10px;
              display               : flex;
              justify-content       : space-between;
              align-items           : center;
              padding               : 5px 10px;
        }
        
</style>
