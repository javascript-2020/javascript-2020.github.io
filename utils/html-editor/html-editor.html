<style>
      html,body{margin:0;height:100%}
      body {display:flex}
      #editor{flex:1}
      iframe{width:50%;box-sizing:border-box}
</style>

<body>
      <div id=editor></div>
      <iframe id=iframe></iframe>
</body>

<script type=module>

      import ace from 'https://cdn.jsdelivr.net/npm/ace-builds/+esm';
      var url   = 'https://jsonblob.com/api/jsonBlob/';
      var id;
      
      var editor                    = ace.edit('editor');
      editor.container.onkeydown    = e=>{e.key=='Enter' && e.ctrlKey && (iframe.srcDoc=editor.getValue());save.debounce()}
      editor.setShowInvisibles(false);
      editor.setShowPrintMargin(false);
      editor.setPrintMarginColumn(false);
      editor.setBehavioursEnabled(false);
      editor.setDisplayIndentGuides(false);
      editor.setScrollSpeed(2);
      editor.setFontSize(16);
      editor.focus();
      
      save.time       = 5000;
      save.debounce   = ()=>{clearTimeout(save.timer);save.timer=setTimeout(save,save.time)};
      async function save(){
      
            var body    = JSON.stringify({v:1,txt:editor.getValue});
            if(id)fetch(url+id,{method:'put',body});
            else{
                  var res                   = await fetch(url,{method:'post',body});
                  window.location.search    = res.headers.get('location');
                  
            }
            
      }//save
      
      var str     = window.location.toString();
      var i       = str.indexOf('?');
      if(i!=-1){
            id          = str.slice(i+1);
            var res     = await fetch(url+id)
            if(res.ok){
                  var txt     = await res.text();
                  var json    = JSON.parse(txt);
                  editor.setValue(json.txt,-1);
            }
      }
      
</script>
