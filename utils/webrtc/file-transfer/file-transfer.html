

<html>

      <head>

            <title>html-editor</title>

            <base href='https://javascript-2020.github.io/utils/editors/html-editor/html-editor.html'>
            
            <link rel=icon type='image/png' href='images/html-editor-favicon.png'>
            <link rel=stylesheet href='/utils/css/utils.css'>


            <script init>
                                                                                console.clear();
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));
        var version       = 'v1.0';
            
        var df            = true;


        var ext;
        var $;
        var datatype;
        var menumod;
        var keydown;

        
        var mod           = {};
      
        var filemod;                                                                                


        async function init(){
                                                                                debug('init',version);

              //keydown                   = keydown();
              menumod                   = menumod();
              filemod                   = mod.filemod();
              log                       = mod.log();

              filemod.initmod({ext,$,menumod,complete});


              log.initmod({ext,$});



              filemod.init();


              log.init();


  //:
          


              init.complete();


  //:
  
  
              initdom(document.body);
              
              

        }//init


        init.stack            = [];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = '';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              init.stack.ct>=init.stack.total && init();
        }});
        
        //  (typeof init!='undefined' && init?.stack && init.stack.add)
        //  (typeof init!='undefined' && init?.stack && init.stack.complete)

        
        init.complete   = function(){
          
              init.complete.stack.forEach(fn=>fn());
              
        }//complete
        
        init.complete.stack   = [];
        init.complete.add     = fn=>init.complete.stack.push(fn);

                  

(async()=>{
  
        init.stack.add;
        
        var token   = localStorage['github-token'];
        var url;
        var headers;
        if(token){
              url       = 'https://api.github.com/repos/javascript-2020/ext-code/contents/ext-loader.js';
              headers   = {accept:'application/vnd.github.raw',authorization:`bearer ${token}`};
        }else{
              url       = 'https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js';
        }
        
        await fetch(url,{headers}).then(res=>res.text()).then(complete);

            
        async function complete(txt){

              ext           = eval(txt);
              var promise   = ext.load.libs(
                    'js/dom/$.js.api',
                    'js/core/datatype.js',
                    'js/dom/menumod/menumod.js',
                    'js/dom/keydown/keydown.js'
              );
              [$,datatype,menumod,keydown,encrypt]   = await promise;

              init.stack.complete;

        }//ext_fn

})();


            </script init>


      

      </head>
      
      
      <body>

            <style id=page-inline>

            </style>
            
            
            </style>
            
<!--
            <hdr-grp-api>
                  <script src='https://html-loader-1024713184986.us-central1.run.app/'></script>
                  <img class=title src='images/html-editor.png' style='top:-5px;height:55px'>
                  <span slot=date>11 Jun 2025</span>
            </hdr-grp-api>
-->            


            <filemod-api>
                  <script src='https://html-loader-1024713184986.us-central1.run.app/'></script>
            </filemod-api>


            </div>

            
            <div id=view>

                  <div id=server-root>
                  
                        <label>
                              server
                        </label>
                        <input id=server>
                  
                        <input value=connect type=button>
                        
                  </div>
                  
                  
                  
                  
            </div>
            

            <log api>
                  <script src='https://html-loader-1024713184986.us-central1.run.app/'></script>
            </log>

            
      
      </body>



      <script>

        var mode;
        
        var btn   = {};
        
      
        async function initdom(rootnode){   //c
                                                                                debug('initdom');
              var root                      = rootnode;
              
              keydown.initdom();
              menumod.add.style();



              $(root,'[value=connect]').onclick   = btn.connect;
              


              filemod.initdom(root);



              log.initdom();


        }//initdom


  //:
  

        btn.connect   = function(){
          
              var url   = $(root,'#server').value;
              create_ws(url);
              
        }//connect
        
        
  //:
  
  
        function create_ws(url){
          
              ws              = new WebSocket(url);
              ws.onopen       = e=>console.log('open');
              ws.onclose      = e=>console.log('close');
              ws.onerror      = e=>console.log('error');
              ws.onmessage    = onmessage;
              
              function onmessage({data}){
                
                    switch(data.type){
                      
                      case 'init'       : onmessage.init(data);         break;
                      case 'offer'      : onmessage.offer(data);        break;
                      case 'answer'     : onmessage.answer(data);       break;
                      case 'sdp'        : onmessage.sdp(data);          break;
                      case 'ice'        : onmessage.ice(data);          break;
                                            
                    }//switch
                    
              }//onmessage
              
              
              onmessage.init    = function(data){
                
                    mode    = data.mode;
                    
              }//init
              
              
              onmessage.offer   = function(data){
              }//offer
              
              
              onmessage.answer    = function(data){
              }//answer
              
              
              onmessage.sdp   = function(data){
              }//sdp
              
              
              onmessage.ice   = function(data){
              }//ice

              
        }//create_ws
        
        
  //:
  
  
        function complete(){
        }//complete

        
  //:
  
  
        function debug(){
          
          if(!df)return;
          var str   = [...arguments].join(' ');
          console.log('[ file-transfer ]',str);
          
        }//debug
        

        
        init.stack.complete;

      
      </script>
      
      
      
      
</html>


