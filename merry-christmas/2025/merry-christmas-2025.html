

<!DOCTYPE html>

<html lang=en>

      <head>
            <meta charset=utf-8>
            
            <title>
                  Merry Christmas 2025
            </title>
            
            <base href='https://ext-code.com/merry-christmas/merry-christmas-2025/'>
            <link rel=canonical href='https://ext-code.com/merry-christmas/merry-christmas-2025/merry-christmas-2025.html'>
            
            <meta name=viewport content='user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1'>
            <link rel=icon href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAXCAMAAAAr4Q9YAAACBFBMVEVHcEygNjvh3d+hHx/Mtbndysy+DRDp6ei4HSOYvLPq5eXQwMHBFBrLsrXbGhquJCy3IiEywKu/FRitIynZBxC3GRzSFyPp5OTj4N/MDhrl5OTmycvTDxThIh7m5eW6FR7n4+XGEBfFEhjhx8ri2du5ExXlzs/hFxbn8fDMDRDk4uLq6unjzc/Ntrvm5efQubzPtrnn5ubp7u7axsfJDhTWHyTVeHmyDRaoFhrLCBOTIyTMFSnuKiTm4+Ph2tjMzc/i4eHp4+PZKifLvL3iysy+ExTPvb7hy83BCA7z8PHPvr7j09Tjzc3w7O369vfKCQ3r6+v59PTdfYHYkJLLGRjUHB/5+Pjy8fH29vXy8u708e76+fn9/v739/f19fTy8O/gDA7z6ejx4uH0Hx3nDAzkAgXcBwrtKCj6Jx/z8/Pq6eny5eTjDhDUDQvqBAftGhvIBAjnHB77/Pu6BguyBwzw7u7u7OzRBgj1JB3YDA/4LyfPEhTeEBTWExftBRfz0ND7NzHyGRXvISPYBQnOCg35IxvhBxHsFRPSGx3wIyDZEBT1Eh/i1tX5IBP2EQ35GBjXAxXzBhH+Myr21tfgIia+AwnEDQ7t4eDpDBzEExDJCQrvuLnzxMTwp6ftjo3mKTL58e/9KSb34+LpbW7mT1DhNjfptLTm5uanBQrfm5vVhobj19aiEXDQAAAAVnRSTlMABhQJGf3EszUC+1aqJLggLQGDGe9WVJhCkGH427Aj2vPreN6uz9n0DMIn5O1iS0UyjRWOn4n5mUjxD0fohekIceFeUdn5jOf+unP23yrp8M/F44dk+fsfi/cAAAH1SURBVCjPY2BAAE5GZmZGBuyAUUzShI+PT9bUSYAZi7S1SNuM7owqILCRFcMwg5GnpXJGd3JGRkVyY7u6ELoBHIotuQk5OTkJac1pbXlpSoIosoJC0yoTEtLKC6YWTy1oTk0VEUWRFlatzkloLigpKSkuKE9LzUuV4UCWFnWtSSgvXlHcUtnVVZOTkpeXqimM7LDqnHKPkur2xvzCwvz8xr6+iW2SjEgOq0nwl6/NSUlpz29qSu7t7Z9YZ2kBlzatzck1YZs1a9rMjsKmzoqMjNbuugnmMNfzy9RUsgmozqzumJJe1dDQMGnSwv66CWxWIDkjXw2l2i42gRD1zoqK1taK5IrO9PT0+VM65PmBsnKefoFBoTz8zJq5ubm1U5YuWTxv7uw59ZMn10uLGzEwSJVGZCYGMxsZm5mtWrmsftGC6KKYmJii6LCw2HBxewYprrIsLj0Gw/iwIqB4EVA8OjosNi4us7QsS0GPgcnWUUGFiSkgPBYIIiLi4iKAIC4cKJmVtdwQmAi0JJgYtLRLw8EgMxMkH5eZGR4eH1/GDvWanHZZKRDEA0EUEESCiPj4Upi0BnsiGGRnJyUlZYPI6UDA5QALNwm7np7VPd467srKLmpqPjrSrECgwgQPV25jNy9ufQNeXhYg4DXQ59bVdWZhIAAATk+gYTNMAnMAAAAASUVORK5CYII='>
            
            
            <link rel=stylesheet href='https://fonts.googleapis.com/css2?family=Allura&display=swap'>


            <style>
      
  html
    {font-family:allura;color:#c5a880;background:#00101a}
    
  body
    {overflow:hidden;background:#00101a;opacity:0;transition:all 1s;
      --fs-title:110px;
      --fs-link:50px;
      --fs-prev:50px;
      --fs-click:50px;
      --fs-loading:50px;
      --top-title:100px;
      --bottom-click:270px;
    }

  @media(max-height:1200px){
    body
      { --fs-title:50px;
        --fs-link:25px;
        --fs-prev:25px;
        --fs-loading:16px;
        --top-title:60px;
        --bottom-click:50px;
      }
  }
  
  @media (max-width:767px){
    body
      { --fs-title:50px;
        --fs-link:20px;
        --fs-prev:20px;
        --fs-loading:20px;
        --top-title:30px;
        --bottom-click:50px;
      }
  }
  
  
  
  
  canvas 
    {position:fixed;width:100vw;height:100vh}

  #link
    {position:absolute;left:0;right:0;top:20px;text-align:center;font-size:var(--fs-link);color:#c5a880}
    
  #xmas-2024
    {position:absolute;left:20px;top:20px;font-size:var(--fs-prev);color:#c5a880}
    
  h2
    {position:absolute;left:0;right:0;top:var(--top-title);text-align:center;font-size:var(--fs-title)}

  
  #info
    {position:absolute;bottom:0;left:0;right:0;margin:auto;text-align:center}
    
  h3
    {position:absolute;bottom:var(--bottom-click);left:0;right:0;margin:auto;text-align:center;font-size:var(--fs-click)}
    
  #loading
    {position:absolute;bottom:20px;left:0;right:0;margin:auto;text-align:center;font-size:var(--fs-loading)}
    
  

            </style>
      
      
      </head>


      <body>
      
            <canvas></canvas>
            
            
            <a id=link href='https://javascript-2020.github.io'>
                  javascript-2020.github.io
            </a>
      
            <a id=xmas-2024 href='https://javascript-2020.github.io/merry-christmas/2024/merry-christmas-2024.html'>
                  2024
            </a>
            
            
            
            <h2>
                  Merry Christmas
            </h2>
            
       
            <h3>
                  click - 
                  <span id=play>
                        play
                  </span>
            </h3>
            

            <div id=loading>
                  loading ...
            </div>
            


      </body>


      <script type=module>
                                                                                console.clear();
                                                                                console.log('xmas3');



        import * as THREE from "https://cdn.skypack.dev/three@0.135.0";
        

        var $   = (root,css)=>((!css && (css=root,root=document)),root.querySelector(css));
        $.all   = (root,css)=>((!css && (css=root,root=document)),root.querySelectorAll(css));
        
        var canvas            = $('canvas');

        var fieldOfView       = 75;
        var nearPlane         = 0.1;
        var farPlane          = 100;
        var cameraPosition    = {x:0,y:0,z:4.5};
        
        var time               = {current:0,t0:0,t1:0,t:0,frequency:0.0005};
        
        var width     = window.innerWidth;
        var height    = window.innerHeight;
        console.log(width,height);
        
        var aspectRatio        = width/height;
        var pixelRatio         = Math.min(window.devicePixelRatio,2);


        var clock             = new THREE.Clock();
        var sound;
        var analyser;


        var scene             = new THREE.Scene();
        scene.background      = new THREE.Color("#00101a");

        var camera             = new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane);
        camera.position.set(cameraPosition.x,cameraPosition.y,cameraPosition.z);
        scene.add(camera);
        var renderer           = new THREE.WebGLRenderer({
                                        canvas,
                                        powerPreference   : 'high-performance',
                                        antialias         : false,
                                        stencil           : false,
                                        depth             : false
                                  });
        renderer.setPixelRatio(pixelRatio);
        renderer.setSize(width,height);


        var spiralMaterial;
        var spiral;
        var starMesh;
        var starMaterial;
        


        var parameters   = {
              count   : 1500,
              max     : 12.5*Math.PI,
        };

        var isRunning;


        
        var step=0;

        var uniforms          = {
                                      time          : {type:'f',value:0.0},
                                      step          : {type:'f',value:0.0},
                                      tAudioData    : {value:null},
                                      
                                      test          : {type:'f',value:1.0},
                                };
        var params            = {
                                      exposure          : 1,
                                      bloomStrength     : 0.9,
                                      bloomThreshold    : 0,
                                      bloomRadius       : 0.5,
                                };
                                
        var listener          = new THREE.AudioListener();
        var audio             = new THREE.Audio(listener);





        var sprites   = [
              'https://javascript-2020.github.io/storage/images/snowflake1.png',
              'https://javascript-2020.github.io/storage/images/snowflake2.png',
              'https://javascript-2020.github.io/storage/images/snowflake3.png',
              'https://javascript-2020.github.io/storage/images/snowflake4.png',
              'https://javascript-2020.github.io/storage/images/snowflake5.png',
        ];
        

  //:
  
        window.onload             = e=>document.body.style.opacity=1;
        
        window.onresize           = resize;
        
        document.body.onclick     = e=>{console.log('click');
        
                                      if(!analyser){
                                            console.log(analyser);
                                            return;
                                      }
                                      
                                      console.log(sound.isPlaying);
                                      
                                      if(sound.isPlaying){
                                            $('#play').textContent    = 'play';
                                            sound.pause();
                                            return;
                                      }
                                      
                                      sound.play();
                                      time.t0     = time.elapsed;
                                      isRunning   = true;
                                      $('#play').textContent    = 'pause';                                            
                                      
                                }//play
                
        $.all('a').forEach(a=>a.onclick=e=>e.stopImmediatePropagation());



        loadMusic();


        
        setTimeout(start,50);

        function start(){
          
              addSpiral();
              addSnow();
              addStar();
              
              loop(0);
              
        }//start


        
  //:
  
        
        
        
        


        
        
        function resize(){
          
              width     = window.innerWidth;
              height    = window.innerHeight;
        
              camera.aspect   = width/height;
              camera.updateProjectionMatrix();
        
              renderer.setSize(width,height);
              //composer.setSize(width,height);
              
        }//resize


        function loadMusic() {
          
              var listener    = new THREE.AudioListener();
              sound           = new THREE.Audio(listener);
              camera.add(listener);
              
              var audioLoader   = new THREE.AudioLoader();
              audioLoader.load('https://assets.codepen.io/74321/short-snow_01.mp3',
              
                    buffer=>{
                      
                          sound.setBuffer(buffer);
                          sound.setLoop(false);
                          sound.setVolume(1.0);
                          analyser    = new THREE.AudioAnalyser(sound,32);
                          $('#loading').style.display   = 'none';
                      
                    },
                    
                    progress=>{},
                    error=>console.log(error)
                    
              );
            
        }//loadMusic
  


  
/*

function postProcessing() {

    this.composer = new EffectComposer(this.renderer);
    this.composer.addPass(new RenderPass(this.scene, this.camera));
    this.composer.addPass(
      new EffectPass(
        this.camera,
        new BloomEffect({
          blendFunction: BlendFunction.SCREEN,
          kernelSize: KernelSize.MEDIUM,
          luminanceThreshold: 0.4,
          intensity: 2.6,
          luminanceSmoothing: 0.4,
          height: 480
        })
      )
    );
    
}
*/
  






  
  
              function loop(time2){
                
                    time.elapsed    = clock.getElapsedTime();
                    time.delta      = Math.min(60,(time.current-time.elapsed)*1000);
                    
                    var avg         = 1;
                    var data        = 0;


                    
                    if(analyser && isRunning){
                          time.t      = time.elapsed-time.t0+time.t1;
                          avg         = analyser.getAverageFrequency();
                          data        = avg;
                          data       *= data/2000;
                          
                          var justFinished    = isRunning && !sound.isPlaying;                          
                          if(justFinished){
                                time.t1                   = time.t;
                                $('#play').textContent    = 'play';
                                isRunning                 = false;
                          }
                    }
                    
                    
                    
                    camera.lookAt(scene.position);
                    
                    
                    spiralMaterial.uniforms.uTime.value   += time.delta*time.frequency*(1+data*0.2);


                    
                    step                                    = (step+1)%1000;
                    uniforms.time.value                     = time2;
                    uniforms.step.value                     = step;
            





                    var intensity   = avg/256.0;
                    
                    
                    starMaterial.uniforms.uSize.value       = 0.1+intensity*0.7;
                    starMaterial.uniforms.uOpacity.value    = 0.5+intensity*0.5;
                    starMaterial.uniforms.uTime.value       = time.elapsed;

                    
                    spiralMaterial.uniforms.uSize.value     = 0.045+intensity*0.05;
                    spiralMaterial.uniforms.uAudio.value    = intensity;
                    
                    
                    starMesh2.rotation.y+=0.01;
            






                    renderer.render(scene,camera);
                    
                    
                
                    time.current    = time.elapsed;

                    
                    requestAnimationFrame(loop);


            
              }//loop











        
        
        function addSpiral(world){
          
              var vertexShader    = `
              
                      uniform float uTime;
                      uniform float uSize;
                      
                      attribute float aScale;
                      attribute vec3 aColor;
                      attribute float phi;
                      attribute float random;
                      
                      varying vec2 vUv;
                      varying vec3 vColor;
                      varying float vRandom;

                      
                      void main() {
                        
                            float angle     = phi;
                            angle          += uTime*random*1.2;
                            angle           = mod(angle,39.3);
                            float radius    = 0.065*angle;
                            float rand      = (random-0.5)*0.05*pow(angle,0.75);
                            vec3 myOffset   = vec3(
                                                    radius*cos(angle)+rand,
                                                    2.9-2.7*radius+rand+0.1*(random-0.5)*pow(angle,0.25)*sin(2.0*uTime)+2.0,
                                                    radius*sin(angle)+rand-5.0
                                              );
                            vec3 myPosition       = myOffset;
                            vec4 modelPosition    = modelMatrix*vec4(myPosition,1.0);
                          
                            vec4 viewPosition     = viewMatrix*modelPosition;
                            viewPosition.xyz     += position*aScale*uSize;
                            gl_Position           = projectionMatrix*viewPosition;
                          
                            vColor    = aColor;
                            vUv       = uv;
                            vRandom   = random;
                            
                      }//main
                          
              `;
              
              var fragmentShader    = `
              
                      uniform float uTime;
                      uniform float uAudio;
                      
                      varying vec3 vColor;
                      varying vec2 vUv;
                      varying float vRandom;
                      
                      
                      void main() {
                        
                            vec2 uv           = vUv;
                                                                          
                            float strength    = distance(uv,vec2(0.5));
                            strength         *= 2.0;
                            strength          = 1.0-strength;
                          
                            float sparkle     = 0.75+0.25*sin(uTime*30.0+vRandom*20.0);
                            //sparkle          *= (0.5+uAudio);
                            sparkle           = pow(sparkle, 2.0);
                          
                            vec3 color        = vColor*strength*sparkle;
                            gl_FragColor      = vec4(color,1.0);
                            
                      }//main
              
              `;
              
              var uniforms    = {
                    uTime     : {value:0},
                    uSize     : {value:0.045},
                    uAudio    : {value:1.0},
              };
              spiralMaterial    = new THREE.ShaderMaterial({vertexShader,fragmentShader,uniforms,depthWrite:false,blending:THREE.AdditiveBlending});
              
              var count                   = parameters.count;
              var scales                  = new Float32Array(count*1);
              var colors                  = new Float32Array(count*3);
              var phis                    = new Float32Array(count);
              var randoms                 = new Float32Array(count);
              var randoms1                = new Float32Array(count);
              var colorChoices            = ['pink','green','cyan','wheat','red'];
          
              var squareGeometry          = new THREE.PlaneGeometry(1,1);
              var instancedGeometry       = new THREE.InstancedBufferGeometry();
              
              Object.keys(squareGeometry.attributes).forEach(attr=>instancedGeometry.attributes[attr]=squareGeometry.attributes[attr]);
              
              instancedGeometry.index              = squareGeometry.index;
              instancedGeometry.maxInstancedCount  = count;
          
              for(let i=0;i<count;i++){
                
                    var i3              = 3*i;
                    var colorIndex      = Math.floor(Math.random()*colorChoices.length);
                    var color           = new THREE.Color(colorChoices[colorIndex]);
                    phis[i]             = Math.random()*parameters.max;
                    randoms[i]          = Math.random();
                    scales[i]           = Math.random()*3;
                    colors[i3+0]        = color.r;
                    colors[i3+1]        = color.g;
                    colors[i3+2]        = color.b;
                    
              }//for
              
              instancedGeometry.setAttribute('phi',new THREE.InstancedBufferAttribute(phis,1,false));
              instancedGeometry.setAttribute('random',new THREE.InstancedBufferAttribute(randoms,1,false));
              instancedGeometry.setAttribute('aScale',new THREE.InstancedBufferAttribute(scales,1,false));
              instancedGeometry.setAttribute('aColor',new THREE.InstancedBufferAttribute(colors,3,false));
              
              spiral   = new THREE.Mesh(instancedGeometry,spiralMaterial);

spiral.position.set(0,-1,0);
//spiral.rotation.y = Math.PI/4;
spiral.scale.set(1,1,1);

              scene.add(spiral);
              
        }//addSprial
        


        function addSnow(world){
        
              const vertexShader    = `
              
                    attribute float size;
                    attribute float phase;
                    attribute float phaseSecondary;
                    
                    varying vec3 vColor;
                    varying float opacity;
                    
                    uniform float time;
                    uniform float step;
                    
                    
                    float norm(float value,float min,float max){
                    
                          return (value-min)/(max-min);
                          
                    }//norm

                    
                    float lerp(float norm,float min,float max){
                    
                            return (max-min)*norm+min;
                            
                    }//lerp

                    
                    float map(float value,float sourceMin,float sourceMax,float destMin,float destMax){
                    
                          return lerp(norm(value,sourceMin,sourceMax),destMin,destMax);
                          
                    }//map

                    
                    mat3 rotateX(float angle) {
                    
                        float s = sin(angle);
                        float c = cos(angle);
                        return mat3(
                            1.0, 0.0, 0.0,
                            0.0, c, -s,
                            0.0, s,  c
                        );
                        
                    }//rotateX
                    
                    mat3 rotateZ(float angle) {
                    
                        float s = sin(angle);
                        float c = cos(angle);
                        return mat3(
                            c, -s, 0.0,
                            s,  c, 0.0,
                            0.0, 0.0, 1.0
                        );
                        
                    }//rotateY
                    

                    void main() {
                    
                        float t           = time*0.0006;
                        
                        vColor            = color;
                        
                        vec3 p            = position;
                        p.y               = map(mod(phase+step,1000.0),0.0,1000.0,25.0,-8.0);
                        p.x              += sin(t+phase);
                        p.z              += sin(t+phaseSecondary);
                        
                        //p                 = rotateX(radians(20.0)) * p;

                        opacity           = map(p.z,-150.0,15.0,0.0,1.0);
                        vec4 mvPosition   = modelViewMatrix*vec4(p,1.0);
                        gl_PointSize      = size*(100.0/-mvPosition.z);
                        gl_Position       = projectionMatrix*mvPosition;
                        
                    }//main
                    
              `;
              
              const fragmentShader    = `
              
                    uniform sampler2D pointTexture;
                    
                    varying vec3 vColor;
                    varying float opacity;
                    
                    
                    void main() {
                    
                          gl_FragColor    = vec4(vColor,opacity);
                          gl_FragColor    = gl_FragColor*texture2D(pointTexture,gl_PointCoord);
                          
                    }//main
                    
              `;
              
              
              sprites.forEach(create);
              
              function create(sprite){
              
                    var totalPoints       = 500;
                    
                    var value               = new THREE.TextureLoader().load(sprite);
                    var pointTexture        = {value};
                    const shaderMaterial    = new THREE.ShaderMaterial({
                          vertexShader,
                          fragmentShader,
                          uniforms        : {...uniforms,pointTexture},
                          blending        : THREE.AdditiveBlending,
                          depthTest       : false,
                          transparent     : true,
                          vertexColors    : true,
                    });
                    
                    
                    var positions           = [];
                    var colors              = [];
                    var sizes               = [];
                    var phases              = [];
                    var phaseSecondaries    = [];
                    var color               = new THREE.Color();
                    
                    for(let i=0;i<totalPoints;i++){
                    
                          var x   = rand(25,-25);
                          var y   = 0;
                          var z   = rand(15,-150);
                          positions.push(x,y,z);
                          
                          color.set(randChoise(["#f1d4d4","#f1f6f9","#eeeeee","#f1f1e8"]));
                          colors.push(color.r,color.g,color.b);
                          
                          phases.push(rand(1000));
                          phaseSecondaries.push(rand(1000));
                          
                          sizes.push(rand(4,2));
                          
                    }//for
                    
                    
                    var geometry    = new THREE.BufferGeometry();
                    var attr;
                    
                    attr    = new THREE.Float32BufferAttribute(positions,3);
                    geometry.setAttribute('position',attr);
                    
                    attr    = new THREE.Float32BufferAttribute(colors,3);
                    geometry.setAttribute('color',attr);
                    
                    attr    = new THREE.Float32BufferAttribute(sizes,1);
                    geometry.setAttribute('size',attr);
                    
                    attr    = new THREE.Float32BufferAttribute(phases,1);
                    geometry.setAttribute('phase',attr);
                    
                    attr    = new THREE.Float32BufferAttribute(phaseSecondaries,1);
                    geometry.setAttribute('phaseSecondary',attr);
                    
                    
                    var mesh    = new THREE.Points(geometry,shaderMaterial);
                    scene.add(mesh);
                    
              }//createSnowSet
              
        }//addSnow



        function rand(max,min=0){return min+Math.random()*(max-min)}
        function randChoise(arr){return arr[randInt(arr.length)]}
        function randInt(max,min=0){return Math.floor(min+Math.random()*(max-min))}


        function addStar(world){
          
              var vertexShader    = `

                    uniform float uTime;
                    uniform float uSize;
                    varying vec2 vUv;
                    varying vec3 vColor;
                    
                    void main() {
                    
                          vUv = uv;
                          vColor = vec3(1.0, 0.84, 0.0); // gold color
                        
                          vec3 scaledPosition = position * uSize;
                          vec4 mvPosition = modelViewMatrix * vec4(scaledPosition, 1.0);
                          gl_Position = projectionMatrix * mvPosition;
                      
                    }//main
                    
              `;
              
              var fragmentShader    = `
              
                    uniform float uTime;
                    uniform float uOpacity;
                    varying vec3 vColor;
                    varying vec2 vUv;
                    
                    void main() {
                    
                          vec2 uv = vUv;
                          float strength = distance(uv, vec2(0.5));
                          strength *= 2.0;
                          strength = 1.0 - strength;
                        
                          float sparkle = 0.75 + 0.25 * 1.0;
                          sparkle = pow(sparkle, 2.0);
                          //sparkle=2.0
                        
                          vec3 color = vColor * strength * sparkle;
                          gl_FragColor = vec4(color,uOpacity);
                          
                    }//main
                    
              `;
              
              
              var uniforms    = {
                    uTime       : {value:0},
                    uSize       : {value:0.2},
                    uOpacity    : {value:1.0},
              };
              starMaterial    = new THREE.ShaderMaterial({vertexShader,fragmentShader,uniforms,transparent:true,blending:THREE.AdditiveBlending});
              
              var starGeometry    = new THREE.PlaneGeometry(1,1);
              starMesh        = new THREE.Mesh(starGeometry,starMaterial);
              
              starMesh.position.set(0,1.95,0);
              
              scene.add(starMesh);
              
addStar2();

        }//addStar

var starMesh2;


        function addStar2(){
          
              // Create a 2D star shape
              const starShape = new THREE.Shape();
              const spikes = 5;
              const outerRadius = 2;
              const innerRadius = 0.8;
              
              for (let i = 0; i < spikes * 2; i++) {
                const angle = (i / (spikes * 2)) * Math.PI * 2;
                const radius = i % 2 === 0 ? outerRadius : innerRadius;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                if (i === 0) starShape.moveTo(x, y);
                else starShape.lineTo(x, y);
              }
              starShape.closePath();
              
              // Extrude into 3D
              const extrudeSettings = { depth: 0.5, bevelEnabled: true, bevelThickness: 0.1, bevelSize: 0.1 };
              const geometry = new THREE.ExtrudeGeometry(starShape, extrudeSettings);
              const material = new THREE.MeshStandardMaterial({ color: 0xFFD700, metalness: 0.5, roughness: 0.3 });
              const starMesh = new THREE.Mesh(geometry, material);
              
              starMesh.position.set(0,1.95,0);
              starMesh.scale.set(0.015,0.015,0.015);              

              starMesh2   = starMesh;
              
              var ambient   = new THREE.AmbientLight(0xffffff, 0.5);
              scene.add(ambient);
              
              var point     = new THREE.PointLight(0xffffff, 1.5, 20);
              point.position.set(0,10,5);
              scene.add(point);
              
              starMesh.rotation.y   = Math.PI/4;

              scene.add(starMesh);
          
              addPlane();
              
        }//addStar2



        var spark   = 'https://javascript-2020.github.io/storage/images/spark1.png';


        function addPlane(){
        
              //vertex:-
              const vertexShader = `
              
                    attribute float size;
                    attribute vec3 customColor;
                    
                    varying vec3 vColor;
                    
                    
                    void main() {
                    
                        vColor            = customColor;
                        
                        vec4 mvPosition   = modelViewMatrix*vec4(position,1.0);
                        
                        gl_PointSize      = size*(300.0/-mvPosition.z);
                        gl_Position       = projectionMatrix*mvPosition;
                        
                    }//main
                    
              `;
              
              //frag:-
              const fragmentShader = `
              
                    uniform vec3 color;
                    uniform sampler2D pointTexture;
                    
                    varying vec3 vColor;
                    
                    
                    void main() {
                    
                        gl_FragColor    = vec4(vColor,1.0);
                        gl_FragColor    = gl_FragColor*texture2D(pointTexture,gl_PointCoord);
                        
                    }//main
                    
              `;
              
              var value               = new THREE.TextureLoader().load(spark);
              var pointTexture        = {value};
              const shaderMaterial    = new THREE.ShaderMaterial({
                    vertexShader,
                    fragmentShader,
                    uniforms        : {...uniforms,pointTexture},
                    blending        : THREE.AdditiveBlending,
                    depthTest       : false,
                    transparent     : true,
                    vertexColors    : true,
              });
              
              
              var totalPoints   = 10000;
              const positions   = [];
              const colors      = [];
              const sizes       = [];
              const color       = new THREE.Color();
              
              for(let i=0;i<totalPoints;i++){
              
                    const [x,y,z]   = [rand(-50,50),0,rand(-150,15)];
                    positions.push(x);
                    positions.push(y);
                    positions.push(z);
                    
                    color.set(randChoise(["#93abd3","#f2f4c0","#9ddfd3"]));
                    colors.push(color.r,color.g,color.b);
                    
                    sizes.push(1);
                    
              }//for
              
              
              const geometry    = new THREE.BufferGeometry();
              var attr;
              
              attr    = new THREE.Float32BufferAttribute(positions,3).setUsage(THREE.DynamicDrawUsage)
              geometry.setAttribute("position",attr);
              
              attr    = new THREE.Float32BufferAttribute(colors,3);
              geometry.setAttribute("customColor",attr);
              
              attr    = new THREE.Float32BufferAttribute(sizes, 1);
              geometry.setAttribute("size",attr);
              
              
              const plane         = new THREE.Points(geometry,shaderMaterial);
              plane.position.y    = -8;
              
              scene.add(plane);
              
        }//addPlane





      </script>
      
</html>




