
      <style>
  body        {display:flex;flex-direction:column;gap:10px;font-family:arial}
  #progress   {border:1px solid lightgray;padding:1px;height:20px}
  #bar        {background:lightblue;height:100%;width:0}
  input       {font-size:16px;padding:5px 10px}
      </style>

      <h3>xhr upload</h3>
      
      <input id=url value='http://localhost:3010/upload'>
      <input id=upload value=upload type=button>

      
      <div id=progress>
        <div id=bar></div>
      </div>

      
      <div id=result>ready</div>
      
      
      <script>
                                                                                console.log('ready');
        var xhr;
        
        upload.onclick    = e=>{
                                                                                console.log('upload',url.value);
              if(xhr){
                    xh.abort();
              }
              
              result.textContent    = 'starting upload';
              bar.style.width       = 0;
              
              var size      = 100;
              var chunk     = new Uint8Array(1024*1024);
              var chunks    = new Array(size).fill(chunk);
              var blob      = new Blob(chunks,{type:'application/octet-stream'});
              
              xhr   = new XMLHttpRequest();
              
              xhr.open('post',url.value);
              
              xhr.upload.onprogress   = e=>{
                                                                                console.log('upload.onprogress');
                                                                                console.log(e);
                    if(e.lengthComputable){
                          var p             = e.loaded/e.total*100;
                          bar.style.width   = p+'%';
                    }
                    
              }//onprogress
              
              xhr.onload    = ()=>{              
              
                    var ok    = (xhr.status>=200 && xhr.status<300);
                    
                    if(ok){
                                                                                console.log('done');
                          bar.style.width       = '100%';
                          result.textContent    = 'done';
                          return;
                    }
                    
                                                                                console.warn('HTTP error:',xhr.status);
              }//onload

              xhr.onerror   = function(){
                                                                                console.error('Network error â€” request failed');
              }//onerror

                    
              xhr.send(blob);
              
        }//onchange


      </script>
            
