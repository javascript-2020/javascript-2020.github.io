
      <style>
  #root
    {font-family:arial;--unknown:}
  .label
    {display:inline-block;width:150px;text-align:right;margin:5px 10px}
  #progress
    {border:1px solid gray;padding:2px;height:20px;margin:20px}
  #bar
    {background:lightgreen;width:0;height:100%}

  #bar.unknown
    {opacity:0.5;background-size:20px 20px;background-image:repeating-linear-gradient(-45deg,#f7b733 0,#f7b733 5px,yellow 0,yellow 50%);
      animation: stripes-scroll 1s linear infinite;}

  @keyframes stripes-scroll {
    from {background-position: 0 0;}
    to {background-position: 20px 0;}
  }

      </style>
      
      <div id=root>
      
            <div>
                  <span class=label>
                        encoding
                  </span>
                  <span id=content-encoding></span>
            </div>
            <div>
                  <span class=label>
                        content-length
                  </span>
                  <span id=content-length></span>
            </div>
            <div>
                  <span class=label>
                        content-type
                  </span>
                  <span id=content-type></span>
            </div>
            <div id=progress>
                  <div id=bar></div>
            </div>
            <div id=result>
                  <div>
                  <div>
                        <span class=label>name</span>
                        <span id=name></span>
                  </div>
                  <div>
                        <span class=label>size</span>
                        <span id=size></span>
                  </div>
            </div>
      </div>


      <script>

(async()=>{
                                                                                console.clear();

        var $           = (root,sel)=>(!sel && (sel=root,root=document),root.querySelector(sel));
        var datatype    = v=>Object.prototype.toString.call(v).slice(8,-1).toLowerCase();

        
        var url         = 'https://raw.githubusercontent.com/javascript-2020/external/main/ffmpeg/ffmpeg-wasm/ffmpeg-wasm.zip'
        //  var url         = 'https://bgrins.github.io/videoconverter.js/build/ffmpeg-all-codecs.js';
        
        var i           = url.lastIndexOf('/')+1
        var fn          = url.slice(i);

        
        var headers     = {};
        var method      = 'get';
        var body        = undefined;
        
        var err;
        try{
          
              var res         = await fetch(url,{headers,method,body});
              
        }//try
        catch(err2){
          
              err   = err2;
              
        }//catch
        if(err){
              var error   = err.toString();
              console.error(error);
              return;
        }
        if(!res.ok){
              var txt     = await res.text();
              var error   = `failed to fetch : $(res.status} ${res.statusText}`;
              console.error(error);
              return;
        }

        
        var encoding    = res.headers.get('content-encoding');
                                                                                console.log('content-encoding',encoding);
        $('#content-encoding').textContent    = encoding;
        
        var flag    = false;
        if(encoding){
              encoding    = encoding.toLowerCase();
              if(encoding==='identity'){
                    flag    = true;
              }
        }
        encoding    = flag;
        if(!encoding){        
              $('#bar').className     = 'unknown';
              $('#bar').style.width   = '100%';
                                                                                console.log('unable to reliably computer content-length');
        }
        
        var type      = res.headers.get('content-type');
        $('#content-type').textContent    = type;
        
        var len       = res.headers.get('content-length');
        $('#content-length').textContent    = len;
                                                                                console.log(len);
        var total     = 0;
        var reader    = res.body.getReader();
        var chunks    = [];
        while(true){
        
              const {value,done}    = await reader.read();
              if(done)break;
              
              total  += value.length;
              chunks.push(value);
              
              if(encoding){
                    var w   = (total/len*100).toFixed(1)+'%';
                    $('#bar').style.width   = w;
                                                                                console.log('chunk',datatype(value),value.byteLength,total,w);
              }
              
        }//while
        
        var total     = chunks.reduce((acc,chunk)=>acc+chunk.length,0);
        var buf       = new Uint8Array(total);
        var offset    = 0;
        for(var chunk of chunks){
                                            
              buf.set(chunk,offset);
              offset   += chunk.length;
              
        }//for
        
        var blob    = new Blob([buf],{type:'application/octet-stream'});
        blob.name   = fn;
                                                                                console.log(blob);
        
        $('#result #name').textContent    = fn;
        $('#result #size').textContent    = blob.size;
        
        $('#bar').classList.remove('unknown');
        
        
})();


      </script>