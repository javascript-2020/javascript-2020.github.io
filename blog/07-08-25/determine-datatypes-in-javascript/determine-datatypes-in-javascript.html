


<html>


      <head>

      
            <title></title>

            <base href='https://javascript-2020.github.io/blob/07-08-25/'>
            
            <link rel=icon type='image/png' href='/blog/image/blog-30.png'>
            
            <link rel=stylesheet href='/blog/css/blog.css'>

            <script src='https://ajaxorg.github.io/ace-builds/src-noconflict/ace.js'></script>





            <script init>
                                                                                console.clear();
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));
        var version       = 'v1.0';
            
        var df            = true;


        var ext;
        var $;
        var datatype;
        
        var mod           = {};
        

  //:

              
        async function init(){
                                                                                //debug('init',version);
              await initdom(document.body);

              init.complete();

        }//init


        init.stack            = [init];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = '';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              if(init.stack.ct>=init.stack.total){
                console.log('*** complete');
                    init.stack.ct       = 0;
                    init.stack.total    = 0;
                    var list    = [...init.stack];
                    init.stack.length   = 0;
                    list.forEach(fn=>fn());
              }
        }});
        
        //  (typeof init!='undefined' && init?.stack && init.stack.add)
        //  (typeof init!='undefined' && init?.stack && init.stack.complete)

        
        init.complete   = function(){
          
              init.complete.stack.forEach(fn=>fn());
              
              
        }//complete
        
        init.complete.stack   = [];
        init.complete.add     = fn=>init.complete.stack.push(fn);

                  

(async()=>{
  
        init.stack.add;
        
        var token   = localStorage['github-token'];
        var url;
        var headers;
        if(token){
              url       = 'https://api.github.com/repos/javascript-2020/ext-code/contents/ext-loader.js';
              headers   = {accept:'application/vnd.github.raw',authorization:`bearer ${token}`};
        }else{
              url       = 'https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js';
        }
        
        await fetch(url,{headers}).then(res=>res.text()).then(complete);

            
        async function complete(txt){

              ext           = eval(txt);
              var promise   = ext.load.libs(
                    'js/dom/$.js.api',
                    'js/core/datatype.js',
              );
              [$,datatype]   = await promise;

              init.stack.complete;

        }//ext_fn

})();


            </script init>


            <style>
            
  html
    {height:100%}
  body
    {min-height:calc(100% - 40px);display:flex;flex-direction:column;gap:10px;
      font-family:arial
    }
    
  code
    {margin:0;border:1px solid lightgray}
    
  input
    {font-size:16px;padding:5px 10px}
  input[type=button]
    {cursor:pointer}
    
    
  .break
    {margin-top:30px}
  iframe
    {display:none}
    
    
            </style>

      </head>
      
      
      <body>


      
            <h3>
                  determine datatypes in javascript
            </h3>


            <div id=desc>

Determining datatypes in javascript always seemed to be a bit of a mystery, I've seen hundreds
of incarnations over the years, some work in some circumstances, until the code starts to get more 
complex and then just mysteriously stop working, my go to for datatype has always been the following :
            
            </div>


            <code snippet-console=ex1>
            </code>


            <div class=break></div>            

            <div>

This can be extended further through the use of

            </div>
            
            
            <code snippet-console>

      var myObject                    = {};
      myObject[Symbol.toStringTag]    = 'my-object';

      var type    = datatype(myObject);
      
      console.log(type);
      
            </code>
            

            <div class=break></div>            

            <div>

There have been many a bug created by using 

            </div>
            
            
            <code id=ex3 snippet-console>

        var iframe      = document.createElement('iframe');
        iframe.onload   = onload;
        document.body.append(iframe);

        
        function onload(){
        
              iframe.contentWindow.eval(`
              
                    var list    = [];
                    
              `);
              
              console.log(iframe.contentWindow.list instanceof Array);    //  false
              
              iframe.remove();
              
        }//onload
        
            </code>

<!-- ----- -->

            <script>
  
  
        async function initdom(rootnode){
          
          
              root                                  = rootnode;


              //$.all(root,'code').forEach(node=>create(node));
              await load(root);
              await snippet_console.all(root);
              
              

          
        }//initdom
            
  
  //:
  
  
        function load(rootnode){
          
              var list    = $.all(rootnode,'code');
              list        = list.map(load);
              //await Promise.all(list);
              
              async function load(code){
                
                    var fn    = code.getAttribute('snippet-console');
                    if(!fn)return;
                    
                    var fn              = fn+'.js';
                    var err;
                    try{
                      
                          var res             = await fetch(fn);
                          
                    }
                    catch(err2){
                      
                          err   = err2;
                    
                    }
                    if(err){
                            console.error(err);
                            return;
                    }
                    
                    if(!res.ok){
                            var txt   = await res.text();
                            console.log(txt);
                            return;
                    }
                    
                    var txt             = await res.text();
                    code.textContent    = txt;
                          
              }//load
              
        }//load

  
        function snippet_console(code){

              init.stack.add;
              init.stack.push(complete);
              
              var editor      = $.editor.max(code,{kd});


              var node        = document.createElement('snippet-console');
              node.setAttribute('api','');
              code.after(node);
                            
              var script      = document.createElement('script');
              script.toggleAttribute('html-loader',true);
              script.src      = 'https://html-loader-1024713184986.us-central1.run.app/';
              script.onload   = onload;              
              
              node.append(script);
              
              
              function onload(){
              
                    init.stack.complete;
                    
              }//onload
              
              
              async function complete(){
                
                    var snippet   = mod['snippet-console']();
              
                    snippet.initmod({ext,$,source});
                    
                    await snippet.init();
                    
                    var node    = code.nextElementSibling;
                    snippet.initdom(node);
                    
              }//onload
              
                            
              function source(){
                
                    var txt   = editor.getValue();
                    return txt;
                    
              }//source


              function kd(e){
                
                    if(e.key==='Enter' && e.ctrlKey){
                          snippet.run();
                    }
                    
              }//kd
        
        }//snippet_console
        
        
        snippet_console.all   = function(rootnode){
          
              var list    = $.all(rootnode,'code[snippet-console]');
              list.forEach(code=>snippet_console(code));
              
        }//all
  




  //:
  
  
  
  init.stack.complete;
  
            
            </script>
      
      </body>
      
      
</html>




