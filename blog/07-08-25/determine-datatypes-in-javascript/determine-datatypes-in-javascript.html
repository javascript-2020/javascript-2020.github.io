


<html>


      <head>

      
            <title></title>

            <base href='https://javascript-2020.github.io/blob/07-08-25/'>
            
            <link rel=icon type='image/png' href='/blog/image/blog-30.png'>
            
            <link rel=stylesheet href='/blog/css/blog.css'>

            <script src='https://ajaxorg.github.io/ace-builds/src-noconflict/ace.js'></script>





            <script init>
                                                                                console.clear();
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));
        var version       = 'v1.0';
            
        var df            = true;


        var ext;
        var $;
        var datatype;
        
        var mod           = {};
        
        var snippet;
        
        
  //:

              
        async function init(){
                                                                                //debug('init',version);


              snippet   = mod['snippet-console']();
              
              snippet.initmod({ext,$,ace,source});
              
              
              await snippet.init();
              
              
              
  //:
          
              
              await initdom(document.body);


              init.complete();

              
        }//init


        init.stack            = [init];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = 'log';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              if(init.stack.ct>=init.stack.total){
                    init.stack.forEach(fn=>fn());
                    init.stack.length   = 0;
                    init.stack.ct       = 0;
                    init.stack.total    = 0;
              }
        }});
        
        //  (typeof init!='undefined' && init?.stack && init.stack.add)
        //  (typeof init!='undefined' && init?.stack && init.stack.complete)

        
        init.complete   = function(){
          
              init.complete.stack.forEach(fn=>fn());
              
              
        }//complete
        
        init.complete.stack   = [];
        init.complete.add     = fn=>init.complete.stack.push(fn);

                  

(async()=>{
  
        init.stack.add;
        
        var token   = localStorage['github-token'];
        var url;
        var headers;
        if(token){
              url       = 'https://api.github.com/repos/javascript-2020/ext-code/contents/ext-loader.js';
              headers   = {accept:'application/vnd.github.raw',authorization:`bearer ${token}`};
        }else{
              url       = 'https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js';
        }
        
        await fetch(url,{headers}).then(res=>res.text()).then(complete);

            
        async function complete(txt){

              ext           = eval(txt);
              var promise   = ext.load.libs(
                    'js/dom/$.js.api',
                    'js/core/datatype.js',
              );
              [$,datatype]   = await promise;

              init.stack.complete;

        }//ext_fn

})();


            </script init>


            <style>
            
  html
    {height:100%}
  body
    {min-height:calc(100% - 40px);display:flex;flex-direction:column;gap:10px;
      font-family:arial
    }
    
  code
    {margin:0;border:1px solid lightgray}
    
  input
    {font-size:16px;padding:5px 10px}
  input[type=button]
    {cursor:pointer}
    
    
            </style>

      </head>
      
      
      <body>


      
            <h3>
                  determine datatypes in javascript
            </h3>


            <div id=desc>

Determining datatypes in javascript always seemed to be a bit of a mystery, I've seen hundreds
of incarnations over the years, some work in some circumstances, until the code starts to get more 
complex and then just mysteriously stop working, my go to for datatype has always been the following :
            
            </div>


            <code id=ex1>
            

        var v       = new Uint8Array();
        
        
        var type    = datatype(v);
        
        console.log(type);
        


        function datatype(v){
        
              var str   = Object.prototype.toString.call(v);
              str       = str.slice(8,-1);
              str       = str.toLowerCase();
              return str;
              
        }//datatype


            
            </code>



            <snippet-console api style='height:50px'>
                  <script html-loader src='https://html-loader-1024713184986.us-central1.run.app/'></script>
            </snippet-console>
            

            <div>

This can be extended further through the use of

            </div>
            
            
            <code id=ex2>

      var myObject                    = {};
      myObject[Symbol.toStringTag]    = 'my-object';

      var type    = datatype(myObject);
      
      console.log(type);
      
            </code>
            

            
            <script>



        var editor;
        

        var btn   = {};
        
        
  //:
  
  
        function initdom(rootnode){
          
          
              root                                  = rootnode;
              
              var node                              = $(root,'#ex1');
              editor    = setup(node);
              snippet.initdom(root);
              
              
              var node    = $(root,'#ex2');
              
              create(node);
              


          
        }//initdom
            

  //:
  
            
        async function setup(node,mode='javascript'){

              node.onkeydown    = kd;
              
              var editor      = ace.edit(node);
              editor.setShowInvisibles(false);
              editor.setShowPrintMargin(false);
              editor.setPrintMarginColumn(false);
              editor.setBehavioursEnabled(false);
              editor.setDisplayIndentGuides(false);
              editor.setScrollSpeed(2);
              editor.setFontSize(16);
              editor.session.setOptions({tabSize:2,useSoftTabs:true});
              //editor.setGhostText('\n\nctrl-enter - run & autosave\nctrl-s - save\nctrl-del - delete');
              editor.session.setMode('ace/mode/'+mode)                        
              editor.session.on('change',onchange);
              editor.setOption('maxLines',Infinity);


              editor.focus();
              return editor;
              
              
              function onchange(e){
                                                                                //console.log('onchange');                
                    var lh      = editor.renderer.lineHeight;
                    var lines   = editor.session.getLength();
                    var h       = lh*lines;
                    
                    editor.container.style.height = h+'px';
                    editor.resize();

              }//onchange
              
        }//editor
            
            
        function kd(e){
          
              if(e.key==='Enter' && e.ctrlKey){
                    btn.run();
              }
              
        }//kd
        

  //:
  
  
  
        function source(){
          
              var txt   = editor.getValue();
              return txt;
              
        }//source
  
  
  
  
  //:
  
  
  
        function create(code){
console.log('*** create ***');
              
              var node        = document.createElement('snippet-console');
              code.after(node);
              
              
              var script      = document.createElement('script');
              //html-loader               
              script.src      = 'https://html-loader-1024713184986.us-central1.run.app/';
              init.stack.push(complete);
              
              
              node.append(script);
              
              var editor    = setup(code);
              

              async function complete(){
                
                    var snippet   = mod['snippet-console']();
              
                    snippet.initmod({ext,$,source});
                    await snippet.init();
                    var node    = code.nextElementSibling;
                    //node        = node.shadowRoot;
                    debugger;
                    snippet.initdom(node);
                    
              }//onload
              
                            
              function source(){
                
                    var txt   = editor.getValue();
                    return txt;
                    
              }//source

          
        }//create
  
  
  init.stack.complete;
  
            
            </script>
      
      </body>
      
      
</html>




