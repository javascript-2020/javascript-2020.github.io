
/*
  requires
    path,fs
*/

        resolve.df    = false;
        
        function resolve(url,docroot='.'){
                                                                                resolve.df && console.log('=== resolve v2.0 ===');
                                                                                resolve.df && console.log('url :',url);
                                                                                resolve.df && console.log('docroot :',docroot);
              var err;
              try{
              
                    url         = decodeURI(url);
                    
              }//try
              catch(err2){
              
                    err   = err2;
                    
              }//catch
              if(err){
                                                                                resolve.df && console.error(err.message);
                    var error   = 'invalid url';
                    return {error};
              }
              
              url         = url.slice(1);
                                                                                resolve.df && console.log('url :',url);
              var root    = path.resolve(docroot);
              root       += path.sep;
                                                                                resolve.df && console.log('root :',root);
              var abs     = path.resolve(docroot,url);
                                                                                resolve.df && console.log('abs :',abs);
                                                                                
              if(!abs.startsWith(root)){
                                                                                resolve.df && console.log('invalid docroot');
                    var error   = 'invalid docroot';
                    return {error};
              }
              
              if(abs.length>root.length){
                    if(abs[root.length-1]!=path.sep){
                                                                                resolve.df && console.log('invlaid docroot-2');
                          var error   = 'invalid docroot-2';
                          return {error};
                    }
              }
              
              if(url.endsWith('/')){
                    abs  += '/';
              }
              
                                                                                resolve.df && console.log('ok',abs);
              return {abs};
              
        }//resolve
        
        
        
        