<script type=module>

        import jszip from 'https://cdn.jsdelivr.net/npm/jszip/+esm';

        var owner   = 'javascript-2020';
        var repo    = 'stackoverflow';
        var branch  = 'main';
        var path    = '';

        if(path[0]=='/')path    = path.slice(1);
        if(path && path.at(-1)!='/')path  += '/';

        var file    = `${path.split('/').filter(Boolean).at(-1)||repo}.zip`;
        var zip     = new jszip();
        var url     = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=true`;
        var json    = await fetch(url).then(res=>res.json());

        await Promise.all(json.tree.map(async item=>{

              if(!item.path.startsWith(path))return;

              var fn    = item.path.slice(path.length);
              if(item.type=='tree'){
                    zip.folder(fn);
              }else{
                    var url     = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${item.path}`;
                    var blob    = await fetch(url).then(res=>res.blob());
                    zip.file(fn,blob);
              }

        }));

        var blob      = await zip.generateAsync({type:'blob'});
        var url       = window.URL.createObjectURL(blob);
        var a         = document.createElement('a');
        a.href        = url;
        a.download    = file;
        a.click();

</script>
